<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>业档一体化 - 非结构化数据统一服务V1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    // ==========================================
    // 从 v3 迁移合并的逻辑代码 - 开始
    // ==========================================

    // 全局变量存储当前编辑的行
    let currentEditingRow = null;

    // 编辑分类
    function openEditCategoryModal(btn, event) {
        event.stopPropagation();
        const row = btn.closest('tr');
        currentEditingRow = row;
        
        // 获取行数据
        const cells = row.querySelectorAll('td');
        // 注意：第1列是序号，第2列是ID，第3列是代号，第4列是名称
        const code = cells[2].innerText;
        const name = cells[3].innerText;
        
        // 填充模态框
        document.getElementById('category-code').value = code;
        document.getElementById('category-name').value = name;
        
        // 设置标题为编辑
        document.querySelector('#add-category-modal h3').innerText = '编辑档案分类';
        
        // 修改确定按钮的点击事件
        const confirmBtn = document.querySelector('#add-category-modal button.bg-primary');
        if(confirmBtn) confirmBtn.onclick = confirmEditCategory;
        
        // 显示模态框
        document.getElementById('add-category-modal').classList.remove('hidden');
    }

    // 确认编辑
    function confirmEditCategory() {
        if (!currentEditingRow) return;
        
        const code = document.getElementById('category-code').value;
        const name = document.getElementById('category-name').value;
        
        if (!code || !name) {
            showToast('请填写完整信息', 'warning');
            return;
        }
        
        // 更新表格
        const cells = currentEditingRow.querySelectorAll('td');
        cells[2].innerText = code;
        cells[3].innerText = name;
        
        // 关闭模态框
        closeAddCategoryModal();
        showToast('分类修改成功', 'success');
        
        // 重置
        currentEditingRow = null;
    }

    // 启用/禁用切换
    function toggleCategoryStatus(btn, event) {
        event.stopPropagation();
        const row = btn.closest('tr');
        // 注意：启用状态在第9列，索引为8
        const statusCell = row.querySelectorAll('td')[8]; 
        const statusSpan = statusCell.querySelector('span');
        
        if (!statusSpan) return;

        const currentStatus = statusSpan.innerText.trim();
        
        if (currentStatus === '启用') {
            // 切换为禁用
            statusSpan.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
            statusSpan.innerText = '禁用';
            btn.innerText = '启用';
            btn.className = 'text-success hover:text-green-700 dark:hover:text-green-400';
            showToast('已禁用该分类', 'success');
        } else {
            // 切换为启用
            statusSpan.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
            statusSpan.innerText = '启用';
            btn.innerText = '禁用';
            btn.className = 'text-danger hover:text-red-700 dark:hover:text-red-400';
            showToast('已启用该分类', 'success');
        }
    }

    // 档案目录管理相关函数

    // 打开新增目录页面
    function openAddDirectory() {
        showPage('archive-directory-new');
        
        // 修改标题
        const page = document.getElementById('page-archive-directory-new');
        if(page && page.querySelector('h2')) page.querySelector('h2').innerText = '新增档案目录';
        
        // 设置取消按钮文本
        const cancelBtn = document.getElementById('cancel-btn-detail');
        if(cancelBtn) cancelBtn.innerText = '取消';

        // 重置表单
        if(page) {
            // 重置输入框和文本域
            const inputs = page.querySelectorAll('input[type="text"], textarea');
            inputs.forEach(input => input.value = '');
            
            // 重置下拉框
            const selects = page.querySelectorAll('select');
            selects.forEach(select => {
                Array.from(select.options).forEach(option => option.selected = false);
                if (select.options.length > 0) select.options[0].selected = true;
            });

            // 重置 Cascader 显示文本
            const cascaderText = document.getElementById('directory-cascader-text');
            if(cascaderText) cascaderText.innerText = '请选择档案分类';
            
            const projectText = document.getElementById('project-cascader-new-text');
            if(projectText) projectText.innerText = '请选择项目分类';
            
            const carrierPlaceholder = document.getElementById('carrier-cascader-placeholder');
            if(carrierPlaceholder) {
                carrierPlaceholder.innerText = '请选择档案载体';
                carrierPlaceholder.classList.remove('hidden');
            }
             
             // 重置 carrier tags
             const carrierTags = document.getElementById('carrier-cascader-tags');
             if(carrierTags) {
                 carrierTags.innerHTML = '';
                 carrierTags.classList.add('hidden');
             }

            carrierSelections = [];
            document.querySelectorAll('#carrier-cascader-level1 .cascader-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (!checkbox) return;
                checkbox.checked = false;
                item.classList.remove('active');
            });
            
            setArchiveLevelCascaderDisabled(false);
            setArchiveLevelSelections([]);

            // 默认启用状态
            const toggle = document.getElementById('toggle');
            if (toggle) toggle.checked = true;

            // 启用所有表单元素
            const allInputs = page.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => input.disabled = false);
            ensureElectronicCarrierSelected();
            
            // 显示保存按钮
            const saveBtn = page.querySelector('button[onclick="saveDirectory()"]');
            if (saveBtn) saveBtn.style.display = 'inline-flex';

            // 隐藏编辑按钮
            const editBtn = document.getElementById('edit-btn-detail');
            if (editBtn) editBtn.classList.add('hidden');
        }
    }

    // 启用编辑模式
    function enableEditMode() {
        const page = document.getElementById('page-archive-directory-new');
        if (!page) return;

        // 修改标题
        if(page.querySelector('h2')) page.querySelector('h2').innerText = '编辑档案目录';

        // 启用所有表单元素
        const inputs = page.querySelectorAll('input, select, textarea');
        inputs.forEach(input => input.disabled = false);
        setArchiveLevelCascaderDisabled(false);
        ensureElectronicCarrierSelected();

        // 显示保存按钮
        const saveBtn = page.querySelector('button[onclick="saveDirectory()"]');
        if (saveBtn) saveBtn.style.display = 'inline-flex';

        // 隐藏编辑按钮
        const editBtn = document.getElementById('edit-btn-detail');
        if (editBtn) editBtn.classList.add('hidden');
    }

    // 打开编辑目录页面 (废弃，不再使用，保留函数名防止报错，实际逻辑已迁移到 showDirectoryDetail 和 enableEditMode)
    function openEditDirectory(btn, event) {
       // 此函数不再被列表页调用
    }



    // 打开目录详情页面
    function showDirectoryDetail(row) {
        showPage('archive-directory-new');
        
        // 修改标题
        const page = document.getElementById('page-archive-directory-new');
        if(page && page.querySelector('h2')) page.querySelector('h2').innerText = '档案目录详情';
        
        // 设置取消按钮文本为“返回列表”
        const cancelBtn = document.getElementById('cancel-btn-detail');
        if(cancelBtn) cancelBtn.innerText = '返回列表';

        // 获取行数据
        const cells = row.querySelectorAll('td');
        const archiveCategoryCellText = (cells[1] && cells[1].innerText ? cells[1].innerText : '').trim();
        let archiveCategory = '';
        if (archiveCategoryCellText) {
            const lines = archiveCategoryCellText.split('\n').map(v => v.trim()).filter(Boolean);
            const firstLine = lines[0] || '';
            const secondLine = lines[1] || '';
            let parts = [];
            if (firstLine.includes('/')) {
                parts = firstLine.split('/').map(v => v.trim()).filter(Boolean);
            } else if (firstLine.includes('-')) {
                parts = firstLine.split('-').map(v => v.trim()).filter(Boolean);
            } else {
                parts = [firstLine].filter(Boolean);
            }
            if (secondLine) parts.push(secondLine);
            archiveCategory = parts.join('/');
        }
        const materialType = cells[2].innerText.trim(); // 资料类型
        const archiveDimension = cells[3].innerText.trim(); // 归档维度
        const archiveConfidentiality = cells[4].innerText.trim(); // 档案密级
        const isRequired = cells[5].querySelector('span').innerText.trim(); // 是否必有
        const conditionDesc = cells[6].innerText.trim(); // 条件必有说明
        const retentionPeriod = cells[7].innerText.trim(); // 保管期限
        const isLinkedProject = cells[8].innerText.trim(); // 是否关联项目
        const projectCategory = cells[9].innerText.trim(); // 关联项目分类
        const archiveCarrier = cells[10].innerText.trim(); // 档案载体
        const isPhysicalArchive = cells[11].innerText.trim(); // 是否应归实体档案
        const archiveMilestone = cells[12].innerText.trim(); // 归档里程碑
        const fileSourceSystem = cells[13].innerText.trim(); // 文件来源系统
        const isBusinessAssessment = cells[14].innerText.trim(); // 是否经营事项考核
        const status = cells[15].innerText.trim(); // 状态

        // 填充表单数据
        // 档案分类 (Cascader模拟)
        const cascaderText = document.getElementById('directory-cascader-text');
        if (cascaderText) {
            if (!archiveCategory) {
                cascaderText.innerText = '请选择档案分类';
                cascaderText.classList.add('text-gray-400');
            } else {
                cascaderText.innerText = archiveCategory;
                cascaderText.classList.remove('text-gray-400');
            }
        }
        
        // 资料类型
        const materialInput = page.querySelectorAll('input[type="text"]')[0];
        if (materialInput) materialInput.value = materialType;
        
        // 业务含义 (第2个输入框，假设列表中没有，这里留空或模拟)
        const businessMeaningInput = page.querySelectorAll('input[type="text"]')[1];
        if (businessMeaningInput) businessMeaningInput.value = '';

        // 归档层级（列表页不展示，优先从 data-archive-level 读取，如：集团/大区/区域）
        const archiveLevelRaw = (row.dataset && row.dataset.archiveLevel ? row.dataset.archiveLevel : '').trim();
        if (archiveLevelRaw) {
            const levels = archiveLevelRaw.split(/[\/,、]/).map(v => v.trim()).filter(Boolean);
            setArchiveLevelSelections(levels);
        } else {
            setArchiveLevelSelections(['集团']);
        }

        // 归档维度 (第2个下拉框)
        const dimensionSelect = page.querySelectorAll('select')[1];
        if (dimensionSelect) dimensionSelect.value = dimensionSelect.options.length > 0 ? archiveDimension : '';

        // 归档规则（列表页不展示，优先从 data-archive-rule 读取）
        const ruleInput = page.querySelectorAll('input[type="text"]')[2];
        if (ruleInput) {
            const rule = (row.dataset && row.dataset.archiveRule ? row.dataset.archiveRule : '').trim();
            ruleInput.value = rule;
        }

        // 档案密级 (第3个下拉框)
        const confidentialitySelect = page.querySelectorAll('select')[2];
        if (confidentialitySelect) confidentialitySelect.value = archiveConfidentiality;

        // 是否必有 (第4个下拉框)
        const isRequiredSelect = document.getElementById('is-required-select');
        if (isRequiredSelect) {
            isRequiredSelect.value = isRequired === '必有' ? 'must' : (isRequired === '或有' ? 'optional' : 'conditional');
        }

        // 条件必有说明 (第4个输入框)
        const conditionDescInput = page.querySelectorAll('input[type="text"]')[3];
        if (conditionDescInput) conditionDescInput.value = conditionDesc;

        // 保管期限 (第5个下拉框)
        const retentionSelect = page.querySelectorAll('select')[4];
        if (retentionSelect) retentionSelect.value = retentionPeriod;

        // 是否关联项目 (第6个下拉框)
        const isLinkedSelect = page.querySelectorAll('select')[5];
        if (isLinkedSelect) isLinkedSelect.value = isLinkedProject;

        // 关联项目分类 (Cascader模拟)
        const projectText = document.getElementById('project-cascader-new-text');
        if(projectText) projectText.innerText = projectCategory || '请选择项目分类';

        // 档案载体（多选回显）
        const carrierPlaceholder = document.getElementById('carrier-cascader-placeholder');
        if (carrierPlaceholder) carrierPlaceholder.innerText = archiveCarrier || '请选择档案载体';
        const carriers = (archiveCarrier || '').split('/').map(v => v.trim()).filter(Boolean);
        carrierSelections = carriers;
        document.querySelectorAll('#carrier-cascader-level1 .cascader-item').forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (!checkbox) return;
            const isSelected = carrierSelections.includes(checkbox.value);
            checkbox.checked = isSelected;
            item.classList.toggle('active', isSelected);
        });
        updateCarrierDisplay();

        // 是否应归实体档案 (第7个下拉框)
        const isPhysicalSelect = page.querySelectorAll('select')[6];
        if (isPhysicalSelect) isPhysicalSelect.value = isPhysicalArchive || '否';

        // 归档里程碑 (第8个下拉框)
        const milestoneSelect = page.querySelectorAll('select')[7];
        if (milestoneSelect) milestoneSelect.value = archiveMilestone || '无';

        // 文件来源系统 (第9个下拉框)
        const sourceSystemSelect = page.querySelectorAll('select')[8];
        if (sourceSystemSelect) {
            // 根据文本找到对应value
            const options = sourceSystemSelect.options;
            for (let i = 0; i < options.length; i++) {
                if (options[i].text === fileSourceSystem) {
                    sourceSystemSelect.selectedIndex = i;
                    break;
                }
            }
        }

        // 是否经营事项考核 (第10个下拉框)
        const businessAssessmentSelect = page.querySelectorAll('select')[9];
        if (businessAssessmentSelect) {
            businessAssessmentSelect.value = isBusinessAssessment === '是' ? 'yes' : 'no';
        }

        // 状态 (启用/停用)
        const toggle = document.getElementById('toggle');
        if (toggle) toggle.checked = (status === '启用');

        // 禁用所有表单元素
        const inputs = page.querySelectorAll('input, select, textarea');
        inputs.forEach(input => input.disabled = true);
        setArchiveLevelCascaderDisabled(true);
        
            // 隐藏保存按钮
            const saveBtn = page.querySelector('button[onclick="saveDirectory()"]');
            if (saveBtn) saveBtn.style.display = 'none';

            // 显示编辑按钮
            const editBtn = document.getElementById('edit-btn-detail');
            if (editBtn) editBtn.classList.remove('hidden');
    }

    // 档案分类树形结构展开/收起
    function toggleTreeRow(icon, event) {
        event.stopPropagation();
        const tr = icon.closest('tr');
        const id = tr.getAttribute('data-id');
        
        // 切换图标
        if (icon.classList.contains('fa-caret-down')) {
            icon.classList.remove('fa-caret-down');
            icon.classList.add('fa-caret-right');
            // 收起：隐藏子行
            const childRows = document.querySelectorAll(`tr[data-parent-id="${id}"]`);
            childRows.forEach(row => row.classList.add('hidden'));
        } else {
            icon.classList.remove('fa-caret-right');
            icon.classList.add('fa-caret-down');
            // 展开：显示子行
            const childRows = document.querySelectorAll(`tr[data-parent-id="${id}"]`);
            childRows.forEach(row => row.classList.remove('hidden'));
        }
    }
    
    // ==========================================
    // 从 v3 迁移合并的逻辑代码 - 结束
    // ==========================================

</script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#3b82f6',
                        neutral: '#64748b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        archive: '#f8fafc',
                        purple: { 50: '#faf5ff', 100: '#f3e8ff', 600: '#9333ea', 700: '#7c3aed' }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 text-gray-800 overflow-hidden dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">

<!-- 深色模式切换按钮 -->
<button onclick="toggleDarkMode()" class="theme-toggle fixed bottom-6 right-6 z-50 w-12 h-12 bg-primary text-white rounded-full shadow-lg flex items-center justify-center hover:shadow-xl transition-all">
    <i class="fas fa-moon dark:hidden"></i>
    <i class="fas fa-sun hidden dark:block"></i>
</button>

<!-- 抽屉遮罩层（移动端） -->
<div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>

<!-- 顶部导航 - 调整高度，将标签栏移出 -->
<header class="bg-white border-b border-gray-200 h-14 flex flex-col shadow-sm z-50 relative dark:bg-gray-800 dark:border-gray-700">
    <!-- 第一行：logo和用户信息 -->
    <div class="h-14 flex items-center justify-between px-4 w-full">
        <div class="flex items-center gap-2 md:gap-4">
            <button onclick="toggleSidebar()" class="p-2 hover:bg-gray-100 rounded-lg transition text-gray-600 dark:hover:bg-gray-700 dark:text-gray-300">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white font-bold">
                <i class="fas fa-archive"></i>
            </div>
            <div class="hidden sm:block">
                <h1 class="text-lg font-bold text-gray-900 dark:text-white">业档一体化服务平台</h1>
                <p class="text-xs text-gray-500 dark:text-gray-400 hidden md:block">非结构化数据统一服务V1.0</p>
            </div>
            <div class="sm:hidden">
                <h1 class="text-base font-bold text-gray-900 dark:text-white">业档一体化</h1>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-6">
            <div class="hidden md:flex items-center gap-3 bg-blue-50 px-4 py-2 rounded-full border border-blue-100 dark:bg-blue-900/30 dark:border-blue-800">
                <i class="fas fa-building text-primary"></i>
                <span class="text-sm font-medium text-primary dark:text-blue-300">北控水务集团</span>
                <span class="text-gray-300 dark:text-gray-600">|</span>
                <span class="text-sm text-gray-600 dark:text-gray-400">东部大区</span>
            </div>

            <div class="flex items-center gap-2 md:gap-4">
                <button class="relative p-2 text-gray-500 hover:text-primary transition dark:text-gray-400 dark:hover:text-blue-400">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="absolute top-1 right-1 w-2 h-2 bg-danger rounded-full animate-pulse"></span>
                </button>
                <div class="flex items-center gap-2 md:gap-3 pl-2 md:pl-4 border-l border-gray-200 dark:border-gray-700">
                    <div class="w-8 h-9 md:w-9 md:h-9 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-semibold text-sm">
                        张
                    </div>
                    <div class="hidden md:block">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">张三</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">档案管理岗</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="flex h-[calc(100vh-56px)]">
    <!-- 侧边栏（抽屉形式）- 添加收放按钮 -->
    <aside id="sidebar" class="sidebar-drawer w-64 bg-white border-r border-gray-200 flex flex-col overflow-y-auto flex-shrink-0 absolute lg:relative z-40 h-full shadow-lg lg:shadow-none relative dark:bg-gray-800 dark:border-gray-700">
        <!-- 侧边栏收放按钮 -->
        <button onclick="toggleSidebar()" class="sidebar-toggle-btn lg:flex hidden" title="收起/展开菜单">
            <i class="fas fa-chevron-left text-xs text-gray-500 dark:text-gray-400"></i>
        </button>

        <div class="p-4">
            <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-3 dark:text-gray-500">业务应用</div>
            <nav class="space-y-1">
                <a href="#" onclick="showPage('dashboard')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg bg-blue-50 text-primary font-medium border-l-4 border-primary dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-500">
                    <i class="fas fa-home w-5"></i>
                    <span>工作台</span>
                    <span class="ml-auto bg-primary text-white text-xs px-2 py-0.5 rounded-full">5</span>
                </a>
                <a href="#" onclick="showPage('archive-list')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">
                    <i class="fas fa-file-import w-5"></i>
                    <span>上传文件</span>
                    <span class="ml-auto bg-gray-400 text-white text-xs px-2 py-0.5 rounded-full dark:bg-gray-600">12</span>
                </a>
               
                <!-- <a href="#" onclick="showPage('file-approval')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">
                    <i class="fas fa-clipboard-check w-5"></i>
                    <span>文件审批</span>
                    <span class="ml-auto bg-warning text-white text-xs px-2 py-0.5 rounded-full">8</span>
                </a>
                <a href="#" onclick="showPage('file-list')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">
                    <i class="fas fa-list w-5"></i>
                    <span>文件清单</span>
                    <span class="ml-auto bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded-full dark:bg-gray-700 dark:text-gray-300">12</span>
                </a> -->
                <a href="#" onclick="showPage('archive-ledger')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">

                    <i class="fas fa-folder-open w-5"></i>
                    <span>电子文件台账</span>
                </a>
            </nav>

            <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-3 px-3 dark:text-gray-500">系统配置</div>
            <nav class="space-y-1">
                <a href="#" onclick="showPage('archive-config')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">
                    <i class="fas fa-folder-tree w-5"></i>
                    <span>档案分类管理</span>
                </a>
                <a href="#" onclick="showPage('archive-directory')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">
                    <i class="fas fa-list-alt w-5"></i>
                    <span>档案目录管理</span>
                </a>
                <a href="#" onclick="showPage('permission')" class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-primary font-medium transition dark:text-gray-300 dark:hover:text-blue-400">
                    <i class="fas fa-user-shield w-5"></i>
                    <span>权限管理</span>
                </a>
            </nav>
        </div>

        <div class="mt-auto p-4 border-t border-gray-200 dark:border-gray-700">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-robot"></i>
                    <span class="font-semibold text-sm">AI 智能归档 V2.0</span>
                </div>
                <p class="text-xs text-blue-100 mb-3">即将上线：智能分类、自动提取、AI校验</p>
                <div class="w-full bg-blue-400 rounded-full h-1.5">
                    <div class="bg-white rounded-full h-1.5 w-3/4"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- 右侧主内容区（包含标签页和主内容） -->
    <div class="flex-1 flex flex-col overflow-hidden bg-gray-50 dark:bg-gray-900">
        <!-- 第二行：标签页导航栏 - 移动到菜单栏右侧 -->
        <div id="tab-container" class="bg-white border-b border-gray-200 flex items-center h-10 overflow-x-auto whitespace-nowrap flex-shrink-0 dark:bg-gray-800 dark:border-gray-700">
            <!-- 动态生成标签页 -->
        </div>

        <!-- 主内容区 -->
        <main class="flex-1 overflow-y-auto bg-gray-50 relative dark:bg-gray-900" id="main-container">

        <!-- 工作台页面 -->
        <div id="page-dashboard" class="fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">工作台</h2>
                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">欢迎回来，张三！您有 <span class="text-warning font-semibold">5</span> 个待办事项需要处理</p>
                </div>
                <div class="text-sm text-gray-500 dark:text-gray-400">
                    <i class="far fa-calendar-alt mr-2"></i>2026年1月28日 星期二
                </div>
            </div>

            <!-- 统计卡片 -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4">
                <div class="bg-white rounded-xl p-4 md:p-5 border border-gray-100 shadow-sm hover:shadow-md transition cursor-pointer dark:bg-gray-800 dark:border-gray-700" onclick="showPage('archive-list')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs md:text-sm text-gray-500 mb-1 dark:text-gray-400">待提交</p>
                            <p class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">5</p>
                        </div>
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 dark:bg-gray-700 dark:text-gray-300">
                            <i class="fas fa-edit"></i>
                        </div>
                    </div>
                    <div class="mt-2 md:mt-3 text-xs text-gray-400 dark:text-gray-500">等待完善信息后提交审批</div>
                </div>
                <div class="bg-white rounded-xl p-4 md:p-5 border border-gray-100 shadow-sm hover:shadow-md transition cursor-pointer dark:bg-gray-800 dark:border-gray-700" onclick="showPage('approval-center')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs md:text-sm text-gray-500 mb-1 dark:text-gray-400">审批中</p>
                            <p class="text-xl md:text-2xl font-bold text-warning">3</p>
                        </div>
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-yellow-50 flex items-center justify-center text-warning dark:bg-yellow-900/30">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="mt-2 md:mt-3 text-xs text-gray-400 dark:text-gray-500">需要您审批的上传申请</div>
                </div>
                <div class="bg-white rounded-xl p-4 md:p-5 border border-gray-100 shadow-sm hover:shadow-md transition cursor-pointer dark:bg-gray-800 dark:border-gray-700" onclick="showPage('archive-ledger')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs md:text-sm text-gray-500 mb-1 dark:text-gray-400">本月已上传</p>
                            <p class="text-xl md:text-2xl font-bold text-success">128</p>
                        </div>
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-green-50 flex items-center justify-center text-success dark:bg-green-900/30">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="mt-2 md:mt-3 text-xs text-gray-400 dark:text-gray-500">本月已成功上传的电子文件数量</div>
                </div>
                <div class="bg-white rounded-xl p-4 md:p-5 border border-gray-100 shadow-sm hover:shadow-md transition cursor-pointer dark:bg-gray-800 dark:border-gray-700" onclick="showPage('archive-list')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs md:text-sm text-gray-500 mb-1 dark:text-gray-400">已拒绝</p>
                            <p class="text-xl md:text-2xl font-bold text-danger">2</p>
                        </div>
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-red-50 flex items-center justify-center text-danger dark:bg-red-900/30">
                            <i class="fas fa-times-circle"></i>
                        </div>
                    </div>
                    <div class="mt-2 md:mt-3 text-xs text-gray-400 dark:text-gray-500">被驳回需重新提交的申请</div>
                </div>
            </div>

            <!-- 快捷入口 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div onclick="showPage('upload-files')" class="group bg-gradient-to-r from-primary to-blue-600 rounded-xl p-4 md:p-6 text-white cursor-pointer hover:shadow-lg hover:shadow-blue-200 transition transform hover:-translate-y-1 dark:hover:shadow-blue-900/30">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-base md:text-lg font-semibold mb-2">批量上传文件</h3>
                            <p class="text-blue-100 text-xs md:text-sm">批量上传文件并发起审批流程</p>
                        </div>
                        <div class="w-12 h-12 md:w-14 md:h-14 rounded-full bg-white/20 flex items-center justify-center group-hover:scale-110 transition">
                            <i class="fas fa-plus text-xl md:text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm text-blue-100">
                        <span>立即创建</span>
                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition"></i>
                    </div>
                </div>

                <div onclick="showPage('archive-ledger')" class="group bg-white rounded-xl p-4 md:p-6 border border-gray-200 cursor-pointer hover:shadow-lg transition transform hover:-translate-y-1 dark:bg-gray-800 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-2 dark:text-white">查看电子文件台账</h3>
                            <p class="text-gray-500 text-xs md:text-sm dark:text-gray-400">查询、浏览电子文件台账</p>
                        </div>
                        <div class="w-12 h-12 md:w-14 md:h-14 rounded-full bg-blue-50 flex items-center justify-center text-primary group-hover:scale-110 transition dark:bg-blue-900/30">
                            <i class="fas fa-folder-open text-xl md:text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm text-primary">
                        <span>进入台账</span>
                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition"></i>
                    </div>
                </div>
            </div>

            <!-- 待办事项 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 dark:bg-gray-800 dark:border-gray-700">
                <div class="px-4 md:px-6 py-4 border-b border-gray-200 flex items-center justify-between dark:border-gray-700">
                    <h3 class="font-semibold text-gray-900 dark:text-white">待办事项</h3>
                    <button class="text-primary text-sm hover:underline dark:text-blue-400">查看全部</button>
                </div>
                <div class="divide-y divide-gray-100 dark:divide-gray-700">
                    <div class="px-4 md:px-6 py-4 flex flex-col md:flex-row md:items-center justify-between hover:bg-gray-50 transition cursor-pointer dark:hover:bg-gray-700">
                        <div class="flex items-center gap-4">
                            <div class="w-2 h-2 rounded-full bg-danger flex-shrink-0"></div>
                            <div class="min-w-0">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">【审批】张三提交的归档申请</p>
                                <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">科技档案 / 基建档案 / 12份文件 </p>
                            </div>
                        </div>
                        <span class="text-xs text-gray-400 mt-2 md:mt-0">10分钟前</span>
                    </div>
                    <div class="px-4 md:px-6 py-4 flex flex-col md:flex-row md:items-center justify-between hover:bg-gray-50 transition cursor-pointer dark:hover:bg-gray-700">
                        <div class="flex items-center gap-4">
                            <div class="w-2 h-2 rounded-full bg-warning flex-shrink-0"></div>
                            <div class="min-w-0">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">【审批】李四提交的归档申请</p>
                                <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">文书档案 / 行政文书 / 3份文件</p>
                            </div>
                        </div>
                        <span class="text-xs text-gray-400 mt-2 md:mt-0">1小时前</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文件上传申请列表页（含状态列）- 筛选条件移至表头下方 -->
        <div id="page-archive-list" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">文件上传申请</h2>
                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">管理您的文件上传申请，支持批量操作与状态追踪（含已上传、已拒绝状态）</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="showPage('upload-files')" class="bg-primary hover:bg-blue-700 text-white px-4 md:px-6 py-2.5 rounded-lg font-medium flex items-center gap-2 shadow-lg shadow-blue-200 transition transform hover:scale-105 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-plus"></i>
                        <span class="hidden sm:inline">上传文件</span>
                        <span class="sm:hidden">新增</span>
                    </button>
                </div>
            </div>

            <!-- 列表（含审批状态列）- 筛选条件在表头下方 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden dark:bg-gray-800 dark:border-gray-700">
                <div class="px-4 md:px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gray-50 gap-2 dark:bg-gray-800 dark:border-gray-700">
                    <div class="flex gap-2">
                        <button class="px-3 py-1.5 text-sm text-gray-600 border border-gray-300 rounded hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">
                            <i class="fas fa-download mr-1"></i>导出
                        </button>
                    </div>
                </div>

                <div class="table-container mobile-scroll-x">
                    <table class="data-table" id="archive-list-table">
                        <thead>
                            <tr>
                                <th style="position: sticky;left: 0;"  class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">序号<div class="resize-handle"></div></th>
                                <th>申请单编号<div class="resize-handle"></div></th>
                                <th>档案分类<div class="resize-handle"></div></th>
                                <th>所属项目<div class="resize-handle"></div></th>
                                <th>法人组织<div class="resize-handle"></div></th>
                                <th>上传人<div class="resize-handle"></div></th>
                                <th>创建日期<div class="resize-handle"></div></th>
                                <th>文件数量<div class="resize-handle"></div></th>
                                <th>审批状态<div class="resize-handle"></div></th>
                            </tr>
                            <!-- 筛选条件行 -->
                            <tr class="header-filter">
                                <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">-</td>
                                <td class="px-2 md:px-4 py-2">
                                    <input type="text" placeholder="搜索编号" class="w-full">
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <div class="flex flex-col lg:flex-row gap-1">
                                        <select id="filter-level1" onchange="updateLevel2('filter')" class="w-full lg:w-auto">
                                            <option value="">全部</option>
                                            <option value="kj">科技档案</option>
                                            <option value="ws">文书档案</option>
                                        </select>
                                        <select id="filter-level2" class="w-full lg:w-auto">
                                            <option value="">全部</option>
                                        </select>
                                    </div>
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <input type="text" placeholder="搜索项目名称">
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <select class="w-full">
                                        <option value="">全部</option>
                                        <option>北控水务（中国）投资有限公司</option>
                                        <option>北控水务发展有限公司</option>
                                    </select>
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <input type="text" placeholder="上传人">
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <input type="text" placeholder="日期">
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <input type="text" placeholder="数量">
                                </td>
                                <td class="px-2 md:px-4 py-2">
                                    <select class="w-full">
                                        <option value="">全部</option>
                                        <option value="draft">新建</option>
                                        <option value="pending">审批中</option>
                                        <option value="revoked">已撤回</option>
                                        <option value="rejected">已拒绝</option>
                                        <option value="archived">已审批</option>
                                    </select>
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 审批中 -->
                            <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="showPage('archive-detail-pending')">
                                <td class="text-center font-medium text-gray-900 sticky left-0 bg-white dark:bg-gray-800 dark:text-white z-10">1</td>
                                <td class="font-medium text-primary">20260128-G001-000001</td>
                                <td class="text-xs">
                                    <span class="block font-medium dark:text-white">科技档案</span>
                                    <span class="text-gray-500 dark:text-gray-400">基建档案</span>
                                </td>
                                <td class="text-gray-600 dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="text-gray-600 dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-28</td>
                                <td class="text-center dark:text-gray-300">7</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                                        <span class="w-1.5 h-1.5 bg-yellow-500 rounded-full mr-1.5 animate-pulse"></span>
                                        审批中
                                    </span>
                                </td>
                            </tr>

                            <!-- 已归档：点击跳转已归档详情页 -->
                            <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="showPage('archive-detail-archived')">
                                <td class="text-center font-medium text-gray-900 sticky left-0 bg-white dark:bg-gray-800 dark:text-white z-10">2</td>
                                <td class="font-medium text-primary">20260127-WS002-000045</td>
                                <td class="text-xs">
                                    <span class="block font-medium dark:text-white">文书档案</span>
                                    <span class="text-gray-500 dark:text-gray-400">行政文书</span>
                                </td>
                                <td class="text-gray-600 dark:text-gray-300">-</td>
                                <td class="text-gray-600 dark:text-gray-300">北控水务（中国）投资有限公司</td>
                                <td class="dark:text-gray-300">李四</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-27</td>
                                <td class="text-center dark:text-gray-300">7</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                        <i class="fas fa-check-circle mr-1"></i>
                                        已审批
                                    </span>
                                </td>
                            </tr>

                            <!-- 已拒绝：点击跳转已拒绝详情页（可编辑） -->
                            <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="showPage('archive-detail-rejected')">
                                <td class="text-center font-medium text-gray-900 sticky left-0 bg-white dark:bg-gray-800 dark:text-white z-10">3</td>
                                <td class="font-medium text-primary">20260126-KJ003-000012</td>
                                <td class="text-xs">
                                    <span class="block font-medium dark:text-white">科技档案</span>
                                    <span class="text-gray-500 dark:text-gray-400">投资档案</span>
                                </td>
                                <td class="text-gray-600 dark:text-gray-300">北京某TOT项目</td>
                                <td class="text-gray-600 dark:text-gray-300">北京清源污水净化有限公司</td>
                                <td class="dark:text-gray-300">王五</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-26</td>
                                <td class="text-center dark:text-gray-300">2</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                                        <i class="fas fa-times-circle mr-1"></i>
                                        已拒绝
                                    </span>
                                </td>
                            </tr>
                            <!-- 新建：点击进入新增文件上传申请页面 -->
                            <tr class="hover:bg-blue-50 transition cursor-pointer border-2 border-dashed border-primary dark:border-blue-500 dark:hover:bg-blue-900/20" onclick="showPage('upload-files')">
                                <td class="text-center font-medium text-gray-900 sticky left-0 bg-white dark:bg-gray-800 dark:text-white z-10">4</td>
                                <td class="font-medium text-primary">20260126-KJ003-000013</td>
                                <td class="text-xs">
                                    <span class="block font-medium dark:text-white">科技档案</span>
                                    <span class="text-gray-500 dark:text-gray-400">基建档案</span>
                                </td>
                                <td class="text-gray-600 dark:text-gray-300">北京某TOT项目</td>
                                <td class="text-gray-600 dark:text-gray-300">北京清源污水净化有限公司</td>
                                <td class="dark:text-gray-300">赵六</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-30</td>
                                <td class="text-center dark:text-gray-300">10</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                        <i class="fas fa-plus-circle mr-1"></i>
                                        新建
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 统一分页控件 -->
                <div class="pagination-container flex-col sm:flex-row gap-4">
                    <div class="pagination-info text-center sm:text-left">
                        显示第 <span class="font-medium">1</span> 到 <span class="font-medium">10</span> 条，共 <span class="font-medium">156</span> 条
                    </div>
                    <div class="flex items-center gap-4 flex-wrap justify-center">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600 dark:text-gray-400">每页显示</span>
                            <select class="pagination-select" onchange="changePageSize(this.value)">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span class="text-sm text-gray-600 dark:text-gray-400">条</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

       

        <!-- 已归档详情页（完整字段+审批记录+AI报告，全部只读）**已修改** -->
        <div id="page-archive-detail-archived" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('archive-list')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-3">
                            <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">文件上传详情</h2>
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200 w-fit dark:bg-green-900 dark:text-green-200 dark:border-green-800">
                                已审批
                            </span>
                        </div>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">申请单号：20260127-WS002-000045</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="showPage('archive-list')" class="px-4 md:px-5 py-2 md:py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        返回列表
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
                <div class="lg:col-span-2 space-y-4 md:space-y-6">
                      <!-- 基本信息（全部只读） -->
                      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-info-circle text-primary"></i>
                            基本信息
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 text-sm">
                            <div class="md:col-span-2">
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">档案分类</label>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <input type="text" value="文书档案" disabled class="flex-1 bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                                    <input type="text" value="行政文书" disabled class="flex-1 bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                                </div>
                            </div>
                             <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">是否必须关联项目</label>
                                <input type="text" value="否" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">所属项目</label>
                                <input type="text" value="-" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">管理组织</label>
                                <input type="text" value="东部大区-总部" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">法人组织</label>
                                <input type="text" value="北控水务（中国）投资有限公司" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">档案来源</label>
                                <input type="text" value="非结构化数据统一服务" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">档案上传方式</label>
                                <input type="text" value="手工录入移交" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
 
                                                       <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">上传部门</label>
                                <input type="text" value="行政部" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">上传人</label>
                                <input type="text" value="李四（东部大区-行政专员）" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>

                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">申请单创建日期</label>
                                <input type="text" value="2026-01-27" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">审批通过日期</label>
                                <input type="text" value="2026-01-27" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                        </div>
                    </div>

                    <!-- 文件清单（表格形式只读展示） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 dark:text-white">文件清单 (7份)</h3>

                        <div class="table-container mobile-scroll-x">
                            <table class="data-table readonly-table" id="file-list-archived-table">
                                <thead>
                                    <tr>
                                        <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                                        <th>附件名称<div class="resize-handle"></div></th>
                                        <th>档案题名<div class="resize-handle"></div></th>
                                        <th>三级分类<div class="resize-handle"></div></th>
                                        <th>资料类型<div class="resize-handle"></div></th>
                                        <th>项目名称<div class="resize-handle"></div></th>
                                        <th>密级<div class="resize-handle"></div></th>
                                        <th>成文日期<div class="resize-handle"></div></th>
                                        <th>责任者<div class="resize-handle"></div></th>
                                        <th>文号<div class="resize-handle"></div></th>
                                        <th>页数<div class="resize-handle"></div></th>
                                    </tr>
                                    <tr class="header-filter">
                                        <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 text-center">-</td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                                                                <td><input type="text" placeholder="搜索"></td>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">1</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">关于加强档案管理的通知.pdf</a></td>
                                        <td class="font-medium dark:text-white">关于加强档案管理的通知</td>
                                        <td class="dark:text-gray-300">行政发文</td>
                                        <td class="dark:text-gray-300">通知</td>
                                        <td class="dark:text-gray-300">XXXTOT项目</td>
                                        <td><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                        <td class="dark:text-gray-300">2026-01-27</td>
                                        <td class="dark:text-gray-300">行政部</td>
                                        <td class="dark:text-gray-300">北水行〔2026〕15号</td>
                                        <td class="text-center dark:text-gray-300">3</td>
                                    </tr>
                                     <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">1</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">关于加强档案管理的通知.pdf</a></td>
                                        <td class="font-medium dark:text-white">关于加强档案管理的通知</td>
                                        <td class="dark:text-gray-300">行政发文</td>
                                        <td class="dark:text-gray-300">通知</td>
                                        <td class="dark:text-gray-300">XXXTOT项目</td>
                                        <td><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                        <td class="dark:text-gray-300">2026-01-27</td>
                                        <td class="dark:text-gray-300">行政部</td>
                                        <td class="dark:text-gray-300">北水行〔2026〕15号</td>
                                        <td class="text-center dark:text-gray-300">3</td>
                                          <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">1</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">关于加强档案管理的通知.pdf</a></td>
                                        <td class="font-medium dark:text-white">关于加强档案管理的通知</td>
                                        <td class="dark:text-gray-300">行政发文</td>
                                        <td class="dark:text-gray-300">通知</td>
                                        <td class="dark:text-gray-300">XXXTOT项目</td>
                                        <td><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                        <td class="dark:text-gray-300">2026-01-27</td>
                                        <td class="dark:text-gray-300">行政部</td>
                                        <td class="dark:text-gray-300">北水行〔2026〕15号</td>
                                        <td class="text-center dark:text-gray-300">3</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 右侧栏：审批记录 + AI检查报告 -->
                <div class="space-y-4 md:space-y-6">
                    <!-- 审批记录 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-5 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-tasks text-primary"></i>
                            审批记录
                        </h3>
                        <div class="space-y-4">
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white text-xs flex-shrink-0">李</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">李四</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-27 09:00</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1 dark:text-gray-400">提交审批</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-xs flex-shrink-0">部</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">部门负责人</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-27 10:30</span>
                                    </div>
                                    <p class="text-xs text-success mt-1"><i class="fas fa-check-circle mr-1"></i>审批通过</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-xs flex-shrink-0">管</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">集团档案管理岗</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-27 16:30</span>
                                    </div>
                                    <p class="text-xs text-success mt-1"><i class="fas fa-check-circle mr-1"></i>审批通过并归档</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 智能检查报告（可点击查看详情） -->
                    <div class="bg-blue-50 rounded-xl border border-blue-200 p-4 md:p-5 cursor-pointer hover:shadow-md transition dark:bg-blue-900/20 dark:border-blue-800" onclick="showAICheckDetail()">
                        <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2 dark:text-blue-200">
                            <i class="fas fa-robot text-primary"></i>
                            AI 智能检查报告
                        </h3>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-blue-800 dark:text-blue-200">已检查 10 项</span>
                            <span class="text-xs text-primary bg-white px-2 py-1 rounded dark:bg-blue-800 dark:text-blue-200">查看详情</span>
                        </div>
                        <div class="w-full bg-blue-200 rounded-full h-2 mb-2 dark:bg-blue-800">
                            <div class="bg-success h-2 rounded-full" style="width: 100%"></div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-success flex items-center gap-1"><i class="fas fa-check-circle"></i> 通过 10项</span>
                            <span class="text-gray-400 flex items-center gap-1"><i class="fas fa-exclamation-circle"></i> 需复审 0项</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- 已拒绝详情页（完整可编辑字段+审批记录+AI报告+拒绝原因）**表格形式** -->
        <div id="page-archive-detail-rejected" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('archive-list')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-3">
                            <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">上传文件详情</h2>
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 border border-red-200 w-fit dark:bg-red-900 dark:text-red-200 dark:border-red-800">
                                已拒绝
                            </span>
                        </div>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">申请单号：20260126-KJ003-000012</p>
                    </div>
                </div>
                <div class="flex gap-2 md:gap-3 flex-wrap">
                    <button onclick="showPage('archive-list')" class="px-4 md:px-5 py-2 md:py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        返回列表
                    </button>
                    <button onclick="saveDraft()" class="px-4 md:px-5 py-2 md:py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        <i class="fas fa-save mr-2"></i>保存草稿
                    </button>
                    <button onclick="submitApproval()" class="px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-paper-plane"></i>
                        重新提交
                    </button>
                </div>
            </div>

            <!-- 拒绝原因（醒目提示） -->
            <div class="bg-red-50 border-l-4 border-red-500 rounded-r-xl p-4 dark:bg-red-900/20 dark:border-red-600">
                <div class="flex items-start gap-3">
                    <i class="fas fa-exclamation-circle text-danger text-xl mt-0.5"></i>
                    <div class="flex-1">
                        <h4 class="font-semibold text-red-900 dark:text-red-200">审批拒绝原因</h4>
                        <p class="text-sm text-red-800 mt-1 dark:text-red-300">档案分类选择错误，投资档案应属于"科技档案-投资档案"分类，而非"基建档案"。请调整后重新提交。</p>
                        <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 text-xs text-red-600 dark:text-red-400">
                            <span><i class="fas fa-user mr-1"></i>拒绝人：区域档案管理员</span>
                            <span><i class="fas fa-clock mr-1"></i>时间：2026-01-26 15:30</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
                <div class="lg:col-span-2 space-y-4 md:space-y-6">
                    <!-- 可编辑的基本信息（与新增页一致） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-info-circle text-primary"></i>
                            基本信息
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">


                            
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">档案分类 <span class="text-danger">*</span></label>
                                <div class="cascader-container" id="archive-cascader-rejected">
                                    <div class="cascader-input" onclick="toggleCascader('archive-cascader-rejected')">
                                        <span id="archive-cascader-rejected-text">科技档案 / 投资档案</span>
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                    <div class="cascader-dropdown">
                                        <div class="cascader-menu">
                                            <div class="cascader-column" id="archive-cascader-rejected-level1">
                                                <div class="cascader-item active" onclick="selectCascaderLevel('archive-cascader-rejected', 1, '科技档案', this)">
                                                    科技档案 <i class="fas fa-chevron-right"></i>
                                                </div>
                                                <div class="cascader-item" onclick="selectCascaderLevel('archive-cascader-rejected', 1, '文书档案', this)">
                                                    文书档案 <i class="fas fa-chevron-right"></i>
                                                </div>
                                            </div>
                                            <div class="cascader-column" id="archive-cascader-rejected-level2">
                                                <div class="cascader-item" onclick="selectCascaderLevel('archive-cascader-rejected', 2, '基建档案', this)">基建档案</div>
                                                <div class="cascader-item active" onclick="selectCascaderLevel('archive-cascader-rejected', 2, '投资档案', this)">投资档案</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否必须关联项目 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>是</option>
                                    <option>否</option>
                                </select>
                            </div>

                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">所属项目 <span class="text-danger">*</span></label>
                                <div class="relative">
                                    <input type="text" value="成都某水厂改扩建项目" readonly
                                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm cursor-pointer hover:border-primary focus:outline-none focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white project-select-input"
                                        onclick="openProjectSelectModal(this)"
                                        placeholder="点击选择项目">
                                    <i class="fas fa-search absolute right-3 top-2.5 text-gray-400 text-sm"></i>
                                </div>
                            </div>


                            

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">管理组织 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>东部大区-北京区域公司-北京某TOT项目公司</option>
                                </select>
                            </div>

                    

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">法人组织 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>北京清源污水净化有限公司</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">上传部门 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>投资并购部</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">上传人 <span class="text-danger">*</span></label>
                                <input type="text" value="王五（东部大区-投资经理）" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div>

                           
                            <!-- <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">所属项目分类名称</label>
                                <input type="text" value="城镇污水" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">所属项目业态</label>
                                <input type="text" value="水务运营" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">所属项目投资模式</label>
                                <input type="text" value="TOT" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div> -->

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">申请单创建日期</label>
                                <input type="text" value="2026-01-26" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div>
                        </div>
                    </div>

                    <!-- 可编辑的文件清单（表格形式） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                            <h3 class="text-base md:text-lg font-semibold text-gray-900 dark:text-white">文件清单 (2份)</h3>
                            <div class="flex gap-2">
                              <button onclick="toggleFileListExpand()" class="px-3 md:px-4 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition dark:bg-purple-900 dark:text-purple-300">
                                  <i class="fas fa-expand mr-1"></i>放大编辑
                              </button>
                                <button class="px-3 md:px-4 py-2 border border-primary text-primary rounded-lg text-sm font-medium hover:bg-blue-50 transition dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/30">
                                    <i class="fas fa-folder-open mr-1"></i>选择文件
                                </button>
                                <button onclick="toggleDragZone('rejected')" class="px-3 md:px-4 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">
                                    <i class="fas fa-upload mr-1"></i>拖拽文件
                                </button>
                            </div>
                        </div>

                        <!-- 拖拽区域 -->
                        <div id="drag-zone-rejected" class="drag-zone-container hidden mb-4">
                            <div class="drop-zone border-2 border-dashed border-gray-300 rounded-lg p-4 md:p-8 text-center bg-gray-50 hover:bg-blue-50 hover:border-primary transition-colors dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600 dark:hover:border-blue-400"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 ondrop="handleDrop(event, 'rejected')">
                                <i class="fas fa-cloud-upload-alt text-3xl md:text-4xl text-gray-400 mb-3"></i>
                                <p class="text-gray-600 mb-1 text-sm md:text-base dark:text-gray-300">将文件拖拽到此处上传</p>
                                <p class="text-xs text-gray-400 dark:text-gray-500">支持 PDF、DOC、XLS、PPT、JPG、PNG、压缩包等格式</p>
                            </div>
                        </div>

                        <div class="table-container mobile-scroll-x">
                            <table class="data-table editable-table" id="file-list-rejected-table">
                                <thead>
                                    <tr>
                                        <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                                        <th>附件名称 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>档案题名 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>资料类型 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>项目名称 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>密级 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>成文日期 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>责任者 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                        <th>文号<div class="resize-handle"></div></th>
                                        <!-- <th>页数 <span class="text-danger">*</span><div class="resize-handle"></div></th> -->
                                        <th>操作<div class="resize-handle"></div></th>
                                    </tr>
                                    <tr class="header-filter">
                                        <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 text-center">-</td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <!-- <td><input type="text" placeholder="搜索"></td> -->
                                        <td><input type="text" placeholder="搜索"></td>
                                                                                <td><input type="text" placeholder="搜索"></td>

                                        <td class="text-center">-</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">1</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">股权转让协议.pdf</a></td>
                                        <td><input type="text" value="股权转让协议" class="w-full"></td>

                                        <!-- <td>
                                            <select class="dark:bg-gray-700"><option selected>股权转让协议</option></select>
                                        </td> -->
                                        <td>
                                            <div class="relative">
                                                <input type="text" value="股权转让协议" readonly
                                                    class="w-full bg-white border border-gray-300 rounded px-2 py-1 text-xs cursor-pointer hover:border-primary focus:outline-none focus:border-primary dark:bg-gray-700 dark:border-gray-600"
                                                    onclick="openMaterialTypeModal(this)"
                                                    placeholder="点击选择资料类型">
                                                <i class="fas fa-search absolute right-2 top-1.5 text-gray-400 text-sm"></i>
                                            </div>
                                        </td>
          <td>
                                <div class="relative">
                                    <input type="text" value="成都某水厂改扩建项目" readonly
                                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm cursor-pointer hover:border-primary focus:outline-none focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white project-select-input"
                                        onclick="openProjectSelectModal(this)"
                                        placeholder="点击选择项目">
                                    <i class="fas fa-search absolute right-2 top-1.5 text-gray-400 text-sm"></i>
                                </div>
</td>
                                        <td>
                                            <select class="bg-yellow-50 border-yellow-300 dark:bg-yellow-900/20 dark:border-yellow-600 dark:text-white">
                                                <option>无密级</option>
                                                <option selected>秘密级</option>
                                                <option>机密级</option>
                                                <option>绝密级</option>
                                            </select>
                                        </td>
                                        <td><input type="date" value="2026-01-20" class="w-full"></td>
                                        <td><input type="text" value="投资并购部" class="w-full"></td>
                                        <td><input type="text" class="w-full"></td>
                                        <td><input type="number" value="12" class="w-full text-center"></td>
                                        <td class="text-center">
                                            <button onclick="removeTableRow(this)" class="text-gray-400 hover:text-danger"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>

                <!-- 右侧栏：审批记录（含拒绝节点） + AI检查报告 -->
                <div class="space-y-4 md:space-y-6">
                    <!-- 审批记录（含拒绝信息） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-5 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-tasks text-primary"></i>
                            审批记录
                        </h3>
                        <div class="space-y-4">
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white text-xs flex-shrink-0">王</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">王五</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-26 14:00</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1 dark:text-gray-400">提交审批</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-xs flex-shrink-0">部</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">部门负责人</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-26 15:00</span>
                                    </div>
                                    <p class="text-xs text-success mt-1"><i class="fas fa-check-circle mr-1"></i>审批通过</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center text-white text-xs flex-shrink-0">审</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">区域档案管理员</span>
                                        <span class="text-xs text-danger">已拒绝</span>
                                    </div>
                                    <div class="mt-2 bg-red-50 border border-red-200 rounded p-2 dark:bg-red-900/20 dark:border-red-800">
                                        <p class="text-xs text-red-800 mb-1 dark:text-red-300"><i class="fas fa-times-circle mr-1"></i>审批拒绝</p>
                                        <p class="text-xs text-red-600 dark:text-red-400">档案分类错误，应选"投资档案"</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 智能检查报告 -->
                    <div class="bg-blue-50 rounded-xl border border-blue-200 p-4 md:p-5 cursor-pointer hover:shadow-md transition dark:bg-blue-900/20 dark:border-blue-800" onclick="showAICheckDetail()">
                        <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2 dark:text-blue-200">
                            <i class="fas fa-robot text-primary"></i>
                            AI 智能检查报告
                        </h3>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-blue-800 dark:text-blue-200">已检查 10 项</span>
                            <span class="text-xs text-primary bg-white px-2 py-1 rounded dark:bg-blue-800 dark:text-blue-200">查看详情</span>
                        </div>
                        <div class="w-full bg-blue-200 rounded-full h-2 mb-2 dark:bg-blue-800">
                            <div class="bg-warning h-2 rounded-full" style="width: 80%"></div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-success flex items-center gap-1"><i class="fas fa-check-circle"></i> 通过 8项</span>
                            <span class="text-warning flex items-center gap-1"><i class="fas fa-exclamation-circle"></i> 需复审 2项</span>
                        </div>
                    </div>

                  
                </div>
            </div>
        </div>

        <!-- 审批中详情页（新增）**只读** -->
        <div id="page-archive-detail-pending" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('archive-list')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-3">
                            <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">上传文件详情
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 border border-yellow-200 w-fit dark:bg-yellow-900 dark:text-yellow-200 dark:border-yellow-800">
                                审批中
                            </span>
                        </div>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">申请单号：20260128-G001-000001</p>
                    </div>
                </div>
                <div class="flex gap-2 md:gap-3 flex-wrap">
                    <button onclick="showPage('archive-list')" class="px-3 md:px-5 py-2 md:py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        返回列表
                    </button>
                    <button onclick="showWithdrawModal()" class="px-3 md:px-5 py-2 md:py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        <i class="fas fa-undo mr-2"></i>撤回审批
                    </button>
                    <button onclick="approvalRejected()" class="px-3 md:px-5 py-2 md:py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 shadow-lg shadow-red-200 transition flex items-center gap-2 dark:shadow-red-900/30 text-sm md:text-base">
                        <i class="fas fa-times"></i>
                        拒绝
                    </button>
                    <button onclick="approved()" class="px-3 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-paper-plane"></i>
                        同意
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
                <div class="lg:col-span-2 space-y-4 md:space-y-6">
                    <!-- 基本信息（全部只读） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-info-circle text-primary"></i>
                            基本信息
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 text-sm">
                            <div class="md:col-span-2">
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">档案分类</label>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <input type="text" value="科技档案" disabled class="flex-1 bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                                    <input type="text" value="基建档案" disabled class="flex-1 bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                                </div>
                            </div>
                            <!-- <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">是否必须关联项目</label>
                                <input type="text" value="是" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div> -->
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">所属项目</label>
                                <input type="text" value="成都某水厂改扩建项目" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">管理组织</label>
                                <input type="text" value="东部大区-枣庄区域公司-枣庄台儿庄区污水处理厂" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                         
                          
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">法人组织</label>
                                <input type="text" value="北控水务发展有限公司" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                               <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">上传部门</label>
                                <input type="text" value="枣庄台儿庄区污水处理厂-综合部" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">上传人</label>
                                <input type="text" value="张三（东部大区-档案管理岗）" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
  <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">文件来源</label>
                                <input type="text" value="非结构化数据统一服务" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">档案归档方式</label>
                                <input type="text" value="手工录入移交" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1 dark:text-gray-400">申请单创建日期</label>
                                <input type="text" value="2026-01-28" disabled class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300">
                            </div>
                            
                        </div>
                    </div>

                    <!-- 文件清单（表格形式只读） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 dark:text-white">文件清单 (7份)</h3>

                        <div class="table-container mobile-scroll-x">
                            <table class="data-table readonly-table" id="file-list-pending-table">
                                <thead>
                                    <tr>
                                        <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                                        <th>附件名称<div class="resize-handle"></div></th>
                                        <th>档案题名<div class="resize-handle"></div></th>
                                        <th>三级分类<div class="resize-handle"></div></th>
                                        <th>资料类型<div class="resize-handle"></div></th>
                                        <th>项目名称<div class="resize-handle"></div></th>

                                        <th>密级<div class="resize-handle"></div></th>
                                        <th>成文日期<div class="resize-handle"></div></th>
                                        <th>责任者<div class="resize-handle"></div></th>
                                        <th>文号<div class="resize-handle"></div></th>
                                        <th>页数<div class="resize-handle"></div></th>
                                    </tr>
                                    <tr class="header-filter">
                                        <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 text-center">-</td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                        <td><input type="text" placeholder="搜索"></td>
                                         <td><input type="text" placeholder="搜索"></td>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">1</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">施工技术方案_主体结构施工.pdf</a></td>
                                        <td class="font-medium dark:text-white">施工技术方案_主体结构施工</td>
                                        <td class="dark:text-gray-300">施工资料</td>
                                        <td class="dark:text-gray-300">施工组织设计</td>
                                        <td class="dark:text-gray-300">XXXXTOT项目</td>
                                        <td><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                        <td class="dark:text-gray-300">2026-01-20</td>
                                        <td class="dark:text-gray-300">南京某建筑公司</td>
                                        <td class="dark:text-gray-300">施组-2026-001</td>
                                        <td class="text-center dark:text-gray-300">45</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">2</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">施工技术方案_主体结构施工.pdf</a></td>
                                        <td class="font-medium dark:text-white">施工技术方案_主体结构施工</td>
                                        <td class="dark:text-gray-300">施工资料</td>
                                        <td class="dark:text-gray-300">施工组织设计</td>
                                        <td class="dark:text-gray-300">XXXXTOT项目</td>
                                        <td><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                        <td class="dark:text-gray-300">2026-01-20</td>
                                        <td class="dark:text-gray-300">南京某建筑公司</td>
                                        <td class="dark:text-gray-300">施组-2026-001</td>
                                        <td class="text-center dark:text-gray-300">45</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">3</td>
                                        <td><a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline">施工技术方案_主体结构施工.pdf</a></td>
                                        <td class="font-medium dark:text-white">施工技术方案_主体结构施工</td>
                                        <td class="dark:text-gray-300">施工资料</td>
                                        <td class="dark:text-gray-300">施工组织设计</td>
                                        <td class="dark:text-gray-300">XXXXTOT项目</td>
                                        <td><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                        <td class="dark:text-gray-300">2026-01-20</td>
                                        <td class="dark:text-gray-300">南京某建筑公司</td>
                                        <td class="dark:text-gray-300">施组-2026-001</td>
                                        <td class="text-center dark:text-gray-300">45</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 右侧栏：审批记录 + AI检查报告 -->
                <div class="space-y-4 md:space-y-6">
                    <!-- 审批记录（审批中状态） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-5 dark:bg-gray-800 dark:border-gray-700">
                        <div class="overflow-x-auto mobile-scroll-x"></div>
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-tasks text-primary"></i>
                            审批记录
                        </h3>
                        <div class="space-y-4">
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white text-xs flex-shrink-0">张</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">张三</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-28 09:00</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1 dark:text-gray-400">提交审批</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-xs flex-shrink-0">部</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">部门负责人</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">01-28 10:30</span>
                                    </div>
                                    <p class="text-xs text-success mt-1"><i class="fas fa-check-circle mr-1"></i>审批通过</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-white text-xs flex-shrink-0 animate-pulse">审</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">区域档案管理员</span>
                                        <span class="text-xs text-warning">审批中...</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">当前审批节点</p>
                                    <div class="mt-2 bg-yellow-50 border border-yellow-200 rounded p-2 dark:bg-yellow-900/20 dark:border-yellow-800">
                                        <p class="text-xs text-yellow-800 dark:text-yellow-200"><i class="fas fa-clock mr-1"></i>等待审批</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-3 opacity-50">
                                <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white text-xs flex-shrink-0">集</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">集团档案管理岗</span>
                                        <span class="text-xs text-gray-400">待处理</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">等待前置流程完成</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 智能检查报告 -->
                    <div class="bg-blue-50 rounded-xl border border-blue-200 p-4 md:p-5 cursor-pointer hover:shadow-md transition dark:bg-blue-900/20 dark:border-blue-800" onclick="showAICheckDetail()">
                        <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2 dark:text-blue-200">
                            <i class="fas fa-robot text-primary"></i>
                            AI 智能检查报告
                        </h3>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-blue-800 dark:text-blue-200">已检查 10 项</span>
                            <span class="text-xs text-primary bg-white px-2 py-1 rounded dark:bg-blue-800 dark:text-blue-200">查看详情</span>
                        </div>
                        <div class="w-full bg-blue-200 rounded-full h-2 mb-2 dark:bg-blue-800">
                            <div class="bg-success h-2 rounded-full" style="width: 90%"></div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-success flex items-center gap-1"><i class="fas fa-check-circle"></i> 通过 9项</span>
                            <span class="text-warning flex items-center gap-1"><i class="fas fa-exclamation-circle"></i> 待确认 1项</span>
                        </div>
                    </div>

                    <!-- 流程提示 -->
                    <div class="bg-blue-50 rounded-xl border border-blue-200 p-4 md:p-5 dark:bg-blue-900/20 dark:border-blue-800">
                        <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2 dark:text-blue-200">
                            <i class="fas fa-info-circle"></i>
                            审批进度提示
                        </h3>
                        <p class="text-sm text-blue-800 leading-relaxed dark:text-blue-200">
                            当前申请正在<strong>区域档案管理员</strong>审批中，请耐心等待。如需撤回申请，请联系区域档案管理员或使用"撤回审批"功能。
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文件清单页（上传人视角）- 所有字段可筛选 -->
        <div id="page-file-list" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('dashboard')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">文件清单</h2>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">管理您上传的文件，支持批量提交审批</p>
                    </div>
                </div>
                <div class="flex gap-2 md:gap-3 flex-wrap">
                    <button onclick="showPage('upload-files')" class="px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-cloud-upload-alt"></i>
                        上传文件
                    </button>
                    <button onclick="batchSubmitFileList()" class="px-4 md:px-5 py-2 md:py-2.5 border border-primary text-primary rounded-lg font-medium hover:bg-blue-50 transition flex items-center gap-2 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/30 text-sm md:text-base disabled:opacity-50 disabled:cursor-not-allowed" id="batch-submit-file-list-btn" disabled>
                        <i class="fas fa-paper-plane"></i>
                        批量提交审批 (<span id="batch-submit-file-count">0</span>)
                    </button>
                </div>
            </div>

            <!-- 文件列表（所有字段可筛选） -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden dark:bg-gray-800 dark:border-gray-700">
                <div class="px-4 md:px-6 py-4 border-b border-gray-200 bg-gray-50 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 dark:bg-gray-800 dark:border-gray-700">
                    <div class="flex items-center gap-2">
                        <h3 class="font-semibold text-gray-900 dark:text-white">我的文件</h3>
                        <span class="px-2 py-0.5 bg-primary text-white text-xs rounded-full" id="file-list-total">12</span>
                    </div>
                    <div class="flex gap-2">
                        <select class="pagination-select" onchange="filterFileListStatus(this.value)">
                            <option value="all">全部状态</option>
                            <option value="draft">待提交</option>
                            <option value="pending">审批中</option>
                            <option value="approved">已通过</option>
                            <option value="rejected">已拒绝</option>
                        </select>
                    </div>
                </div>

                <div class="table-container mobile-scroll-x">
                    <table class="data-table" id="file-list-table">
                        <thead>
                            <tr>
                                <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 w-10">
                                    <input type="checkbox" id="select-all-file-list" class="w-4 h-4 text-primary rounded focus:ring-primary" onchange="toggleSelectAllFileList(this)">
                                </th>
                                <th class="sticky left-10 z-30 bg-gray-50 dark:bg-gray-800">序号<div class="resize-handle"></div></th>
                                <th>附件名称<div class="resize-handle"></div></th>
                                <th>档案分类<div class="resize-handle"></div></th>
                                <th>资料类型<div class="resize-handle"></div></th>
                                <th>档案题名<div class="resize-handle"></div></th>
                                <th>密级<div class="resize-handle"></div></th>
                                <th>上传时间<div class="resize-handle"></div></th>
                                <th>审批状态<div class="resize-handle"></div></th>
                                <th class="text-center">操作<div class="resize-handle"></div></th>
                            </tr>
                            <!-- 筛选条件行 - 所有字段均可筛选 -->
                            <tr class="header-filter">
                                <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">-</td>
                                <td class="sticky left-10 z-30 bg-gray-50 dark:bg-gray-800 text-center">-</td>
                                <td><input type="text" placeholder="搜索文件名" class="w-full" oninput="filterFileList(this, 2)"></td>
                                <td>
                                    <select class="w-full dark:bg-gray-700" onchange="filterFileList(this, 3)">
                                        <option value="">全部</option>
                                        <option>科技档案/基建档案</option>
                                        <option>科技档案/投资档案</option>
                                        <option>文书档案/行政文书</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="搜索资料类型" class="w-full" oninput="filterFileList(this, 4)"></td>
                                <td><input type="text" placeholder="搜索题名" class="w-full" oninput="filterFileList(this, 5)"></td>
                                <td>
                                    <select class="w-full dark:bg-gray-700" onchange="filterFileList(this, 6)">
                                        <option value="">全部</option>
                                        <option>无密级</option>
                                        <option>秘密级</option>
                                        <option>机密级</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="日期" class="w-full" oninput="filterFileList(this, 7)"></td>
                                <td>
                                    <select class="w-full dark:bg-gray-700" onchange="filterFileList(this, 8)">
                                        <option value="">全部</option>
                                        <option>待提交</option>
                                        <option>审批中</option>
                                        <option>已通过</option>
                                        <option>已拒绝</option>
                                    </select>
                                </td>
                                <td class="text-center">-</td>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 待提交状态 -->
                            <tr class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="sticky left-0 bg-white dark:bg-gray-800 z-10">
                                    <input type="checkbox" class="file-list-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="1" data-status="draft" onchange="updateFileListBatchCount()">
                                </td>
                                <td class="text-center font-medium text-gray-900 sticky left-10 bg-white dark:bg-gray-800 dark:text-white z-10">1</td>
                                <td class="dark:text-gray-300">
                                    <a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline text-xs">施工方案_主体结构.pdf</a>
                                </td>
                                <td class="text-xs dark:text-gray-300">
                                    <span class="block font-medium">科技档案</span>
                                    <span class="text-gray-500">基建档案</span>
                                </td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="font-medium dark:text-white">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300"><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                <td class="text-gray-500 dark:text-gray-400 text-xs">2026-01-28 14:30</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                        <span class="w-1.5 h-1.5 bg-gray-500 rounded-full mr-1.5"></span>
                                        待提交
                                    </span>
                                </td>
                                <td class="text-center">
                                    <div class="flex items-center justify-center gap-2">
                                        <button onclick="editFile(1)" class="text-gray-400 hover:text-primary dark:hover:text-blue-400" title="编辑"><i class="fas fa-edit"></i></button>
                                        <button onclick="submitSingleFile(1)" class="text-success hover:text-green-700" title="提交审批"><i class="fas fa-paper-plane"></i></button>
                                        <button onclick="deleteFile(1)" class="text-danger hover:text-red-700" title="删除"><i class="fas fa-trash-alt"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <!-- 审批中状态 -->
                            <tr class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="sticky left-0 bg-white dark:bg-gray-800 z-10">
                                    <input type="checkbox" class="file-list-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="2" data-status="pending" disabled title="审批中状态不可选择">
                                </td>
                                <td class="text-center font-medium text-gray-900 sticky left-10 bg-white dark:bg-gray-800 dark:text-white z-10">2</td>
                                <td class="dark:text-gray-300">
                                    <a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline text-xs">技术交底记录.pdf</a>
                                </td>
                                <td class="text-xs dark:text-gray-300">
                                    <span class="block font-medium">科技档案</span>
                                    <span class="text-gray-500">基建档案</span>
                                </td>
                                <td class="dark:text-gray-300">技术交底</td>
                                <td class="font-medium dark:text-white">主体结构施工技术交底记录</td>
                                <td class="dark:text-gray-300"><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                <td class="text-gray-500 dark:text-gray-400 text-xs">2026-01-28 15:00</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                                        <span class="w-1.5 h-1.5 bg-yellow-500 rounded-full mr-1.5 animate-pulse"></span>
                                        审批中
                                    </span>
                                </td>
                                <td class="text-center">
                                    <div class="flex items-center justify-center gap-2">
                                        <button onclick="previewFile(2)" class="text-gray-400 hover:text-primary dark:hover:text-blue-400" title="预览"><i class="fas fa-eye"></i></button>
                                        <button onclick="withdrawFile(2)" class="text-warning hover:text-yellow-700" title="撤回"><i class="fas fa-undo"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <!-- 已通过状态 -->
                            <tr class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="sticky left-0 bg-white dark:bg-gray-800 z-10">
                                    <input type="checkbox" class="file-list-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="3" data-status="approved" disabled title="已归档状态不可选择">
                                </td>
                                <td class="text-center font-medium text-gray-900 sticky left-10 bg-white dark:bg-gray-800 dark:text-white z-10">3</td>
                                <td class="dark:text-gray-300">
                                    <a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline text-xs">质量验收记录.pdf</a>
                                </td>
                                <td class="text-xs dark:text-gray-300">
                                    <span class="block font-medium">科技档案</span>
                                    <span class="text-gray-500">基建档案</span>
                                </td>
                                <td class="dark:text-gray-300">质量验收</td>
                                <td class="font-medium dark:text-white">材料进场验收清单</td>
                                <td class="dark:text-gray-300"><span class="px-2 py-0.5 bg-gray-100 rounded text-xs dark:bg-gray-700">无密级</span></td>
                                <td class="text-gray-500 dark:text-gray-400 text-xs">2026-01-27 10:20</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                        <i class="fas fa-check-circle mr-1"></i>
                                        已通过
                                    </span>
                                </td>
                                <td class="text-center">
                                    <div class="flex items-center justify-center gap-2">
                                        <button onclick="previewFile(3)" class="text-gray-400 hover:text-primary dark:hover:text-blue-400" title="预览"><i class="fas fa-eye"></i></button>
                                        <button onclick="viewArchiveDetail(3)" class="text-success hover:text-green-700" title="查看归档详情"><i class="fas fa-folder-open"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <!-- 已拒绝状态 -->
                            <tr class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="sticky left-0 bg-white dark:bg-gray-800 z-10">
                                    <input type="checkbox" class="file-list-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="4" data-status="rejected" onchange="updateFileListBatchCount()">
                                </td>
                                <td class="text-center font-medium text-gray-900 sticky left-10 bg-white dark:bg-gray-800 dark:text-white z-10">4</td>
                                <td class="dark:text-gray-300">
                                    <a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline text-xs">会议纪要_项目启动.pdf</a>
                                </td>
                                <td class="text-xs dark:text-gray-300">
                                    <span class="block font-medium">文书档案</span>
                                    <span class="text-gray-500">行政文书</span>
                                </td>
                                <td class="dark:text-gray-300">会议纪要</td>
                                <td class="font-medium dark:text-white">项目启动会议纪要</td>
                                <td class="dark:text-gray-300"><span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs dark:bg-red-900 dark:text-red-200">秘密级</span></td>
                                <td class="text-gray-500 dark:text-gray-400 text-xs">2026-01-26 09:15</td>
                                <td>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                                        <i class="fas fa-times-circle mr-1"></i>
                                        已拒绝
                                    </span>
                                </td>
                                <td class="text-center">
                                    <div class="flex items-center justify-center gap-2">
                                        <button onclick="editFile(4)" class="text-gray-400 hover:text-primary dark:hover:text-blue-400" title="编辑"><i class="fas fa-edit"></i></button>
                                        <button onclick="submitSingleFile(4)" class="text-success hover:text-green-700" title="重新提交"><i class="fas fa-redo"></i></button>
                                        <button onclick="deleteFile(4)" class="text-danger hover:text-red-700" title="删除"><i class="fas fa-trash-alt"></i></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 统一分页控件 -->
                <div class="pagination-container flex-col sm:flex-row gap-4">
                    <div class="pagination-info text-center sm:text-left">
                        显示第 <span class="font-medium">1</span> 到 <span class="font-medium">4</span> 条，共 <span class="font-medium">12</span> 条
                    </div>
                    <div class="flex items-center gap-4 flex-wrap justify-center">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600 dark:text-gray-400">每页显示</span>
                            <select class="pagination-select" onchange="changePageSize(this.value)">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <span class="text-sm text-gray-600 dark:text-gray-400">条</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 电子档案台账列表页（按Excel调整字段）- 筛选条件移至表头下方 -->
        <div id="page-archive-ledger" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">

            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">电子文件台账</h2>
                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">查询、浏览已审批通过的电子文件（所有字段仅展示）</p>
                </div>
                <div class="flex gap-3">
                    <!-- <button class="px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">
                        <i class="fas fa-download mr-2"></i>导出台账
                    </button> -->
                </div>
            </div>

            <!-- 列表字段按Excel要求展示 - 筛选条件在表头下方 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden dark:bg-gray-800 dark:border-gray-700">
                <div class="px-4 md:px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gray-50 gap-2 dark:bg-gray-800 dark:border-gray-700">
                    <!-- <span class="text-sm text-gray-500 dark:text-gray-400">2 1-15,234 条，共 15,234 条</span> -->
                    <div class="flex gap-2">
                        <button class="px-3 py-1.5 text-sm text-gray-600 border border-gray-300 rounded hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">
                            <i class="fas fa-download mr-1"></i>导出
                        </button>
                    </div>
                </div>
                <div class="table-container mobile-scroll-x">
                    <table class="data-table text-xs" id="ledger-table">
                        <thead>
                            <tr class="header-filter">
                                <th style="position: sticky;left: 0;" class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 " >序号</th>

                                <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">来源申请单编号<div class="resize-handle"></div></th>
                                <th>档案编号<div class="resize-handle"></div></th>
                                <th>文号<div class="resize-handle"></div></th>
                                <th>归档状态<div class="resize-handle"></div></th>
                                <th>档案分类<div class="resize-handle"></div></th>
                                <th>资料类型<div class="resize-handle"></div></th>
                                <th>题名<div class="resize-handle"></div></th>
                                <th>责任者<div class="resize-handle"></div></th>
                                <th>成文日期<div class="resize-handle"></div></th>
                                <th>年度<div class="resize-handle"></div></th>
                               <th>是否应归实体档案<div class="resize-handle"></div></th>
                                <th>密级<div class="resize-handle"></div></th>
                                <th>保管期限<div class="resize-handle"></div></th>
                                <th>所属项目<div class="resize-handle"></div></th>
                                <th>所属管理组织<div class="resize-handle"></div></th>
                                <th>所属大区<div class="resize-handle"></div></th>
                                <th>所属区域<div class="resize-handle"></div></th>
                                <th>所属法人<div class="resize-handle"></div></th>
                                <th>上传人<div class="resize-handle"></div></th>
                                <th>文件审批通过日期<div class="resize-handle"></div></th>
                            </tr>
                            <!-- 筛选条件行 -->
                            <tr class="header-filter">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">-</td>

                                <td ><input type="text" placeholder="搜索编号"></td>
                                <td><input type="text" placeholder="档案编号"></td>
                                <td><input type="text" placeholder="文号"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>待归档</option>
                                        <option>已归档</option>
                                        <option>无需归档</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>科技档案/基建档案/施工资料</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option>全部</option>
                                        <option>施工组织设计</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="关键词"></td>
                                <td><input type="text" placeholder="责任者"></td>
                                <td><input type="text" placeholder="日期"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option>全部</option>
                                        <option>2026</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option>全部</option>
                                        <option>无密级</option>
                                        <option>秘密级</option>
                                        <option>机密级</option>
                                        <option>绝密级</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option>全部</option>
                                        <option>永久</option>
                                        <option>30年</option>
                                        <option>10年</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option>全部</option>
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="项目名称"></td>
                                <td><select class="dark:bg-gray-700"><option>全部</option></select></td>
                                <td><select class="dark:bg-gray-700"><option>全部</option></select></td>
                                <td><select class="dark:bg-gray-700"><option>全部</option></select></td>
                                <td><select class="dark:bg-gray-700"><option>全部</option></select></td>
                                <td><input type="text" placeholder="上传人"></td>
                                <td><input type="text" placeholder="日期"></td>
                            </tr>
                        </thead>
                        <tbody>
      
                            <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000001</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>
    <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000002</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>    <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000003</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>    <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000004</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>    <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000005</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>
                            </tr>  <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000006</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>
                            </tr>
                            <tr class="hover:bg-blue-50 transition cursor-pointer dark:hover:bg-blue-900/20" onclick="viewLedgerDetail(this)">
                              <td class="text-center sticky left-0 z-30 bg-gray-50 dark:bg-gray-800">2</td>
                                <td class="">20260128-G001-000001</td>
                                <td class="font-medium text-primary">KJT-2026-000007</td>
                                <td class="text-gray-600 dark:text-gray-400">XXXXXXXXXX00001</td>
                                <td><span class="text-success">待归档</span></td>
                                <td class="dark:text-gray-300">科技档案/基建档案/施工资料</td>
                                <td class="dark:text-gray-300">施工组织设计</td>
                                <td class="max-w-[150px] truncate dark:text-white" title="施工技术方案_主体结构施工">施工技术方案_主体结构施工</td>
                                <td class="dark:text-gray-300">南京某建筑公司</td>
                                <td class="dark:text-gray-300">2026-01-20</td>
                                <td class="dark:text-gray-300">2026</td>
                                <td><span class="px-2 py-0.5 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300">无密级</span></td>
                                <td class="dark:text-gray-300">永久</td>
                                <td class="dark:text-gray-300">是</td>
                                <td class="dark:text-gray-300">成都某水厂改扩建项目</td>
                                <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                                <td class="dark:text-gray-300">东部大区</td>
                                <td class="dark:text-gray-300">枣庄区域公司</td>
                                <td class="dark:text-gray-300">北控水务发展有限公司</td>
                                <td class="dark:text-gray-300">张三</td>
                                <td class="dark:text-gray-300">2026-01-28</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-container flex-col sm:flex-row gap-4">
                    <div class="pagination-info text-center sm:text-left">
                        显示第 <span class="font-medium">1</span> 到 <span class="font-medium">1</span> 条，共 <span class="font-medium">15,234</span> 条
                    </div>
                    <div class="flex items-center gap-4 flex-wrap justify-center">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600 dark:text-gray-400">每页显示</span>
                            <select class="pagination-select" onchange="changePageSize(this.value)">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span class="text-sm text-gray-600 dark:text-gray-400">条</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 电子档案详情页（按Excel调整字段，只读） -->
        <div id="page-ledger-detail" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('archive-ledger')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">电子文件详情</h2>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">文件编号：KJT-2026-J2026011401-000001</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="showPage('archive-detail-archived')" class="px-4 md:px-5 py-2 md:py-2.5 border border-primary text-primary rounded-lg font-medium hover:bg-blue-50 transition flex items-center gap-2 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-link"></i>联查上传申请单
                    </button>
                    <button onclick="openPreview()" class="px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 transition flex items-center gap-2 text-sm md:text-base">
                        <i class="fas fa-eye"></i>在线预览
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                <!-- 按Excel字段重新分组展示 -->

                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center gap-2 dark:text-white dark:border-gray-700">
                    <i class="fas fa-file-invoice text-primary"></i>
                    档案来源信息
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-y-4 gap-x-6 text-sm mb-6">
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">来源申请单编号</span><a href="#" onclick="showPage('archive-detail-archived'); return false;" class="font-medium text-primary hover:underline">20260128-G001-000001</a></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案编号</span><span class="font-medium text-gray-900 dark:text-white">KJT-2026-000001</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">文件编号</span><span class="font-medium text-gray-900 dark:text-white">20260128-G001-000001-0001</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">归档状态</span><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs dark:bg-green-900 dark:text-green-200">待归档</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案上传方式</span><span class="font-medium text-gray-900 dark:text-white">手工录入移交</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案来源</span><span class="font-medium text-gray-900 dark:text-white">非结构化数据统一服务</span></div>
                </div>

                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center gap-2 dark:text-white dark:border-gray-700">
                    <i class="fas fa-folder-open text-primary"></i>
                    档案分类信息
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-y-4 gap-x-6 text-sm mb-6">
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案一级分类</span><span id="detail-category-1" class="font-medium text-gray-900 dark:text-white">科技档案</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案二级分类</span><span id="detail-category-2" class="font-medium text-gray-900 dark:text-white">基建档案</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案三级分类</span><span id="detail-category-3" class="font-medium text-gray-900 dark:text-white">施工资料</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">资料类型</span><span id="detail-category-type" class="font-medium text-gray-900 dark:text-white">施工组织设计</span></div>
                </div>

                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center gap-2 dark:text-white dark:border-gray-700">
                    <i class="fas fa-project-diagram text-primary"></i>
                    项目与组织信息
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-y-4 gap-x-6 text-sm mb-6">
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属项目</span><span class="font-medium text-gray-900 dark:text-white">成都某水厂改扩建项目</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属项目编码</span><span class="font-medium text-gray-900 dark:text-white">J2026011401</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属项目分类名称</span><span class="font-medium text-gray-900 dark:text-white">城镇污水</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属项目分类编码</span><span class="font-medium text-gray-900 dark:text-white">CZWS</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属项目业态</span><span class="font-medium text-gray-900 dark:text-white">水务运营</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属项目投资模式</span><span class="font-medium text-gray-900 dark:text-white">TOT</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属管理组织</span><span class="font-medium text-gray-900 dark:text-white">枣庄台儿庄区污水处理厂</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属管理组织编码</span><span class="font-medium text-gray-900 dark:text-white">ORG001</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属大区/事业部</span><span class="font-medium text-gray-900 dark:text-white">东部大区</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属区域/水司</span><span class="font-medium text-gray-900 dark:text-white">枣庄区域公司</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属法人组织</span><span class="font-medium text-gray-900 dark:text-white">北控水务发展有限公司</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">所属法人组织编码</span><span class="font-medium text-gray-900 dark:text-white">FR001</span></div>
                </div>

                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center gap-2 dark:text-white dark:border-gray-700">
                    <i class="fas fa-file-alt text-primary"></i>
                    档案内容信息
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-y-4 gap-x-6 text-sm mb-6">
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">题名</span><a href="#" onclick="openPreview(); return false;" class="font-medium text-primary hover:underline">施工技术方案_主体结构施工</a></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">责任者</span><span class="font-medium text-gray-900 dark:text-white">南京某建筑公司</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">文号</span><span class="font-medium text-gray-900 dark:text-white">施组-2026-001</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">密级</span><span class="font-medium text-gray-900 dark:text-white">无密级</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">页数</span><span class="font-medium text-gray-900 dark:text-white">45</span></div>
                    <!-- <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">归档份数</span><span class="font-medium text-gray-900 dark:text-white">1</span></div> -->
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">成文日期</span><span class="font-medium text-gray-900 dark:text-white">2026-01-20</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">年度</span><span class="font-medium text-gray-900 dark:text-white">2026</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">保管期限</span><span class="font-medium text-gray-900 dark:text-white">永久</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">文件数据状态</span><span class="font-medium text-gray-900 dark:text-white">启用</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">是否应归实体档案</span><span class="font-medium text-gray-900 dark:text-white">是</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">载体</span><span class="font-medium text-gray-900 dark:text-white">电子档案</span></div>
                    <!-- <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">卷内顺序</span><span class="font-medium text-gray-900 dark:text-white">0001</span></div> -->

                </div>

                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center gap-2 dark:text-white dark:border-gray-700">
                    <i class="fas fa-clock text-primary"></i>
                    日期信息
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-y-4 gap-x-6 text-sm mb-6">
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">文件审批通过日期</span><span class="font-medium text-gray-900 dark:text-white">2026-01-28</span></div>
                    <!-- <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案移交日期</span><span class="font-medium text-gray-900 dark:text-white">2026-01-28</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案接收日期</span><span class="font-medium text-gray-900 dark:text-white">2026-01-28</span></div> -->
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">文件上传日期</span><span class="font-medium text-gray-900 dark:text-white">2026-01-28</span></div>
                    <!-- <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">档案结束日期</span><span class="font-medium text-gray-900 dark:text-white">9999-12-31</span></div> -->
                </div>

                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center gap-2 dark:text-white dark:border-gray-700">
                    <i class="fas fa-link text-primary"></i>
                    关联会议信息
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-y-4 gap-x-6 text-sm">
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">关联会议名称</span><span class="font-medium text-gray-900 dark:text-white">项目启动会</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">关联会议议题编码</span><span class="font-medium text-gray-900 dark:text-white">MT2026012801</span></div>
                    <div><span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">关联会议议题名称</span><span class="font-medium text-gray-900 dark:text-white">施工方案确认</span></div>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2 dark:text-white">
                        <i class="fas fa-hdd text-primary"></i>
                        存储信息
                    </h3>
                    <div class="grid grid-cols-1 gap-4 mb-4">
                        <div>
                            <span class="text-gray-500 block text-xs mb-1 dark:text-gray-400">附件名称</span>
                            <a href="#" onclick="openPreview(); return false;" class="font-medium text-primary hover:underline">施工技术方案_主体结构施工.pdf</a>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 font-mono text-sm text-gray-700 break-all dark:bg-gray-700 dark:text-gray-300">
                        文件存储位置-电子：/archive/2026/kj/j2026011401/550e8400-e29b-41d4-a716-446655440000.pdf
                    </div>
                </div>
            </div>
        </div>

        <!-- 档案分类管理（增加状态、更新人、更新时间、导入按钮）- 筛选条件移至表头下方 -->
        <div id="page-archive-config" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">档案分类管理</h2>
                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">维护档案一级、二级、三级分类体系（含启用状态及更新记录）</p>
                </div>
                <div class="flex gap-2 md:gap-3 flex-wrap">
                    <button class="px-3 md:px-4 py-2 md:py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        <i class="fas fa-download mr-2"></i>导出
                    </button>
                    <button class="px-3 md:px-4 py-2 md:py-2.5 border border-primary text-primary rounded-lg font-medium hover:bg-blue-50 transition dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-upload mr-2"></i>导入
                    </button>
                    <button onclick="openAddCategoryModal()" class="px-3 md:px-4 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-plus"></i>新增分类
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border-gray-200 overflow-hidden dark:bg-gray-800 dark:border-gray-700">
                <!-- <div class="p-4 border-b border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gray-50 gap-2 dark:bg-gray-800 dark:border-gray-700"> -->
                    <!-- <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider dark:text-gray-500">分类树</div> -->
                    <!-- <div class="flex gap-2"> -->
                        <!-- <button class="px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700">全22部展开</button>
                        <button class="px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700">全部折叠</button> -->
                    <!-- </div> -->
                <!-- </div> -->

                <div class="table-container mobile-scroll-x">
                    <table class="data-table" id="category-table">
                        <thead>
                            <tr>
                                <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                                <th>分类编码<div class="resize-handle"></div></th>
                                <th>分类代号<div class="resize-handle"></div></th>
                                <th>分类名称<div class="resize-handle"></div></th>
                                <th>分类层级<div class="resize-handle"></div></th>
                                <th>父级分类<div class="resize-handle"></div></th>
                                <th>是否关联项目<div class="resize-handle"></div></th>
                                <th>关联项目分类<div class="resize-handle"></div></th>
                                <th>启用状态<div class="resize-handle"></div></th>
                                <th>更新人<div class="resize-handle"></div></th>
                                <th>更新时间<div class="resize-handle"></div></th>
                            </tr>
                            <!-- 筛选条件行 -->
                            <tr class="header-filter">
                                <td style="position: sticky;left: 0;" class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800"><input type="text" placeholder="序号"></td>
                                <td><input type="text" placeholder="分类Id"></td>
                                <td><input type="text" placeholder="代号"></td>
                                <td><input type="text" placeholder="名称"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>一级</option>
                                        <option>二级</option>
                                        <option>三级</option>
                                    </select>
                                </td>
                                <td><select class="dark:bg-gray-700"><option value="">全部</option></select></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="项目分类"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>启用</option>
                                        <option>停用</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="更新人"></td>
                                <td><input type="text" placeholder="时间"></td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-id="1" onclick="openCategoryDetailModal(this)" class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="font-mono text-gray-900 sticky left-0 bg-white dark:bg-gray-800 z-10 dark:text-white">1</td>
                                <td class="font-mono text-xs text-gray-600 dark:text-gray-400">KJ</td>
                                <td class="font-mono text-gray-900 dark:text-white">KJ</td>
                                <td class="font-medium text-gray-900 dark:text-white">
                                    <div class="flex items-center">
                                        <i class="fas fa-caret-down mr-2 text-gray-400 cursor-pointer" onclick="toggleTreeRow(this, event)"></i>
                                        <span>科技档案</span>
                                    </div>
                                </td>
                                <td><span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs dark:bg-green-900 dark:text-green-200">一级</span></td>
                                <td class="text-gray-500 dark:text-gray-400">-</td>
                                <td><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs dark:bg-blue-900 dark:text-blue-200">是</span></td>
                                <td class="text-xs dark:text-gray-300">主营业务项目/重资产项目/建设项目</td>
                                <td><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">启用</span></td>
                                <td class="text-gray-600 dark:text-gray-400">系统管理员</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-20 10:30:25</td>
                            </tr>
                            <tr data-parent-id="1" onclick="openCategoryDetailModal(this)" class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="font-mono text-gray-900 sticky left-0 bg-white dark:bg-gray-800 z-10 dark:text-white">1.1</td>
                                <td class="font-mono text-xs text-gray-600 dark:text-gray-400">KJ-T</td>
                                <td class="font-mono text-gray-900 dark:text-white">T</td>
                                <td class="font-medium text-gray-900 dark:text-white">
                                    <div class="flex items-center pl-6">
                                        <span>投资档案</span>
                                    </div>
                                </td>
                                <td><span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs dark:bg-green-900 dark:text-green-200">二级</span></td>
                                <td class="text-gray-500 dark:text-gray-400">科技档案</td>
                                <td><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs dark:bg-blue-900 dark:text-blue-200">是</span></td>
                                <td class="text-xs dark:text-gray-300">主营业务项目/重资产项目/建设项目</td>
                                <td><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">禁用</span></td>
                                <td class="text-gray-600 dark:text-gray-400">系统管理员</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-20 10:30:25</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-container flex-col sm:flex-row gap-4">
                    <div class="pagination-info text-center sm:text-left">
                        显示第 <span class="font-medium">1</span> 到 <span class="font-medium">5</span> 条，共 <span class="font-medium">5</span> 条
                    </div>
                    <div class="flex items-center gap-4 flex-wrap justify-center">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600 dark:text-gray-400">每页显示</span>
                            <select class="pagination-select" onchange="changePageSize(this.value)">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <span class="text-sm text-gray-600 dark:text-gray-400">条</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 档案目录管理（增加状态、更新人、更新时间、导入按钮）- 筛选条件移至表头下方 -->
        <div id="page-archive-directory" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">档案目录管理</h2>
                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">根据档案分类层级，维护档案归档范围以及保管期限等信息（含启用状态）</p>
                </div>
                <div class="flex gap-2 md:gap-3 flex-wrap">
                    <button class="px-3 md:px-4 py-2 md:py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        <i class="fas fa-download mr-2"></i>导出
                    </button>
                    <button class="px-3 md:px-4 py-2 md:py-2.5 border border-primary text-primary rounded-lg font-medium hover:bg-blue-50 transition dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-upload mr-2"></i>导入
                    </button>
                    <button onclick="openAddDirectory()" class="px-3 md:px-4 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-plus"></i>新增目录
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden dark:bg-gray-800 dark:border-gray-700">
                <div class="table-container mobile-scroll-x">
                    <table class="data-table" id="directory-table">
                        <thead>
                            <tr>
                                <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                                <th>档案分类<div class="resize-handle"></div></th>
                                <th>资料类型<div class="resize-handle"></div></th>
                                <th>归档维度<div class="resize-handle"></div></th>
                                <th>档案密级<div class="resize-handle"></div></th>
                                <th>是否必有<div class="resize-handle"></div></th>
                                <th>条件必有说明<div class="resize-handle"></div></th>
                                <th>保管期限<div class="resize-handle"></div></th>
                                <th>是否关联项目<div class="resize-handle"></div></th>
                                <th>关联项目分类<div class="resize-handle"></div></th>
                                <th>档案载体<div class="resize-handle"></div></th>
                                <th>是否应归实体档案<div class="resize-handle"></div></th>
                                <th>归档里程碑<div class="resize-handle"></div></th>
                                <th>文件来源系统<div class="resize-handle"></div></th>
                                <th>是否经营事项考核<div class="resize-handle"></div></th>
                                <th>启用状态<div class="resize-handle"></div></th>
                                <th>更新人<div class="resize-handle"></div></th>
                                <th>更新时间<div class="resize-handle"></div></th>
                            </tr>
                            <!-- 筛选条件行 -->
                            <tr class="header-filter">
                                <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;"><input type="text" placeholder="序号"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>科技档案-基建档案</option>
                                        <option>科技档案-投资档案</option>
                                        <option>文书档案-行政文书</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="资料名称"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>按项目</option>
                                        <option>按组织</option>
                                        <option>按时间</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>无密级</option>
                                        <option>秘密级</option>
                                        <option>机密级</option>
                                        <option>绝密级</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>必有</option>
                                        <option>或有</option>
                                        <option>条件必有</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="说明"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>永久</option>
                                        <option>30年</option>
                                        <option>10年</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="项目分类"></td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>电子档案</option>
                                        <option>纸质档案</option>
                                        <option>实体</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>投资项目移交</option>
                                        <option>交付项目开工</option>
                                        <option>无</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>招采系统</option>
                                        <option>合同系统</option>
                                        <option>产权系统</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="dark:bg-gray-700">
                                        <option value="">全部</option>
                                        <option>启用</option>
                                        <option>停用</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="更新人"></td>
                                <td><input type="text" placeholder="时间"></td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr onclick="showDirectoryDetail(this)" class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="text-center font-medium text-gray-900 sticky left-0 bg-white z-10 dark:bg-gray-800 dark:text-white">1</td>
                                <td class="text-xs">
                                    <span class="block font-medium dark:text-white">科技档案-基建档案</span>
                                    <span class="text-gray-500 dark:text-gray-400">施工资料</span>
                                </td>
                                <td class="font-medium text-gray-900 dark:text-white">施工组织设计</td>
                                <td class="dark:text-gray-300">按项目</td>
                                <td class="dark:text-gray-300">秘密级</td>
                                <td><span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs dark:bg-red-900 dark:text-red-200">必有</span></td>
                                <td class="text-xs dark:text-gray-400">无</td>
                                <td class="dark:text-gray-300">永久</td>
                                <td><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs dark:bg-blue-900 dark:text-blue-200">是</span></td>
                                <td class="text-xs dark:text-gray-400">主营业务项目/重资产项目</td>
                                <td class="dark:text-gray-300">电子档案/纸质档案</td>
                                <td><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs dark:bg-blue-900 dark:text-blue-200">是</span></td>
                                <td class="dark:text-gray-300">交付项目开工</td>
                                <td class="dark:text-gray-300">OA系统</td>
                                <td><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs dark:bg-blue-900 dark:text-blue-200">是</span></td>
                                <td><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">启用</span></td>
                                <td class="text-gray-600 dark:text-gray-400">张三</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-01-28 10:30:25</td>
                            </tr>
                            <tr onclick="showDirectoryDetail(this)" data-archive-level="集团/大区/区域" data-archive-rule="完成客户识别后" class="hover:bg-blue-50 transition dark:hover:bg-blue-900/20">
                                <td class="text-center font-medium text-gray-900 sticky left-0 bg-white z-10 dark:bg-gray-800 dark:text-white">2</td>
                                <td class="text-xs">
                                    <span class="block font-medium dark:text-white">文书档案-市场投资管理</span>
                                    <span class="text-gray-500 dark:text-gray-400">市场与客户管理</span>
                                </td>
                                <td class="font-medium text-gray-900 dark:text-white">客户信息</td>
                                <td class="dark:text-gray-300">按组织</td>
                                <td class="dark:text-gray-300">无密级</td>
                                <td><span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">或有</span></td>
                                <td class="text-xs dark:text-gray-400">无</td>
                                <td class="dark:text-gray-300">永久</td>
                                <td><span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">否</span></td>
                                <td class="text-xs dark:text-gray-400">-</td>
                                <td class="dark:text-gray-300">电子档案</td>
                                <td><span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">否</span></td>
                                <td class="dark:text-gray-300">无</td>
                                <td class="dark:text-gray-300">OA系统</td>
                                <td><span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">否</span></td>
                                <td><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">启用</span></td>
                                <td class="text-gray-600 dark:text-gray-400">张三</td>
                                <td class="text-gray-500 dark:text-gray-400">2026-02-11 10:30:25</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 统一分页控件 -->
                <div class="pagination-container flex-col sm:flex-row gap-4">
                    <div class="pagination-info text-center sm:text-left">
                        显示第 <span class="font-medium">1</span> 到 <span class="font-medium">3</span> 条，共 <span class="font-medium">3</span> 条
                    </div>
                    <div class="flex items-center gap-4 flex-wrap justify-center">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600 dark:text-gray-400">每页显示</span>
                            <select class="pagination-select" onchange="changePageSize(this.value)">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <span class="text-sm text-gray-600 dark:text-gray-400">条</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 权限管理页面（按规则重新设计） -->
        <div id="page-permission" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">权限管理</h2>
                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">配置用户的数据访问范围、档案分类权限及密级访问上限</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="savePermission()" class="px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-save"></i>保存权限配置
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6">
                <!-- 左侧用户列表 -->
                <div class="lg:col-span-4 bg-white rounded-xl shadow-sm border border-gray-200 dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="font-semibold text-gray-900 dark:text-white">用户列表</h3>
                        <span class="text-xs bg-primary text-white px-2 py-0.5 rounded-full">156人</span>
                    </div>
                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                        <div class="relative">
                            <input type="text" placeholder="搜索用户姓名..." class="w-full border border-gray-300 rounded-lg pl-9 pr-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <div class="overflow-y-auto max-h-[400px] md:max-h-[600px]">
                        <div class="divide-y divide-gray-100 dark:divide-gray-700">
                            <div class="p-4 hover:bg-blue-50 cursor-pointer transition bg-blue-50 border-l-4 border-primary dark:hover:bg-blue-900/20 dark:bg-blue-900/10">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-semibold text-sm">李</div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-semibold text-gray-900 truncate dark:text-white">李明</p>
                                        <p class="text-xs text-gray-500 truncate dark:text-gray-400">东部大区-档案管理员</p>
                                    </div>
                                </div>
                                <div class="mt-2 flex gap-2">
                                    <span class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded dark:bg-green-900 dark:text-green-200">在岗</span>
                                </div>
                            </div>

                            <div class="p-4 hover:bg-blue-50 cursor-pointer transition dark:hover:bg-blue-900/20">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-semibold text-sm dark:bg-gray-700 dark:text-gray-300">王</div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-semibold text-gray-900 truncate dark:text-white">王芳</p>
                                        <p class="text-xs text-gray-500 truncate dark:text-gray-400">南部大区-区域档案专员</p>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 hover:bg-blue-50 cursor-pointer transition dark:hover:bg-blue-900/20">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-semibold text-sm dark:bg-gray-700 dark:text-gray-300">张</div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-semibold text-gray-900 truncate dark:text-white">张强</p>
                                        <p class="text-xs text-gray-500 truncate dark:text-gray-400">集团档案管理岗</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 中间和右侧：权限配置 -->
                <div class="lg:col-span-8 space-y-4 md:space-y-6">

                    <!-- 1. 管理组织权限 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center text-primary dark:bg-blue-900 dark:text-blue-400">
                                    <i class="fas fa-sitemap text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-base md:text-lg font-semibold text-gray-900 dark:text-white">管理组织权限</h3>
                                    <p class="text-sm text-gray-500 mt-0.5 dark:text-gray-400">分配用户可访问的管理组织范围，自动继承所选组织及其所有下级组织</p>
                                </div>
                            </div>
                        </div>

                        <!-- 全局控制开关 -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 dark:bg-blue-900/20 dark:border-blue-800">
                            <h4 class="text-sm font-semibold text-blue-900 mb-2 flex items-center gap-2 dark:text-blue-200"><i class="fas fa-lightbulb"></i>权限继承规则说明</h4>
                            <ul class="text-sm text-blue-800 space-y-1 list-disc list-inside dark:text-blue-200">
                                <li>勾选父级组织后，自动拥有该组织及其<strong>所有下级组织</strong>的数据访问权限</li>
                                <li>分配多个组织时，权限范围为这些组织及其下级组织的<strong>并集</strong></li>
                            </ul>
                        </div>

                        <div class="border border-gray-200 rounded-lg p-4 max-h-[300px] overflow-y-auto dark:border-gray-700">
                            <div class="space-y-2">
                                <div class="flex items-start gap-3 p-2 hover:bg-gray-50 rounded-lg transition dark:hover:bg-gray-700">
                                    <input type="checkbox" checked class="mt-1 w-4 h-4 text-primary rounded focus:ring-primary" onchange="toggleChildOrgs(this, 'east')">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2">
                                            <span class="level-indicator level-1"></span>
                                            <span class="font-medium text-gray-900 dark:text-white">东部大区</span>
                                            <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded dark:bg-blue-900 dark:text-blue-200">一级</span>
                                        </div>

                                        <div class="org-tree-line mt-2 space-y-2" id="east-children">
                                            <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg transition dark:hover:bg-gray-700">
                                                <input type="checkbox" checked class="w-4 h-4 text-primary rounded focus:ring-primary">
                                                <div>
                                                    <div class="flex items-center gap-2">
                                                        <span class="level-indicator level-2"></span>
                                                        <span class="text-sm font-medium text-gray-800 dark:text-gray-200">南京区域公司</span>
                                                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded dark:bg-gray-700 dark:text-gray-400">二级</span>
                                                    </div>
                                                    <div class="org-tree-line mt-1 space-y-1">
                                                        <div class="flex items-center gap-3 p-1 text-sm text-gray-600 dark:text-gray-400">
                                                            <i class="fas fa-building text-xs text-gray-400"></i>
                                                            <span>南京某水司（三级）</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg transition dark:hover:bg-gray-700">
                                                <input type="checkbox" checked class="w-4 h-4 text-primary rounded focus:ring-primary">
                                                <div class="flex items-center gap-2">
                                                    <span class="level-indicator level-2"></span>
                                                    <span class="text-sm font-medium text-gray-800 dark:text-gray-200">枣庄区域公司</span>
                                                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded dark:bg-gray-700 dark:text-gray-400">二级</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex items-start gap-3 p-2 hover:bg-gray-50 rounded-lg transition dark:hover:bg-gray-700">
                                    <input type="checkbox" class="mt-1 w-4 h-4 text-primary rounded focus:ring-primary">
                                    <div class="flex items-center gap-2">
                                        <span class="level-indicator level-1"></span>
                                        <span class="font-medium text-gray-900 dark:text-white">南部大区</span>
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded dark:bg-blue-900 dark:text-blue-200">一级</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 档案分类权限 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600 dark:bg-purple-900 dark:text-purple-400">
                                    <i class="fas fa-folder-tree text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-base md:text-lg font-semibold text-gray-900 dark:text-white">档案分类权限</h3>
                                    <p class="text-sm text-gray-500 mt-0.5 dark:text-gray-400">配置用户可查看的档案分类范围，支持全局授权或分级授权</p>
                                </div>
                            </div>
                        </div>

                        <!-- 全局控制开关 -->
                        <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4 mb-4 dark:from-purple-900/20 dark:to-blue-900/20 dark:border-purple-800">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="global-archive-check" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500" onchange="toggleGlobalArchive(this)">
                                    <div>
                                        <label for="global-archive-check" class="font-semibold text-purple-900 cursor-pointer dark:text-purple-200">可查看所有档案分类数据（全局授权）</label>
                                        <p class="text-sm text-purple-700 mt-1 dark:text-purple-300">勾选后，用户自动拥有当前系统内所有及未来新增的所有档案分类权限，无需人工维护</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 分级授权区域 -->
                        <div id="archive-level-auth" class="border border-gray-200 rounded-lg p-4 dark:border-gray-700">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4 dark:bg-yellow-900/20 dark:border-yellow-800">
                                <h4 class="text-sm font-semibold text-yellow-900 mb-1 flex items-center gap-2 dark:text-yellow-200"><i class="fas fa-exclamation-triangle"></i>授权规则说明</h4>
                                <ul class="text-xs text-yellow-800 space-y-1 list-disc list-inside dark:text-yellow-200">
                                    <li><strong>按一级分类授权</strong>：拥有该一级分类下<strong>当前已存在</strong>的所有二级分类权限，但<strong>不会自动获得</strong>后续新增的二级分类（需手动维护）</li>
                                    <li><strong>按二级分类授权</strong>：仅拥有勾选的特定二级分类权限</li>
                                    <li>设置多个分类时，权限范围取<strong>并集</strong></li>
                                </ul>
                            </div>

                            <div class="space-y-3">
                                <!-- 科技档案 -->
                                <div class="border border-gray-200 rounded-lg p-3 hover:border-purple-300 transition dark:border-gray-700">
                                    <div class="flex items-start gap-3">
                                        <input type="checkbox" checked class="mt-1 w-4 h-4 text-purple-600 rounded focus:ring-purple-500" onchange="toggleLevel2(this, 'kj')">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-2">
                                                <span class="level-indicator level-1"></span>
                                                <span class="font-semibold text-gray-900 dark:text-white">科技档案</span>
                                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded dark:bg-purple-900 dark:text-purple-200">一级分类</span>
                                                <span class="text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded border border-green-200 dark:bg-green-900 dark:text-green-200 dark:border-green-800"><i class="fas fa-check-circle mr-1"></i>已授权</span>
                                            </div>

                                            <div class="org-tree-line space-y-2" id="kj-level2">
                                                <div class="flex items-center gap-3 p-2 bg-purple-50 rounded border border-purple-100 dark:bg-purple-900/20 dark:border-purple-800">
                                                    <input type="checkbox" checked class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500" disabled>
                                                    <div class="flex items-center gap-2 flex-1">
                                                        <span class="level-indicator level-2"></span>
                                                        <span class="text-sm font-medium text-gray-800 dark:text-gray-200">基建档案</span>
                                                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded dark:bg-gray-700 dark:text-gray-400">二级</span>
                                                    </div>
                                                </div>

                                                <div class="flex items-center gap-3 p-2 bg-gray-50 rounded border border-gray-200 opacity-60 dark:bg-gray-800 dark:border-gray-700">
                                                    <input type="checkbox" class="w-4 h-4 text-gray-400 rounded">
                                                    <div class="flex items-center gap-2 flex-1">
                                                        <span class="level-indicator level-2" style="background:#cbd5e1"></span>
                                                        <span class="text-sm text-gray-600 dark:text-gray-400">运营档案（新增）</span>
                                                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded dark:bg-orange-900 dark:text-orange-200">未授权</span>
                                                    </div>
                                                    <button class="text-xs text-primary hover:underline dark:text-blue-400">授权</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>

        <!-- 审批中心占位页 -->
        <div id="page-approval-center" class="hidden fade-in p-4 md:p-6">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 dark:bg-gray-800 dark:border-gray-700">
                <div class="text-center py-20 text-gray-400">
                    <i class="fas fa-check-circle text-6xl mb-4 text-gray-300 dark:text-gray-600"></i>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2 dark:text-white">审批中心</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">待办审批事项将在此处展示</p>
                </div>
            </div>
        </div>

        <!-- 档案目录新增页 -->
        <div id="page-archive-directory-new" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('archive-directory')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"><i class="fas fa-arrow-left text-xl"></i></button>
                    <div>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">新增档案目录</h2>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">维护档案分类对应的归档范围和保管期限标准</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button id="cancel-btn-detail" onclick="showPage('archive-directory')" class="px-4 md:px-5 py-2 md:py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">取消</button>
                    <button id="edit-btn-detail" onclick="enableEditMode()" class="hidden px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base"><i class="fas fa-edit"></i>编辑</button>
                    <button onclick="saveDirectory()" class="px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base"><i class="fas fa-save"></i>保存</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-6 border-b border-gray-200 pb-4 dark:text-white dark:border-gray-700">目录基本信息</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                    <div class="col-span-1 sm:col-span-2 lg:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">档案分类 <span class="text-danger">*</span></label>
                        <div class="cascader-container" id="directory-cascader">
                            <div class="cascader-input" onclick="toggleCascader('directory-cascader')">
                                <span id="directory-cascader-text">请选择</span>
                                <i class="fas fa-chevron-down text-gray-400"></i>
                            </div>
                            <div class="cascader-dropdown">
                                <div class="cascader-menu">
                                    <div class="cascader-column" id="directory-cascader-level1">
                                        <div class="cascader-item" onclick="selectDirectoryCascader(1, '科技档案', this)">
                                            科技档案 <i class="fas fa-chevron-right"></i>
                                        </div>
                                        <div class="cascader-item" onclick="selectDirectoryCascader(1, '文书档案', this)">
                                            文书档案 <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="cascader-column" id="directory-cascader-level2">
                                        <!-- 动态填充 -->
                                    </div>
                                    <div class="cascader-column" id="directory-cascader-level3">
                                        <!-- 动态填充 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">资料类型 <span class="text-danger">*</span></label>
                        <input type="text" placeholder="请输入资料名称" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">业务含义</label>
                        <input type="text" placeholder="描述业务含义" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">归档层级</label>
                        <div class="cascader-container" id="archive-level-cascader">
                            <div class="cascader-input flex flex-wrap items-center gap-1 min-h-[38px] h-auto py-1" onclick="toggleCascader('archive-level-cascader')">
                                <span id="archive-level-placeholder" class="text-gray-400 text-sm">请选择归档层级</span>
                                <div id="archive-level-tags" class="flex flex-wrap gap-1 hidden"></div>
                                <i class="fas fa-chevron-down text-gray-400 ml-auto"></i>
                            </div>
                            <div class="cascader-dropdown">
                                <div class="cascader-column" id="archive-level-options" style="min-width: 200px;">
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectArchiveLevelMulti('集团', this)">
                                        <input type="checkbox" class="mr-2 archive-level-checkbox" value="集团" onclick="event.stopPropagation()"> 集团
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectArchiveLevelMulti('大区', this)">
                                        <input type="checkbox" class="mr-2 archive-level-checkbox" value="大区" onclick="event.stopPropagation()"> 大区
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectArchiveLevelMulti('区域', this)">
                                        <input type="checkbox" class="mr-2 archive-level-checkbox" value="区域" onclick="event.stopPropagation()"> 区域
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectArchiveLevelMulti('项目公司', this)">
                                        <input type="checkbox" class="mr-2 archive-level-checkbox" value="项目公司" onclick="event.stopPropagation()"> 项目公司
                                    </div>
                                </div>
                                <div class="border-t border-gray-200 p-2 flex justify-end gap-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700">
                                    <button onclick="event.stopPropagation(); toggleCascader('archive-level-cascader')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
                                    <button onclick="event.stopPropagation(); confirmArchiveLevelMulti()" class="px-3 py-1 text-sm bg-primary text-white rounded hover:bg-blue-700">确定</button>
                                </div>
                            </div>
                        </div>
                        <select id="archive-level-select" multiple class="hidden">
                            <option>集团</option>
                            <option>大区</option>
                            <option>区域</option>
                            <option>项目公司</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">归档维度 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option>按项目</option>
                            <option>按组织</option>
                            <option>按时间</option>
                        </select>
                    </div>
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">归档规则</label>
                        <input type="text" placeholder="描述归档规则" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
  <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">档案密级 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option>无密级</option>
                            <option>秘密级</option>
                            <option>机密级</option>
                            <option>绝密级</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否必有 <span class="text-danger">*</span></label>
                        <select id="is-required-select" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="toggleConditionList()">
                            <option value="must">必有</option>
                            <option value="optional">或有</option>
                            <option value="conditional">条件必有</option>
                        </select>
                    </div> 
            <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">条件必有说明</label>
                        <input type="text" placeholder="描述条件必有说明" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                 

                    <!-- 条件必有条件字段 - 默认不显示 -->
                    <!-- <div id="conditional-field" class="sm:col-span-2" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">条件必有条件</label>
                        <input type="text" placeholder="填写必有条件后自动生成" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400" readonly>
                    </div> -->

                    <!-- 必有条件列表 - 条件必有时显示 -->
                    <!-- <div id="condition-list-section" class="hidden col-span-1 sm:col-span-2 lg:col-span-3 mt-4">
                        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-gray-900 dark:text-white">必有条件列表</h4>
                                <button onclick="addConditionRow()" class="px-3 py-1.5 bg-primary text-white rounded-lg text-sm hover:bg-blue-700 transition">
                                    <i class="fas fa-plus mr-1"></i>添加条件
                                </button>
                            </div>
                            <div class="table-container mobile-scroll-x">
                                <table class="data-table text-sm border-collapse border border-gray-200 dark:border-gray-600">
                                    <thead>
                                        <tr>
                                            <th>条件字段 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                            <th>条件值 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                            <th>必有类型 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                            <th>备注<div class="resize-handle"></div></th>
                                            <th>操作<div class="resize-handle"></div></th>
                                        </tr>
                                    </thead>
                                    <tbody id="condition-list-body">
                                        <tr>
                                            <td class="px-3 py-2 border dark:border-gray-600">
                                                <select class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                    <option value="">请选择</option>
                                                    <option value="invest">投资模式</option>
                                                    <option value="business">项目业态</option>
                                                    <option value="case">案件类型</option>
                                                    <option value="major">是否重大案件</option>
                                                </select>
                                            </td>
                                            <td class="px-3 py-2 border dark:border-gray-600">
                                                <select class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                    <option value="">请选择</option>
                                                    <option value="code1">CODE001</option>
                                                    <option value="code2">CODE002</option>
                                                </select>
                                            </td>
                                            <td class="px-3 py-2 border dark:border-gray-600">
                                                <select class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                    <option value="must">必有</option>
                                                    <option value="optional">或有</option>
                                                </select>
                                            </td>
                                            <td class="px-3 py-2 border dark:border-gray-600">
                                                <input type="text" placeholder="请输入备注" class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            </td>
                                            <td class="px-3 py-2 border text-center dark:border-gray-600">
                                                <button onclick="removeConditionRow(this)" class="text-gray-400 hover:text-danger"><i class="fas fa-trash-alt"></i></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div> -->

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">保管期限 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option>永久</option>
                            <option>30年</option>
                            <option>10年</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否关联项目 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="toggleProjectCategory()">
                            <option>是</option>
                            <option>否</option>
                        </select>
                    </div>
 
                 <!-- 关联项目分类 - 三级联动多选 -->
                    <div id="project-category-field" class="col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">关联项目分类</label>
                        <div class="cascader-container" id="project-cascader-new">
                            <div class="cascader-input" onclick="toggleCascader('project-cascader-new')">
                                <span id="project-cascader-new-text">请选择项目分类</span>
                                <i class="fas fa-chevron-down text-gray-400"></i>
                            </div>
                            <div class="cascader-dropdown" style="min-width: 100%;">
                                <div class="cascader-menu" style="min-width: 500px;">
                                    <div class="cascader-column" id="project-cascader-new-level1" style="min-width: 150px;">
                                        <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('project-cascader-new', 1, '主营业务项目', this)">
                                            <input type="checkbox" class="mr-2" value="主营业务项目" onclick="event.stopPropagation()"> 主营业务项目
                                        </div>
                                        <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('project-cascader-new', 1, '专项项目', this)">
                                            <input type="checkbox" class="mr-2" value="专项项目" onclick="event.stopPropagation()"> 专项项目
                                        </div>
                                        <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('project-cascader-new', 1, '公共项目', this)">
                                            <input type="checkbox" class="mr-2" value="公共项目" onclick="event.stopPropagation()"> 公共项目
                                        </div>
                                    </div>
                                    <div class="cascader-column" id="project-cascader-new-level2" style="min-width: 150px;">
                                        <div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">请先选择一级分类</div>
                                    </div>
                                    <div class="cascader-column" id="project-cascader-new-level3" style="min-width: 150px;">
                                        <div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">请先选择二级分类</div>
                                    </div>
                                </div>
                                <div class="border-t border-gray-200 p-2 flex justify-end gap-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700">
                                    <button onclick="event.stopPropagation(); toggleCascader('project-cascader-new')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
                                    <button onclick="event.stopPropagation(); confirmProjectCategoryMulti('project-cascader-new')" class="px-3 py-1 text-sm bg-primary text-white rounded hover:bg-blue-700">确定</button>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">三级级联多选，支持选择多个项目分类</p>
                    </div>

                     <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">档案载体 <span class="text-danger">*</span></label>
                        <div class="cascader-container" id="carrier-cascader">
                            <div class="cascader-input flex flex-wrap items-center gap-1 min-h-[38px] h-auto py-1" onclick="toggleCascader('carrier-cascader')">
                                <span id="carrier-cascader-placeholder" class="text-gray-400 text-sm">请选择档案载体</span>
                                <div id="carrier-cascader-tags" class="flex flex-wrap gap-1 hidden"></div>
                                <i class="fas fa-chevron-down text-gray-400 ml-auto"></i>
                            </div>
                            <div class="cascader-dropdown">
                                <div class="cascader-column" id="carrier-cascader-level1" style="min-width: 200px;">
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectCarrierMulti('电子档案', this)">
                                        <input type="checkbox" class="mr-2 carrier-checkbox" value="电子档案" onclick="event.stopPropagation()"> 电子档案
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectCarrierMulti('纸质档案', this)">
                                        <input type="checkbox" class="mr-2 carrier-checkbox" value="纸质档案" onclick="event.stopPropagation()"> 纸质档案
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectCarrierMulti('实体', this)">
                                        <input type="checkbox" class="mr-2 carrier-checkbox" value="实体" onclick="event.stopPropagation()"> 实体
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectCarrierMulti('光盘', this)">
                                        <input type="checkbox" class="mr-2 carrier-checkbox" value="光盘" onclick="event.stopPropagation()"> 光盘
                                    </div>
                                    <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectCarrierMulti('硬盘', this)">
                                        <input type="checkbox" class="mr-2 carrier-checkbox" value="硬盘" onclick="event.stopPropagation()"> 硬盘
                                    </div>
                                </div>
                                <div class="border-t border-gray-200 p-2 flex justify-end gap-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700">
                                    <button onclick="event.stopPropagation(); toggleCascader('carrier-cascader')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
                                    <button onclick="event.stopPropagation(); confirmCarrierMulti()" class="px-3 py-1 text-sm bg-primary text-white rounded hover:bg-blue-700">确定</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否应归实体档案 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option>否</option>
                            <option>是</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">归档里程碑 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option>无</option>
                            <option>投资项目移交</option>
                            <option>交付项目开工</option>
                            <option>交付项目竣工验收</option>
                            <option>交付项目决算</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">文件来源系统</label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="">请选择</option>
                            <option value="zhaocai">招采系统</option>
                            <option value="hetong">合同系统</option>
                            <option value="chanquan">产权系统</option>
                            <option value="oa">OA系统</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否经营事项考核 <span class="text-danger">*</span></label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="no" selected>否</option>
                            <option value="yes">是</option>
                        </select>
                    </div>

                    <div>
                      <!-- <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300> 启用 <span class="text-danger">*</span> </label> -->
                      <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">启用 <span class="text-danger">*</span></label>
                      <label class="switch"><input type="checkbox" id="toggle" /><span class="slider"></span></label>
                    </div>



                </div>
            </div>
        </div>


<!-- 撤回审批弹窗 -->
<div id="withdraw-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center modal-bg">
    <div class="bg-white rounded-xl shadow-2xl w-[90%] max-w-[500px] dark:bg-gray-800">
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl dark:bg-gray-800 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2 dark:text-white">
                <i class="fas fa-exclamation-triangle text-warning"></i>
                撤回审批确认
            </h3>
            <button onclick="closeWithdrawModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="p-6">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4 dark:bg-yellow-900/20 dark:border-yellow-800">
                <p class="text-sm text-yellow-800 dark:text-yellow-200">
                    <i class="fas fa-info-circle mr-2"></i>
                    撤回后申请单状态变更为"已撤回"，已撤回的单据可修改后重新提交审批。
                </p>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400">请确认是否继续撤回操作？</p>
        </div>
        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-end gap-3 dark:bg-gray-800 dark:border-gray-700">
            <button onclick="closeWithdrawModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
            <button onclick="confirmWithdraw()" class="px-4 py-2 bg-warning text-white rounded-lg hover:bg-yellow-600 transition dark:bg-yellow-600 dark:hover:bg-yellow-700">
                <i class="fas fa-undo mr-1"></i>确认撤回
            </button>
         </div>
    </div>
</div>

<!-- 项目选择弹窗 -->
<div id="project-select-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center modal-bg hidden">
    <div class="bg-white rounded-xl shadow-2xl w-[95%] max-w-[900px] max-h-[90vh] flex flex-col dark:bg-gray-800">
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl dark:bg-gray-800 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2 dark:text-white">
                <i class="fas fa-project-diagram text-primary"></i>
                选择项目
            </h3>
            <button onclick="closeProjectSelectModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-4 md:p-6 overflow-hidden flex-1 flex flex-col">
            <!-- <div class="mb-4 flex gap-2">
                <div class="relative flex-1">
                    <input type="text" id="project-search-input" placeholder="搜索项目编号或项目名称..." class="w-full border border-gray-300 rounded-lg pl-9 pr-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <i class="fas fa-search absolute left-3 top-2.5 text-gray-400 text-sm"></i>
                </div>
            </div> -->
            
            <div class="table-container flex-1 mobile-scroll-x">
                <table class="data-table" id="project-select-table">
                    <thead>
                        <tr>
                            <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 w-10">
                                <input type="checkbox" class="w-4 h-4 text-primary rounded focus:ring-primary" onclick="toggleSelectAllProject(this)" id="select-all-project">
                            </th>
                            <th>项目编号<div class="resize-handle"></div></th>
                            <th>项目名称<div class="resize-handle"></div></th>
                            <th>项目分类<div class="resize-handle"></div></th>
                            <th>项目业态<div class="resize-handle"></div></th>
                            <th>所属管理组织<div class="resize-handle"></div></th>
                            <th>所属法人组织<div class="resize-handle"></div></th>
                        </tr>
                        <tr class="header-filter">
                            <td class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 text-center">-</td>
                            <td><input type="text" placeholder="搜索" class="w-full" oninput="filterProjectTable(this, 1)"></td>
                            <td><input type="text" placeholder="搜索" class="w-full" oninput="filterProjectTable(this, 2)"></td>
                            <td>
                                <select class="w-full dark:bg-gray-700" onchange="filterProjectTable(this, 3)">
                                    <option value="">全部</option>
                                    <option>主营业务项目/重资产项目/投资项目</option>
                                    <option>主营业务项目/重资产项目/建设项目</option>
                                    <option>主营业务项目/重资产项目/运营项目</option>
                                    <option>主营业务项目/轻资产项目/产品服务销售项目</option>
                                    <option>专项项目/XXXXX/XXXXX</option>

                                </select>
                            </td>
                            <td>
                                <select class="w-full dark:bg-gray-700" onchange="filterProjectTable(this, 4)">
                                    <option value="">全部</option>
                                    <option>污水/市政污水处理/市政污水处理</option>
                                    <option>水环境综合治理/水环境综合治理/水环境综合治理</option>
                                        <option>XXXX/XXXX/XXXX</option>
                                </select>
                            </td>
                            <td><input type="text" placeholder="搜索" class="w-full" oninput="filterProjectTable(this, 5)"></td>
                            <td><input type="text" placeholder="搜索" class="w-full" oninput="filterProjectTable(this, 6)"></td>
                        </tr>
                    </thead>
                    <tbody id="project-select-tbody">
                        <tr class="hover:bg-blue-50 cursor-pointer transition project-select-row dark:hover:bg-blue-900/20" onclick="selectProjectRow(this, 'J2026011401', '成都某水厂改扩建项目')">
                            <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">
                                <input type="checkbox" class="project-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="J2026011401" onclick="event.stopPropagation(); updateProjectSelectButton()">
                            </td>
                            <td class="font-mono text-xs text-gray-600 dark:text-gray-400">J2026011401</td>
                            <td class="font-medium text-gray-900 dark:text-white">成都某水厂改扩建项目</td>
                            <td class="dark:text-gray-300">主营业务项目/重资产项目/建设项目</td>
                            <td class="dark:text-gray-300">污水/市政污水处理/市政污水处理</td>
                            <td class="dark:text-gray-300">枣庄台儿庄区污水处理厂</td>
                            <td class="dark:text-gray-300">北控水务发展有限公司</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition project-select-row dark:hover:bg-blue-900/20" onclick="selectProjectRow(this, 'J2026011502', '北京某TOT项目')">
                            <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">
                                <input type="checkbox" class="project-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="J2026011502" onclick="event.stopPropagation(); updateProjectSelectButton()">
                            </td>
                            <td class="font-mono text-xs text-gray-600 dark:text-gray-400">XJYNJ-20260129-0017</td>
                            <td class="font-medium text-gray-900 dark:text-white">北京某TOT项目</td>
                            <td class="dark:text-gray-300">主营业务项目/轻资产项目/产品服务销售项目</td>
                            <td class="dark:text-gray-300">-</td>
                            <td class="dark:text-gray-300">北京清源处理厂</td>
                            <td class="dark:text-gray-300">北京清源污水净化有限公司</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition project-select-row dark:hover:bg-blue-900/20" onclick="selectProjectRow(this, 'J2026011603', '南京某供水项目')">
                            <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">
                                <input type="checkbox" class="project-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="J2026011603" onclick="event.stopPropagation(); updateProjectSelectButton()">
                            </td>
                            <td class="font-mono text-xs text-gray-600 dark:text-gray-400">Z92025003538</td>
                            <td class="font-medium text-gray-900 dark:text-white">南京某供水项目</td>
                            <td class="dark:text-gray-300">专项项目/研发专项/数字化专项</td>
                            <td class="dark:text-gray-300">-</td>
                            <td class="dark:text-gray-300">北控水务集团</td>
                            <td class="dark:text-gray-300">北控水务（中国）投资有限公司</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-between items-center dark:bg-gray-800 dark:border-gray-700">
            <span class="text-sm text-gray-500 dark:text-gray-400">已选择 <span id="project-selected-count" class="font-bold text-primary">0</span> 个项目</span>
            <div class="flex gap-2">
                <button onclick="closeProjectSelectModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
                <button onclick="confirmProjectSelection()" id="confirm-project-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-check mr-1"></i>确认选择
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 文件清单放大编辑弹窗 -->
<div id="file-list-expanded-modal" class="hidden file-list-expanded" onclick="closeFileListExpanded(event)">
    <div class="file-list-expanded-header">
        <h3 class="file-list-expanded-title">文件清单 - 放大编辑模式</h3>
        <button class="close-expanded-btn" onclick="closeFileListExpanded(event)" title="关闭">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>
    <div class="table-container mobile-scroll-x dark:bg-gray-800" onclick="event.stopPropagation()" style="width: 100%;">
        <table class="data-table editable-table" id="file-list-expanded-table" style="min-width: 1400px;">
            <!-- 表格内容将由JS复制 -->
        </table>
    </div>
    <!-- 分页控件 -->
    <div class="pagination-container flex-col sm:flex-row gap-2" onclick="event.stopPropagation()">
        <div class="pagination-info text-center sm:text-left text-sm">
            显示第 <span class="font-medium" id="expanded-page-start">1</span> 到 <span class="font-medium" id="expanded-page-end">10</span> 条，共 <span class="font-medium" id="expanded-total-count">0</span> 条
        </div>
        <div class="flex items-center gap-3 flex-wrap justify-center">
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-600 dark:text-gray-400">每页显示</span>
                <select class="pagination-select" id="expanded-page-size" onchange="changeExpandedPageSize(this.value)">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span class="text-sm text-gray-600 dark:text-gray-400">条</span>
            </div>
            <div class="pagination-controls" id="expanded-pagination-controls">
                <button class="pagination-btn" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="flex justify-center mt-3 mb-1">
        <button onclick="closeFileListExpanded()" class="px-6 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg text-sm">
            <i class="fas fa-check mr-2"></i>完成编辑
        </button>
    </div>
</div>

<!-- 资料类型选择弹窗 -->
<div id="material-type-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center modal-bg hidden">
    <div class="bg-white rounded-xl shadow-2xl w-[95%] max-w-[900px] max-h-[90vh] flex flex-col dark:bg-gray-800">
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl dark:bg-gray-800 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2 dark:text-white">
                <i class="fas fa-folder-open text-primary"></i>
                选择资料类型
            </h3>
            <button onclick="closeMaterialTypeModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-4 md:p-6 overflow-hidden flex-1 flex flex-col">
            <div class="table-container flex-1 mobile-scroll-x">
                <table class="data-table" id="material-type-table">
                    <thead>
                        <tr>
                            <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                            <th>三级档案分类<div class="resize-handle"></div></th>
                            <th>资料类型<div class="resize-handle"></div></th>
                            <th>是否必有<div class="resize-handle"></div></th>
                            <th>条件必有规则<div class="resize-handle"></div></th>
                            <th>业务含义<div class="resize-handle"></div></th>
                        </tr>
                        <!-- 搜索行 -->
                        <tr class="bg-white dark:bg-gray-800">
                            <td class="text-center sticky left-0 z-30 bg-white dark:bg-gray-800">-</td>
                            <td><input type="text" placeholder="搜索" class="w-full border border-gray-300 rounded px-2 py-1 text-xs" oninput="filterMaterialType(this, 2)"></td>
                            <td><input type="text" placeholder="搜索" class="w-full border border-gray-300 rounded px-2 py-1 text-xs" oninput="filterMaterialType(this, 3)"></td>
                            <td><input type="text" placeholder="搜索" class="w-full border border-gray-300 rounded px-2 py-1 text-xs" oninput="filterMaterialType(this, 4)"></td>
                            <td><input type="text" placeholder="搜索" class="w-full border border-gray-300 rounded px-2 py-1 text-xs" oninput="filterMaterialType(this, 5)"></td>
                            <td><input type="text" placeholder="搜索" class="w-full border border-gray-300 rounded px-2 py-1 text-xs" oninput="filterMaterialType(this, 6)"></td>
                        </tr>
                    </thead>
                    <tbody id="material-type-tbody">
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '施工组织设计')">
                            <td class="text-center">1</td>
                            <td class="dark:text-gray-300">施工资料</td>
                            <td class="font-medium dark:text-white">施工组织设计</td>
                            <td><span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs dark:bg-red-900 dark:text-red-200">必有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">建设项目启动时的施工总体方案</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '技术交底')">
                            <td class="text-center">2</td>
                            <td class="dark:text-gray-300">施工资料</td>
                            <td class="font-medium dark:text-white">技术交底</td>
                            <td><span class="px-2 py-0.5 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">或有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">施工前的技术交接记录</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '质量验收')">
                            <td class="text-center">3</td>
                            <td class="dark:text-gray-300">施工资料</td>
                            <td class="font-medium dark:text-white">质量验收</td>
                            <td><span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs dark:bg-red-900 dark:text-red-200">必有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">材料及工程质量的验收记录</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '影像资料')">
                            <td class="text-center">4</td>
                            <td class="dark:text-gray-300">施工资料</td>
                            <td class="font-medium dark:text-white">影像资料</td>
                            <td><span class="px-2 py-0.5 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">或有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">施工过程的影像记录</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '日志')">
                            <td class="text-center">5</td>
                            <td class="dark:text-gray-300">监理资料</td>
                            <td class="font-medium dark:text-white">日志</td>
                            <td><span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs dark:bg-red-900 dark:text-red-200">必有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">监理日常工作记录</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '汇报材料')">
                            <td class="text-center">6</td>
                            <td class="dark:text-gray-300">项目管理</td>
                            <td class="font-medium dark:text-white">汇报材料</td>
                            <td><span class="px-2 py-0.5 bg-gray-100 text-gray-700 rounded text-xs dark:bg-gray-700 dark:text-gray-300">或有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">项目进展汇报文档</td>
                        </tr>
                        <tr class="hover:bg-blue-50 cursor-pointer transition material-type-row dark:hover:bg-blue-900/20" onclick="selectMaterialType(this, '补充协议')">
                            <td class="text-center">7</td>
                            <td class="dark:text-gray-300">合同管理</td>
                            <td class="font-medium dark:text-white">补充协议</td>
                            <td><span class="px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs dark:bg-yellow-900 dark:text-yellow-200">条件必有</span></td>
                            <td class="dark:text-gray-400">项目开工节点必有</td>
                            <td class="dark:text-gray-400">合同变更时的补充文件</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-between items-center dark:bg-gray-800 dark:border-gray-700">
            <span class="text-sm text-gray-500 dark:text-gray-400">共 <span id="material-type-count">7</span> 条记录</span>
            <div class="flex gap-2">
                <button onclick="closeMaterialTypeModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
                <button onclick="confirmMaterialTypeSelection()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-check mr-1"></i>确认选择
                </button>
            </div>
        </div>
    </div>

        </div>

        <!-- 批量上传文件页（批量上传+AI分类+自动提取） -->
        <div id="page-upload-files" class="hidden fade-in p-4 md:p-6 space-y-4 md:space-y-6">
            
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="showPage('archive-list')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">批量上传文件</h2>
                        <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">支持分批上传文件并发起审批流程</p>
                    </div>
                </div>
                <div class="flex gap-2 md:gap-3 flex-wrap">
                    <button onclick="saveDraftBatch()" class="px-4 md:px-5 py-2 md:py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 text-sm md:text-base">
                        <i class="fas fa-save mr-2"></i>保存草稿
                    </button>
                    <button onclick="submitBatchApproval()" class="px-4 md:px-5 py-2 md:py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2 dark:shadow-blue-900/30 text-sm md:text-base">
                        <i class="fas fa-paper-plane"></i>
                        批量提交审批 (<span id="batch-submit-count">0</span>)
                    </button>
                </div>
            </div>
  <!-- 基本信息（完整字段） -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 dark:text-white">
                            <i class="fas fa-info-circle text-primary"></i>
                            基本信息
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-5">

                                    <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">档案分类 <span class="text-danger">*</span></label>
                                <div class="cascader-container" id="archive-cascader-new">
                                    <div class="cascader-input" onclick="toggleCascader('archive-cascader-new')">
                                        <span id="archive-cascader-new-text">科技档案 / 基建档案</span>
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                    <div class="cascader-dropdown">
                                        <div class="cascader-menu">
                                            <div class="cascader-column" id="archive-cascader-new-level1">
                                                <div class="cascader-item active" onclick="selectCascaderLevel('archive-cascader-new', 1, '科技档案', this)">
                                                    科技档案 <i class="fas fa-chevron-right"></i>
                                                </div>
                                                <div class="cascader-item" onclick="selectCascaderLevel('archive-cascader-new', 1, '文书档案', this)">
                                                    文书档案 <i class="fas fa-chevron-right"></i>
                                                </div>
                                            </div>
                                            <div class="cascader-column" id="archive-cascader-new-level2">
                                                <div class="cascader-item active" onclick="selectCascaderLevel('archive-cascader-new', 2, '基建档案', this)">基建档案</div>
                                                <div class="cascader-item" onclick="selectCascaderLevel('archive-cascader-new', 2, '投资档案', this)">投资档案</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否必须关联项目 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>是</option>
                                    <option>否</option>
                                </select>
                            </div>

                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">所属项目 <span class="text-danger">*</span></label>
                                <div class="relative">
                                    <input type="text" value="成都某水厂改扩建项目" readonly
                                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm cursor-pointer hover:border-primary focus:outline-none focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white project-select-input"
                                        onclick="openProjectSelectModal(this)"
                                        placeholder="点击选择项目">
                                    <i class="fas fa-search absolute right-3 top-2.5 text-gray-400 text-sm"></i>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">管理组织 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>东部大区-枣庄区域公司-枣庄台儿庄区污水处理厂</option>
                                </select>
                            </div>

                         
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">法人组织 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>北控水务（中国）投资有限公司</option>
                                    <option>北控水务发展有限公司</option>
                                    <option>北京清源污水净化有限公司</option>
                                </select>
                            </div>
   <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">上传部门 <span class="text-danger">*</span></label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option selected>枣庄台儿庄区污水处理厂-综合部</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">上传人 <span class="text-danger">*</span></label>
                                <input type="text" value="张三（东部大区-档案管理岗）" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">申请单创建日期</label>
                                <input type="text" value="2026-01-28" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
                            </div>
                        </div>

                    </div>
            <!-- 批量上传区域 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 md:p-10 text-center bg-gray-50 hover:bg-blue-50 hover:border-primary transition-colors cursor-pointer dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600 dark:hover:border-blue-400"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleBatchUploadDrop(event)"
                     onclick="document.getElementById('batch-file-input').click()">
                    <input type="file" id="batch-file-input" multiple class="hidden" onchange="handleBatchFileSelect(this)">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-blue-100 flex items-center justify-center text-primary dark:bg-blue-900 dark:text-blue-400">
                        <i class="fas fa-cloud-upload-alt text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2 dark:text-white">点击或拖拽文件到此处批量上传</h3>
                    <p class="text-sm text-gray-500 mb-4 dark:text-gray-400">支持 PDF、DOC、XLS、PPT、JPG、PNG、压缩包等格式，单次最多上传50个文件</p>
                    <div class="flex items-center justify-center gap-4 text-xs text-gray-400 dark:text-gray-500">
                        <span><i class="fas fa-check-circle mr-1"></i>AI智能分类</span>
                        <span><i class="fas fa-check-circle mr-1"></i>自动提取信息</span>
                        <span><i class="fas fa-check-circle mr-1"></i>批量提交</span>
                    </div>
                </div>
            </div>

            <!-- AI处理状态栏 -->
            <div id="ai-processing-bar" class="hidden bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-robot text-2xl animate-pulse"></i>
                        <div>
                            <h3 class="font-semibold">AI智能处理中...</h3>
                            <p class="text-sm text-blue-100">正在自动识别文件类型、提取关键信息、匹配档案目录</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-2xl font-bold" id="ai-process-percent">0%</span>
                    </div>
                </div>
                <div class="w-full bg-white/20 rounded-full h-2">
                    <div id="ai-progress-bar" class="bg-white rounded-full h-2 transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="mt-2 flex items-center justify-between text-xs text-blue-100">
                    <span id="ai-process-status">正在分析文件 1/10...</span>
                    <span>预计剩余时间: <span id="ai-time-remaining">30秒</span></span>
                </div>
            </div>

            <!-- 批量文件列表（AI分类结果） -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 dark:bg-gray-800 dark:border-gray-700">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                    <h3 class="text-base md:text-lg font-semibold text-gray-900 flex items-center gap-2 dark:text-white">
                        <i class="fas fa-magic text-purple-500"></i>
                        AI识别结果 <span class="text-sm font-normal text-gray-500 dark:text-gray-400">(已识别 <span id="ai-recognized-count">0</span> 个文件)</span>
                    </h3>
                    <div class="flex gap-2">
                        <button onclick="reAnalyzeAll()" class="px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition dark:bg-purple-900 dark:text-purple-300">
                            <i class="fas fa-redo mr-1"></i>重新识别
                        </button>
                        <button onclick="clearAllFiles()" class="px-3 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">
                            <i class="fas fa-trash-alt mr-1"></i>清空
                        </button>
                    </div>
                </div>

                <div class="table-container mobile-scroll-x">
                    <table class="data-table editable-table" id="batch-upload-table">
                        <thead>
                            <tr>
                                <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 w-10">
                                    <input type="checkbox" id="select-all-batch" class="w-4 h-4 text-primary rounded focus:ring-primary" onchange="toggleSelectAllBatch(this)">
                                </th>
                                <th class="min-w-[50px]">序号<div class="resize-handle"></div></th>
                                <th class="min-w-[120px]">附件名称<div class="resize-handle"></div></th>
                                <th class="min-w-[120px]">AI识别资料类型<div class="resize-handle"></div></th>
                                <th class="min-w-[150px]">档案题名 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                <th class="min-w-[100px]">责任者 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                <th class="min-w-[100px]">成文日期 <span class="text-danger">*</span><div class="resize-handle"></div></th>
                                <th class="min-w-[80px]">文号<div class="resize-handle"></div></th>
                                <th class="min-w-[100px]">项目名称<div class="resize-handle"></div></th>
                                <th class="min-w-[80px]">会议<div class="resize-handle"></div></th>
                                <th class="min-w-[80px]">议题<div class="resize-handle"></div></th>
                                <th class="min-w-[80px]">密级<div class="resize-handle"></div></th>
                                <!-- <th class="min-w-[60px]">页数<div class="resize-handle"></div></th> -->
                                <th class="min-w-[100px]">匹配档案分类<div class="resize-handle"></div></th>
                                <th class="min-w-[80px] text-center">操作<div class="resize-handle"></div></th>
                            </tr>
                        </thead>


                        <tbody id="batch-upload-tbody">
                            <!-- AI识别结果将动态插入此处 -->
                            <tr class="text-center text-gray-500 dark:text-gray-400" id="empty-batch-tip">
                                <td colspan="11" class="py-8">
                                    <i class="fas fa-inbox text-4xl mb-2 text-gray-300 dark:text-gray-600"></i>
                                    <p>请上传文件，AI将自动识别分类</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 智能提示 -->
                <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4 dark:bg-blue-900/20 dark:border-blue-800">
                    <h4 class="text-sm font-semibold text-blue-900 mb-2 flex items-center gap-2 dark:text-blue-200">
                        <i class="fas fa-lightbulb"></i>
                        AI识别说明
                    </h4>
                    <ul class="text-xs text-blue-800 space-y-1 list-disc list-inside dark:text-blue-200">
                        <li>AI将根据文件内容自动匹配最合适的"资料类型"（基于档案目录管理中的归档范围）</li>
                        <li>自动提取文件中的关键信息：题名、成文日期、文号等</li>
                        <li>识别准确率约95%，建议提交前人工复核标红字段</li>
                        <!-- <li>支持批量修改：选中多个文件后可批量设置密级、保管期限等字段</li> -->
                    </ul>
                </div>
            </div>
        </div>



<!-- AI检查详情弹窗 -->
<div id="ai-check-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center modal-bg">
    <div class="bg-white rounded-xl shadow-2xl w-[95%] max-w-[800px] max-h-[80vh] flex flex-col dark:bg-gray-800">
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl dark:bg-gray-800 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2 dark:text-white"><i class="fas fa-robot text-primary"></i>AI 智能检查报告详情</h3>
            <button onclick="closeAICheckModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="p-4 md:p-6 overflow-y-auto flex-1">
            <div class="table-container mobile-scroll-x">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="sticky left-0 z-30 bg-gray-50 dark:bg-gray-800" style="position: sticky;left: 0;">序号<div class="resize-handle"></div></th>
                            <th>检查点<div class="resize-handle"></div></th>
                            <th>检查结果<div class="resize-handle"></div></th>
                            <th>说明<div class="resize-handle"></div></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">1</td>
                            <td class="dark:text-gray-300">档案分类合规性</td>
                            <td class="text-success dark:text-green-400"><i class="fas fa-check-circle"></i> 通过</td>
                            <td class="dark:text-gray-400">分类层级正确</td>
                        </tr>
                        <tr class="bg-yellow-50 dark:bg-yellow-900/10">
                            <td class="text-center sticky left-0 bg-yellow-50 dark:bg-yellow-900/10 z-10">2</td>
                            <td class="dark:text-gray-300">档案题名规范性</td>
                            <td class="text-warning dark:text-yellow-400"><i class="fas fa-exclamation-circle"></i> 需复审</td>
                            <td class="dark:text-gray-400">存在特殊字符"_"</td>
                        </tr>
                        <tr>
                            <td class="text-center sticky left-0 bg-white dark:bg-gray-800 z-10">3</td>
                            <td class="dark:text-gray-300">必填项完整性</td>
                            <td class="text-success dark:text-green-400"><i class="fas fa-check-circle"></i> 通过</td>
                            <td class="dark:text-gray-400">所有必填字段已填写</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-end dark:bg-gray-800 dark:border-gray-700">
            <button onclick="closeAICheckModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">关闭</button>
        </div>
    </div>
</div>

<!-- 新增分类弹窗 -->
<div id="add-category-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center modal-bg overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl w-[95%] max-w-[600px] max-h-[90vh] overflow-y-auto my-4 dark:bg-gray-800">
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl dark:bg-gray-800 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">新增档案分类</h3>
            <button onclick="closeAddCategoryModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="p-4 md:p-6 space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">分类编码</label>
                <input type="text" value="系统自动生成" disabled class="w-full bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">分类代号 <span class="text-danger">*</span></label>
                <input type="text" id="category-code" placeholder="如：G4" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">分类名称 <span class="text-danger">*</span></label>
                <input type="text" id="category-name" placeholder="请输入分类名称" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">分类层级 <span class="text-danger">*</span></label>
                <select id="category-level" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="toggleParentCategory()">
                    <option value="1">一级分类</option>
                    <option value="2">二级分类</option>
                    <option value="3">三级分类</option>
                </select>
            </div>
            <div id="parent-category-div">
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">父级分类 <span class="text-danger">*</span></label>
                <select id="parent-category" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="">请选择父级分类</option>
                    <option value="kj">KJ-科技档案</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">是否关联项目 <span class="text-danger">*</span></label>
                <select id="category-related-project" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="toggleCategoryProjectField()">
                    <option value="yes">是</option>
                    <option value="no">否</option>
                </select>
            </div>


            <div id="category-project-field">
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">关联项目分类</label>
                <div class="cascader-container" id="category-project-cascader">
                    <div class="cascader-input" onclick="toggleCascader('category-project-cascader')">
                        <span id="category-project-cascader-text">请选择项目分类</span>
                        <i class="fas fa-chevron-down text-gray-400"></i>
                    </div>
                    <div class="cascader-dropdown">
                        <div class="cascader-menu" style="min-width: 500px;">
                            <div class="cascader-column" id="category-project-cascader-level1" style="min-width: 150px;">
                                <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('category-project-cascader', 1, '主营业务项目', this)">
                                    <input type="checkbox" class="mr-2" value="主营业务项目" onclick="event.stopPropagation()"> 主营业务项目
                                </div>
                                <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('category-project-cascader', 1, '专项项目', this)">
                                    <input type="checkbox" class="mr-2" value="专项项目" onclick="event.stopPropagation()"> 专项项目
                                </div>
                                <div class="cascader-item" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('category-project-cascader', 1, '公共项目', this)">
                                    <input type="checkbox" class="mr-2" value="公共项目" onclick="event.stopPropagation()"> 公共项目
                                </div>
                            </div>
                            <div class="cascader-column" id="category-project-cascader-level2" style="min-width: 150px;">
                                <div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">请先选择一级分类</div>
                            </div>
                            <div class="cascader-column" id="category-project-cascader-level3" style="min-width: 150px;">
                                <div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">请先选择二级分类</div>
                            </div>
                        </div>
                        <div class="border-t border-gray-200 p-2 flex justify-end gap-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700">
                            <button onclick="event.stopPropagation(); toggleCascader('category-project-cascader')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
                            <button onclick="event.stopPropagation(); confirmProjectCategoryMulti('category-project-cascader')" class="px-3 py-1 text-sm bg-primary text-white rounded hover:bg-blue-700">确定</button>
                        </div>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">三级级联多选，支持选择多个项目分类</p>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1.5 dark:text-gray-300">状态</label>
                <div class="flex items-center">
                    <label class="switch">
                        <input type="checkbox" id="category-status-checkbox" checked onchange="handleCategoryStatusChange()">
                        <span class="slider"></span>
                    </label>
                    <span id="category-status-text" class="ml-3 text-sm text-gray-700 dark:text-gray-300">启用</span>
                    <input type="hidden" id="category-status-input" value="active">
                </div>
            </div>


        </div>
        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-end gap-3 dark:bg-gray-800 dark:border-gray-700">
            <button onclick="closeAddCategoryModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">取消</button>
            <button id="btn-confirm-category" onclick="confirmAddCategory()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition">确定</button>
        </div>
    </div>
</div>

<!-- Toast 提示 -->
<div id="toast" class="fixed top-20 right-6 bg-white border-l-4 border-primary text-gray-800 px-6 py-4 rounded shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex items-center gap-3 dark:bg-gray-800 dark:border-blue-500 dark:text-white">
    <i id="toast-icon" class="fas fa-check-circle text-success text-xl"></i>
    <div>
        <h4 class="font-semibold" id="toast-title">操作成功</h4>
        <p class="text-sm text-gray-600 dark:text-gray-400" id="toast-message">权限配置已保存</p>
    </div>
</div>

<script>
    // 深色模式切换
    function toggleDarkMode() {
        const html = document.documentElement;
        if (html.classList.contains('dark')) {
            html.classList.remove('dark');
            localStorage.setItem('theme', 'light');
        } else {
            html.classList.add('dark');
            localStorage.setItem('theme', 'dark');
        }
    }

    // 初始化深色模式
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    }

    // 标签页管理
    let openTabs = [];
    let currentTab = 'dashboard';
    const tabNames = {
        'dashboard': '工作台',
        'archive-list': '文件上传申请',
        'archive-new': '上传文件',
        'archive-detail-archived': '上传文件详情',
        'archive-detail-rejected': '上传文件详情',
        'archive-detail-pending': '上传文件详情',
        'archive-ledger': '电子文件台账',
        'ledger-detail': '电子文件详情',
        'approval-center': '审批中心',
        'archive-config': '档案分类管理',
        'archive-directory': '档案目录管理',
        'archive-directory-new': '新增档案目录',
        'permission': '权限管理',
        'upload-files': '批量上传文件',
        'file-approval': '文件审批',
        'file-list': '文件清单'
    };

    // 页面切换（标签页模式）
    function showPage(pageId) {
        // 检查是否尝试访问绝密级档案详情
        if (pageId === 'ledger-detail' && event && event.target && event.target.closest('.top-secret-row')) {
            showToast('绝密级档案不可查看详情', 'warning');
            return;
        }

        // 隐藏所有页面
        document.querySelectorAll('[id^="page-"]').forEach(el => el.classList.add('hidden'));

        // 显示目标页面
        const targetPage = document.getElementById('page-' + pageId);
        if (targetPage) {
            targetPage.classList.remove('hidden');
        }

        // 更新标签页
        if (!openTabs.includes(pageId)) {
            openTabs.push(pageId);
        }
        currentTab = pageId;
        renderTabs();

        // 更新侧边栏状态（仅高亮，不改变行为）
        document.querySelectorAll('.sidebar-item').forEach(el => {
            el.classList.remove('bg-blue-50', 'text-primary', 'border-l-4', 'border-primary');
            el.classList.add('text-gray-700');
            // 移除深色模式类
            el.classList.remove('dark:bg-blue-900/20', 'dark:text-blue-400', 'dark:border-blue-500');
            el.classList.add('dark:text-gray-300');
        });

        const activeLink = document.querySelector(`a[onclick="showPage('${pageId}')"]`);
        if(activeLink) {
            activeLink.classList.remove('text-gray-700', 'dark:text-gray-300');
            activeLink.classList.add('bg-blue-50', 'text-primary', 'border-l-4', 'border-primary', 'dark:bg-blue-900/20', 'dark:text-blue-400', 'dark:border-blue-500');
        }

        // 移动端自动收起侧边栏
        if (window.innerWidth < 1024) {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('sidebar-collapsed');
            document.getElementById('sidebar-overlay').classList.add('hidden');
        }

        // 初始化表格列宽调整功能
        setTimeout(() => {
            initTableResizing();
        }, 100);
    }

    // 渲染标签页 - 调整为图片所示的样式
    function renderTabs() {
        const container = document.getElementById('tab-container');
        if (!container) return;

        let html = '';
        openTabs.forEach(tabId => {
            const isActive = tabId === currentTab;
            const name = tabNames[tabId] || tabId;
            html += `
                <div class="tab-item ${isActive ? 'active' : ''} px-4 py-2 text-sm cursor-pointer flex items-center gap-2 h-full" onclick="switchTab('${tabId}')">
                    <span>${name}</span>
                    <button class="tab-close w-4 h-4 flex items-center justify-center" onclick="event.stopPropagation(); closeTab('${tabId}')">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    // 切换标签页
    function switchTab(tabId) {
        currentTab = tabId;

        // 隐藏所有页面
        document.querySelectorAll('[id^="page-"]').forEach(el => el.classList.add('hidden'));

        // 显示目标页面
        const targetPage = document.getElementById('page-' + tabId);
        if (targetPage) {
            targetPage.classList.remove('hidden');
        }

        renderTabs();

        // 更新侧边栏
        document.querySelectorAll('.sidebar-item').forEach(el => {
            el.classList.remove('bg-blue-50', 'text-primary', 'border-l-4', 'border-primary');
            el.classList.add('text-gray-700');
        });

        const activeLink = document.querySelector(`a[onclick="showPage('${tabId}')"]`);
        if(activeLink) {
            activeLink.classList.remove('text-gray-700');
            activeLink.classList.add('bg-blue-50', 'text-primary', 'border-l-4', 'border-primary');
        }

        // 初始化表格列宽调整功能
        setTimeout(() => {
            initTableResizing();
        }, 100);
    }

    // 关闭标签页
    function closeTab(tabId) {
        const index = openTabs.indexOf(tabId);
        if (index > -1) {
            openTabs.splice(index, 1);

            // 如果关闭的是当前页，切换到邻近的标签页
            if (currentTab === tabId && openTabs.length > 0) {
                const newIndex = index < openTabs.length ? index : openTabs.length - 1;
                switchTab(openTabs[newIndex]);
            } else if (openTabs.length === 0) {
                // 如果没有标签页了，显示工作台
                showPage('dashboard');
            } else {
                renderTabs();
            }
        }
    }

    // 抽屉菜单切换
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');

        if (sidebar.classList.contains('sidebar-collapsed')) {
            sidebar.classList.remove('sidebar-collapsed');
            sidebar.classList.add('w-64');
            overlay.classList.remove('hidden');
        } else {
            sidebar.classList.add('sidebar-collapsed');
            sidebar.classList.remove('w-64');
            overlay.classList.add('hidden');
        }
    }

    // 级联选择器更新
    function updateLevel2(type) {
        const level1 = document.getElementById(type + '-level1').value;
        const level2 = document.getElementById(type + '-level2');
        level2.innerHTML = '<option value="">全部</option>';

        if(level1 === 'kj') {
            level2.innerHTML += '<option value="g">基建档案</option><option value="t">投资档案</option>';
        } else if(level1 === 'ws') {
            level2.innerHTML += '<option value="xz">行政文书</option><option value="dz">党群工作</option>';
        }
    }

    // 管理组织权限切换
    function toggleChildOrgs(checkbox, orgId) {
        const childrenDiv = document.getElementById(orgId + '-children');
        if(childrenDiv) {
            childrenDiv.querySelectorAll('input').forEach(cb => cb.checked = checkbox.checked);
            childrenDiv.classList.toggle('hidden', !checkbox.checked);
        }
    }

    // 档案分类全局切换
    function toggleGlobalArchive(checkbox) {
        const authDiv = document.getElementById('archive-level-auth');
        authDiv.style.opacity = checkbox.checked ? '0.5' : '1';
        authDiv.style.pointerEvents = checkbox.checked ? 'none' : 'auto';
    }

    // 档案分类二级切换
    function toggleLevel2(checkbox, type) {
        const div = document.getElementById(type + '-level2');
        if(div) div.classList.toggle('hidden', !checkbox.checked);
    }

    // 新增分类弹窗
    // 切换分类弹窗状态
    function handleCategoryStatusChange() {
        const checkbox = document.getElementById('category-status-checkbox');
        const text = document.getElementById('category-status-text');
        const input = document.getElementById('category-status-input');
        
        if (checkbox.checked) {
            // 切换为启用
            input.value = 'active';
            text.innerText = '启用';
        } else {
            // 切换为禁用
            input.value = 'inactive';
            text.innerText = '禁用';
        }
    }

    function toggleCategoryProjectField() {
        const field = document.getElementById('category-project-field');
        const select = document.getElementById('category-related-project');
        if (!field || !select) return;
        field.style.display = select.value === 'yes' ? 'block' : 'none';
    }

    function openCategoryDetailModal(row) {
        // 阻止事件冒泡，避免触发其他点击事件
        if(event) event.stopPropagation();

        // 获取行数据
        const cells = row.querySelectorAll('td');
        // Index mapping based on row structure:
        // 0: #
        // 1: Full Code (KJ)
        // 2: Short Code (KJ)
        // 3: Name
        // 4: Level
        // 5: Parent
        // 6: Related Project
        // 7: Project Categories
        // 8: Status
        
        const code = cells[2].innerText.trim(); 
        const name = cells[3].querySelector('span').innerText.trim(); 
        const levelText = cells[4].innerText.trim(); 
        const parentCode = cells[5].innerText.trim(); 
        const related = cells[6].innerText.trim(); 
        const projectCats = cells[7].innerText.trim(); 
        const status = cells[8].innerText.trim(); 
        
        // 填充表单
        const title = document.querySelector('#add-category-modal h3');
        if(title) title.innerText = '档案分类详情';
        
        // 设置按钮文字为“保存”
        const confirmBtn = document.getElementById('btn-confirm-category');
        if(confirmBtn) {
            confirmBtn.innerText = '保存';
            confirmBtn.onclick = confirmSaveCategory;
        }

        // 填充数据并设置权限
        // 1. 分类代号：可编辑
        const codeInput = document.getElementById('category-code');
        if(codeInput) {
            codeInput.value = code;
            codeInput.disabled = false;
        }
        
        // 2. 分类名称：可编辑
        const nameInput = document.getElementById('category-name');
        if(nameInput) {
            nameInput.value = name;
            nameInput.disabled = false;
        }
        
        // 3. 分类层级：不可编辑
        const levelInput = document.getElementById('category-level');
        if(levelInput) {
            if(levelText.includes('一级')) levelInput.value = '1';
            else if(levelText.includes('二级')) levelInput.value = '2';
            else if(levelText.includes('三级')) levelInput.value = '3';
            toggleParentCategory();
            levelInput.disabled = true;
        }

        // 4. 父级分类：不可编辑
        const parentInput = document.getElementById('parent-category');
        if(parentInput) {
            if(parentCode !== '-') {
                 const options = parentInput.options;
                 for(let i=0; i<options.length; i++) {
                     if(options[i].text.includes(parentCode)) {
                         parentInput.selectedIndex = i;
                         break;
                     }
                 }
            }
            parentInput.disabled = true;
        }
        
        // 5. 是否关联项目：可编辑
        const relatedInput = document.getElementById('category-related-project');
        if(relatedInput) {
            relatedInput.value = related === '是' ? 'yes' : 'no';
            relatedInput.disabled = false;
        }
        toggleCategoryProjectField();
        
        // 6. 关联项目分类：可编辑
        const cascaderText = document.getElementById('category-project-cascader-text');
        if(cascaderText) cascaderText.innerText = projectCats;
        const cascader = document.getElementById('category-project-cascader');
        if(cascader) {
            cascader.style.pointerEvents = 'auto';
            cascader.style.opacity = '1';
        }

        // 7. 状态：可编辑
        const statusInput = document.getElementById('category-status-input');
        const statusCheckbox = document.getElementById('category-status-checkbox');
        const statusText = document.getElementById('category-status-text');
        
        if (status === '启用') {
            if(statusInput) statusInput.value = 'active';
            if(statusCheckbox) statusCheckbox.checked = true;
            if(statusText) statusText.innerText = '启用';
        } else {
            if(statusInput) statusInput.value = 'inactive';
            if(statusCheckbox) statusCheckbox.checked = false;
            if(statusText) statusText.innerText = '禁用';
        }
        if(statusCheckbox) statusCheckbox.disabled = false;

        document.getElementById('add-category-modal').classList.remove('hidden');
    }

    function openAddCategoryModal(parentCode, parentName) {
        // 重置为新增模式
        const title = document.querySelector('#add-category-modal h3');
        if(title) title.innerText = '新增档案分类';
        
        // 设置按钮文字为“保存”
        const confirmBtn = document.getElementById('btn-confirm-category');
        if(confirmBtn) {
            confirmBtn.onclick = confirmAddCategory;
            confirmBtn.innerText = '保存';
        }

        // 重置所有输入框为可编辑状态
        const codeInput = document.getElementById('category-code');
        if(codeInput) {
            codeInput.value = '';
            codeInput.disabled = false;
        }
        const nameInput = document.getElementById('category-name');
        if(nameInput) {
            nameInput.value = '';
            nameInput.disabled = false;
        }
        const levelInput = document.getElementById('category-level');
        if(levelInput) {
            levelInput.value = '1'; // 默认一级分类
            levelInput.disabled = false;
        }
        const parentInput = document.getElementById('parent-category');
        if(parentInput) {
            parentInput.value = ''; // 默认无父级
            parentInput.disabled = false;
        }
        // 根据默认层级（一级）更新父级分类显示状态
        toggleParentCategory();

        const relatedInput = document.getElementById('category-related-project');
        if(relatedInput) {
            relatedInput.value = 'no'; // 默认不关联
            relatedInput.disabled = false;
        }
        toggleCategoryProjectField();
        
        // 重置关联项目分类级联选择器
        const cascaderText = document.getElementById('category-project-cascader-text');
        if(cascaderText) cascaderText.innerText = '请选择项目分类';
        // 清空级联选择器选中状态
        const checkboxes = document.querySelectorAll('#category-project-cascader input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);

        // 启用级联选择器
        const cascader = document.getElementById('category-project-cascader');
        if(cascader) {
            cascader.style.pointerEvents = 'auto';
            cascader.style.opacity = '1';
        }
        
        // 重置状态为启用且可编辑
        const statusInput = document.getElementById('category-status-input');
        const statusCheckbox = document.getElementById('category-status-checkbox');
        const statusText = document.getElementById('category-status-text');
        
        if(statusInput) statusInput.value = 'active';
        if(statusCheckbox) {
            statusCheckbox.checked = true;
            statusCheckbox.disabled = false;
        }
        if(statusText) statusText.innerText = '启用';

        document.getElementById('add-category-modal').classList.remove('hidden');
        if(parentCode && parentName) {
            if(parentInput) parentInput.value = parentCode;
            if(levelInput) levelInput.value = '2';
            toggleParentCategory();
        }
    }
    function closeAddCategoryModal() {
        document.getElementById('add-category-modal').classList.add('hidden');
    }
    function toggleParentCategory() {
        const level = document.getElementById('category-level').value;
        const parentDiv = document.getElementById('parent-category-div');
        if(parentDiv) parentDiv.style.display = level === '1' ? 'none' : 'block';
    }
    function confirmAddCategory() {
        closeAddCategoryModal();
        showToast('分类新增成功', 'success');
    }

    function confirmSaveCategory() {
        closeAddCategoryModal();
        showToast('分类保存成功', 'success');
    }

    // 保存操作
    function savePermission() {
        showToast('权限配置已保存', 'success');
    }
    function saveDirectory() {
        if (!carrierSelections.includes('电子档案')) {
            ensureElectronicCarrierSelected();
            showToast('档案载体必须选择电子档案', 'warning');
            return;
        }
        showToast('档案目录保存成功', 'success');
        setTimeout(() => showPage('archive-directory'), 800);
    }
    function saveDraft() {
        showToast('草稿已保存', 'success');
    }
    function submitApproval() {
        showToast('上传申请已提交', 'success');
        setTimeout(() => showPage('archive-list'), 1500);
    }
     function approvalRejected() {
        showToast('已拒绝上传申请', 'success');
        setTimeout(() => showPage('archive-list'), 1500);
    }
     function approved() {
        showToast('已同意上传申请', 'success');
        setTimeout(() => showPage('archive-list'), 1500);
    }

    // AI检查弹窗
    function showAICheckDetail() {
        document.getElementById('ai-check-modal').classList.remove('hidden');
    }
    function closeAICheckModal() {
        document.getElementById('ai-check-modal').classList.add('hidden');
    }

    // 预览
    function openPreview() {
        window.open('https://pdfobject.com/pdf/sample.pdf', '_blank');
    }

    // 删除文件（卡片形式保留给需要的地方，表格形式使用removeTableRow）
    function removeFile(btn) {
        btn.closest('.file-card').remove();
    }

    // 表格行删除（用于文件清单表格）
    function removeTableRow(btn) {
        const row = btn.closest('tr');
        row.remove();
    }

    // Toast提示
    function showToast(message, type) {
        const toast = document.getElementById('toast');
        const icon = document.getElementById('toast-icon');
        const title = document.getElementById('toast-title');
        const msg = document.getElementById('toast-message');

        msg.textContent = message;
        if(type === 'success') {
            icon.className = 'fas fa-check-circle text-success text-xl';
            title.textContent = '操作成功';
        } else if (type === 'warning') {
            icon.className = 'fas fa-exclamation-triangle text-warning text-xl';
            title.textContent = '警告';
        } else {
            icon.className = 'fas fa-info-circle text-primary text-xl';
            title.textContent = '提示';
        }

        toast.classList.remove('translate-x-full');
        setTimeout(() => toast.classList.add('translate-x-full'), 3000);
    }

    // 撤回审批弹窗控制
    function showWithdrawModal() {
        const withdrawBtn = document.getElementById('withdrawBtn');
        if (withdrawBtn && withdrawBtn.disabled) {
            showToast('请至少选择一条"审批中"的申请单', 'info');
            return;
        }
        document.getElementById('withdraw-modal').classList.remove('hidden');
    }

    function closeWithdrawModal() {
        document.getElementById('withdraw-modal').classList.add('hidden');
    }

    function confirmWithdraw() {
        closeWithdrawModal();
        showToast('申请单已撤回，状态变更为"已撤回"', 'success');
    }

    // 监听复选框变化，控制撤回审批按钮状态
    function updateWithdrawButton() {
        const checkboxes = document.querySelectorAll('#page-archive-list tbody input[type="checkbox"]');
        const withdrawBtn = document.getElementById('withdrawBtn');
        if (!withdrawBtn) return;

        let hasPending = false;

        checkboxes.forEach(cb => {
            if (cb.checked && cb.dataset.status === 'pending') {
                hasPending = true;
            }
        });

        if (hasPending) {
            withdrawBtn.disabled = false;
            withdrawBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            withdrawBtn.disabled = true;
            withdrawBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    // 为归档申请列表页的复选框添加事件监听
    document.addEventListener('click', function(e) {
        if (e.target.matches('#page-archive-list tbody input[type="checkbox"]')) {
            updateWithdrawButton();
        }
    });

    // 显示/隐藏必有条件列表
    function toggleConditionList() {
        const select = document.getElementById('is-required-select');
        const section = document.getElementById('condition-list-section');
        const conditionalField = document.getElementById('conditional-field');

        if (select && select.value === 'conditional') {
            section.classList.remove('hidden');
            if(conditionalField) conditionalField.style.display = 'block';
        } else {
            if (section) section.classList.add('hidden');
            if(conditionalField) conditionalField.style.display = 'none';
        }
    }

    // 显示/隐藏关联项目分类（当是否关联项目为"否"时隐藏）
    function toggleProjectCategory() {
        const field = document.getElementById('project-category-field');
        const select = event.target;
        if (field && select) {
            field.style.display = select.value === '是' ? 'block' : 'none';
        }
    }

    // 三级联动下拉选择控件相关变量
    let cascadeSelections = {
        level1: [],
        level2: [],
        level3: []
    };

    const cascadeData = {
        '主营业务项目': {
            '重资产项目': ['建设项目', '并购项目'],
            '轻资产项目': ['技术服务', '运营服务']
        },
        '非主营业务项目': {
            '投资项目': ['股权投资', '债权投资'],
            '其他项目': ['咨询项目', '其他']
        }
    };

    function toggleCascadeDropdown() {
        const dropdown = document.getElementById('cascade-dropdown');
        dropdown.classList.toggle('hidden');
    }

    function closeCascadeDropdown() {
        const dropdown = document.getElementById('cascade-dropdown');
        dropdown.classList.add('hidden');
    }

    function selectCascadeLevel(level, value, element) {
        const checkbox = element.querySelector('input[type="checkbox"]');

        if (level === 1) {
            // 更新一级选择
            if (checkbox.checked) {
                cascadeSelections.level1.push(value);
            } else {
                cascadeSelections.level1 = cascadeSelections.level1.filter(v => v !== value);
            }

            // 更新二级选项
            updateLevel2Options();
        } else if (level === 2) {
            if (checkbox.checked) {
                cascadeSelections.level2.push(value);
            } else {
                cascadeSelections.level2 = cascadeSelections.level2.filter(v => v !== value);
            }
            updateLevel3Options();
        } else if (level === 3) {
            if (checkbox.checked) {
                cascadeSelections.level3.push(value);
            } else {
                cascadeSelections.level3 = cascadeSelections.level3.filter(v => v !== value);
            }
        }

        element.classList.toggle('selected', checkbox.checked);
        updateCascadeDisplay();

        // 阻止事件冒泡
        event.stopPropagation();
    }

    function updateLevel2Options() {
        const container = document.getElementById('level2-content');
        container.innerHTML = '';

        cascadeSelections.level1.forEach(level1Value => {
            const level2Data = cascadeData[level1Value] || {};
            Object.keys(level2Data).forEach(level2Value => {
                const div = document.createElement('div');
                div.className = 'multi-select-item';
                div.onclick = function() { selectCascadeLevel(2, level2Value, this); };
                const isSelected = cascadeSelections.level2.includes(level2Value);
                div.innerHTML = `<input type="checkbox" class="cascade-checkbox-2" ${isSelected ? 'checked' : ''} value="${level2Value}"> ${level2Value}`;
                if (isSelected) div.classList.add('selected');
                container.appendChild(div);
            });
        });

        if (cascadeSelections.level1.length === 0) {
            container.innerHTML = '<div class="text-xs text-gray-400 italic dark:text-gray-500">请先选择一级分类</div>';
        }
    }

    function updateLevel3Options() {
        const container = document.getElementById('level3-content');
        container.innerHTML = '';

        cascadeSelections.level2.forEach(level2Value => {
            cascadeSelections.level1.forEach(level1Value => {
                const level3Data = (cascadeData[level1Value] || {})[level2Value] || [];
                level3Data.forEach(level3Value => {
                    const div = document.createElement('div');
                    div.className = 'multi-select-item';
                    div.onclick = function() { selectCascadeLevel(3, level3Value, this); };
                    const isSelected = cascadeSelections.level3.includes(level3Value);
                    div.innerHTML = `<input type="checkbox" class="cascade-checkbox-3" ${isSelected ? 'checked' : ''} value="${level3Value}"> ${level3Value}`;
                    if (isSelected) div.classList.add('selected');
                    container.appendChild(div);
                });
            });
        });

        if (cascadeSelections.level2.length === 0) {
            container.innerHTML = '<div class="text-xs text-gray-400 italic dark:text-gray-500">请先选择二级分类</div>';
        }
    }

    function updateCascadeDisplay() {
        const display = document.querySelector('.multi-select-display');
        const allSelections = [...cascadeSelections.level1, ...cascadeSelections.level2, ...cascadeSelections.level3];

        if (allSelections.length === 0) {
            display.innerHTML = '<span class="text-gray-400 text-sm dark:text-gray-500">请选择项目分类</span>';
        } else {
            display.innerHTML = allSelections.map(val =>
                `<span class="multi-select-tag">
                    ${val}
                    <i class="fas fa-times multi-select-tag-remove" onclick="removeCascadeTag('${val}', event)"></i>
                </span>`
            ).join('');
        }
    }

    function removeCascadeTag(value, event) {
        event.stopPropagation();

        // 从各级别中移除
        cascadeSelections.level1 = cascadeSelections.level1.filter(v => v !== value);
        cascadeSelections.level2 = cascadeSelections.level2.filter(v => v !== value);
        cascadeSelections.level3 = cascadeSelections.level3.filter(v => v !== value);

        // 更新UI
        document.querySelectorAll('.cascade-checkbox-1').forEach(cb => {
            if (cb.value === value) {
                cb.checked = false;
                cb.closest('.multi-select-item').classList.remove('selected');
            }
        });

        updateLevel2Options();
        updateLevel3Options();
        updateCascadeDisplay();
    }

    function confirmCascadeSelection() {
        closeCascadeDropdown();
        showToast('已选择 ' + (cascadeSelections.level1.length + cascadeSelections.level2.length + cascadeSelections.level3.length) + ' 个项目分类', 'success');
    }

    // 档案目录页级联更新
    function updateDirectoryLevel2(level1) {
        const level2Select = document.getElementById('directory-level2');
        level2Select.innerHTML = '<option>请选择</option>';

        if (level1 === '科技档案') {
            level2Select.innerHTML += '<option>基建档案</option><option>投资档案</option>';
        } else if (level1 === '文书档案') {
            level2Select.innerHTML += '<option>行政文书</option><option>党群工作</option>';
        }
    }

    function updateDirectoryLevel3(level2) {
        const level3Select = document.getElementById('directory-level3');
        level3Select.innerHTML = '<option>请选择</option>';

        if (level2 === '基建档案') {
            level3Select.innerHTML += '<option>基建文件</option><option>施工资料</option><option>监理资料</option>';
        } else if (level2 === '投资档案') {
            level3Select.innerHTML += '<option>投资交易文件</option><option>投资决策文件</option>';
        } else if (level2 === '行政文书') {
            level3Select.innerHTML += '<option>行政发文</option><option>行政收文</option>';
        } else if (level2 === '党群工作') {
            level3Select.innerHTML += '<option>党委文件</option><option>工会文件</option>';
        }
    }

    // 添加必有条件行
    function addConditionRow() {
        const tbody = document.getElementById('condition-list-body');
        if (!tbody) return;
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td class="px-3 py-2 border dark:border-gray-600">
                <select class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="">请选择</option>
                    <option value="invest">投资模式</option>
                    <option value="business">项目业态</option>
                    <option value="case">案件类型</option>
                    <option value="major">是否重大案件</option>
                </select>
            </td>
            <td class="px-3 py-2 border dark:border-gray-600">
                <select class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="">请选择</option>
                    <option value="code1">CODE001</option>
                    <option value="code2">CODE002</option>
                </select>
            </td>
            <td class="px-3 py-2 border dark:border-gray-600">
                <select class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="must">必有</option>
                    <option value="optional">或有</option>
                </select>
            </td>
            <td class="px-3 py-2 border dark:border-gray-600">
                <input type="text" placeholder="请输入备注" class="w-full border border-gray-300 rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </td>
            <td class="px-3 py-2 border text-center dark:border-gray-600">
                <button onclick="removeConditionRow(this)" class="text-gray-400 hover:text-danger"><i class="fas fa-trash-alt"></i></button>
            </td>
        `;
        tbody.appendChild(newRow);
    }

    // 删除必有条件行
    function removeConditionRow(btn) {
        const row = btn.closest('tr');
        row.remove();
    }

    // 更新密级权限提示
    function updateSecurityHint(level) {
        const hintDiv = document.getElementById('security-hint');
        if (!hintDiv) return;

        let hintText = '';
        let hintClass = '';

        switch(level) {
            case 'top-secret':
                hintText = '最高权限';
                hintClass = 'text-red-600 dark:text-red-400';
                break;
            case 'secret':
                hintText = '机密级、秘密级、无密级';
                hintClass = 'text-orange-600 dark:text-orange-400';
                break;
            case 'confidential':
                hintText = '秘密级、无密级';
                hintClass = 'text-yellow-600 dark:text-yellow-400';
                break;
            case 'none':
                hintText = '无密级';
                hintClass = 'text-green-600 dark:text-green-400';
                break;
        }

        hintDiv.innerHTML = `<span><i class="fas fa-eye mr-2 text-primary"></i>用户可访问密级范围：</span>
                            <span class="font-semibold ${hintClass}">${hintText}</span>`;
    }

    // 资料类型弹窗相关变量
let currentMaterialTypeInput = null;
let selectedMaterialTypeValue = null;
let selectedMaterialTypeRow = null;
let currentBatchEditId = null; // 当前批量上传编辑的行ID

    // 打开资料类型选择弹窗（带1秒延时动态效果）
    function openMaterialTypeModal(inputElement) {
        currentMaterialTypeInput = inputElement;
        selectedMaterialTypeValue = null;
        selectedMaterialTypeRow = null;

        const modal = document.getElementById('material-type-modal');
        const tbody = document.getElementById('material-type-tbody');

        // 清除之前的选择效果
        tbody.querySelectorAll('tr').forEach(row => {
            row.classList.remove('selected');
        });

        // 如果文件清单放大编辑弹窗已打开，将资料类型弹窗层级设为最高
        const expandedModal = document.getElementById('file-list-expanded-modal');
        if (expandedModal && !expandedModal.classList.contains('hidden')) {
            modal.style.zIndex = '110';
        } else {
            modal.style.zIndex = '';
        }

        // 显示弹窗（触发CSS过渡效果）
        modal.classList.remove('hidden');

        // 初始化表格列宽调整
        setTimeout(() => {
            initTableResizing();
        }, 100);
    }

    // 打开资料类型选择弹窗（批量上传页面专用）
    function openMaterialTypeModalForBatch(id) {
        currentBatchEditId = id;
        currentMaterialTypeInput = null; // 不是输入框模式
        selectedMaterialTypeValue = null;
        selectedMaterialTypeRow = null;
        
        const modal = document.getElementById('material-type-modal');
        const tbody = document.getElementById('material-type-tbody');
        
        // 清除之前的选择效果
        tbody.querySelectorAll('tr').forEach(row => {
            row.classList.remove('selected');
        });
        
        // 如果文件清单放大编辑弹窗已打开，将资料类型弹窗层级设为最高
        const expandedModal = document.getElementById('file-list-expanded-modal');
        if (expandedModal && !expandedModal.classList.contains('hidden')) {
            modal.style.zIndex = '110';
        } else {
            modal.style.zIndex = '';
        }
        
        modal.classList.remove('hidden');
        
        setTimeout(() => {
            initTableResizing();
        }, 100);
    }

    // 关闭资料类型选择弹窗
    function closeMaterialTypeModal() {
        const modal = document.getElementById('material-type-modal');
        modal.classList.add('hidden');

        // 延时清理变量，等待过渡完成
        setTimeout(() => {
            currentMaterialTypeInput = null;
            selectedMaterialTypeValue = null;
            selectedMaterialTypeRow = null;
            currentBatchEditId = null;
        }, 1000);
    }

    // 选择资料类型（仅高亮，不关闭弹窗）
    function selectMaterialType(row, value) {
        // 移除之前选中的行效果
        if (selectedMaterialTypeRow) {
            selectedMaterialTypeRow.classList.remove('selected');
        }

        // 添加当前行选中效果
        row.classList.add('selected');
        selectedMaterialTypeValue = value;
        selectedMaterialTypeRow = row;
    }

    // 确认选择资料类型
    function confirmMaterialTypeSelection() {
        if (selectedMaterialTypeValue) {
            if (currentMaterialTypeInput) {
                // 输入框模式（文件清单表格）
                currentMaterialTypeInput.value = selectedMaterialTypeValue;
            } else if (currentBatchEditId !== null) {
                // 批量上传页面模式
                const typeSpan = document.getElementById(`batch-ai-type-${currentBatchEditId}`);
                if (typeSpan) {
                    typeSpan.innerHTML = `<i class="fas fa-robot mr-1"></i>${selectedMaterialTypeValue}`;
                    // 更新数据模型
                    const fileData = batchFiles.find(f => f.id === currentBatchEditId);
                    if (fileData) {
                        fileData.aiType = selectedMaterialTypeValue;
                    }
                }
                currentBatchEditId = null;
            }
            closeMaterialTypeModal();
            showToast('资料类型选择成功', 'success');
        } else {
            showToast('请先选择一行数据', 'warning');
        }
    }

    // 项目选择弹窗相关变量
    let currentProjectInput = null;
    let selectedProjectData = null;
    let selectedProjectRow = null;

    // 打开项目选择弹窗
    function openProjectSelectModal(inputElement) {
        currentProjectInput = inputElement;
        selectedProjectData = null;
        selectedProjectRow = null;
        
        // 重置选择状态
        document.querySelectorAll('.project-checkbox').forEach(cb => cb.checked = false);
        document.getElementById('select-all-project').checked = false;
        document.getElementById('project-selected-count').textContent = '0';
        document.getElementById('confirm-project-btn').disabled = true;
        document.querySelectorAll('.project-select-row').forEach(row => row.classList.remove('bg-blue-50', 'dark:bg-blue-900/20'));
        
        // 处理层级，确保弹窗在最上层
        const materialModal = document.getElementById('material-type-modal');
        const projectModal = document.getElementById('project-select-modal');
        
        if (materialModal && !materialModal.classList.contains('hidden')) {
            projectModal.style.zIndex = '110';
        } else {
            projectModal.style.zIndex = '';
        }
        
        projectModal.classList.remove('hidden');
        
        // 初始化表格列宽调整
        setTimeout(() => {
            initTableResizing();
        }, 100);
    }

    // 关闭项目选择弹窗
    function closeProjectSelectModal() {
        const modal = document.getElementById('project-select-modal');
        modal.classList.add('hidden');
        modal.style.zIndex = '';
        
        setTimeout(() => {
            currentProjectInput = null;
            selectedProjectData = null;
            selectedProjectRow = null;
        }, 300);
    }

    // 选择项目行（单选）
    function selectProjectRow(row, projectCode, projectName) {
        // 移除之前选中的行效果
        document.querySelectorAll('.project-select-row').forEach(r => {
            r.classList.remove('bg-blue-50', 'dark:bg-blue-900/20');
            r.querySelector('.project-checkbox').checked = false;
        });
        
        // 选中当前行
        row.classList.add('bg-blue-50', 'dark:bg-blue-900/20');
        row.querySelector('.project-checkbox').checked = true;
        
        selectedProjectData = {
            code: projectCode,
            name: projectName
        };
        selectedProjectRow = row;
        
        updateProjectSelectButton();
    }

    // 更新选择计数和按钮状态
    function updateProjectSelectButton() {
        const checkedCount = document.querySelectorAll('.project-checkbox:checked').length;
        document.getElementById('project-selected-count').textContent = checkedCount;
        document.getElementById('confirm-project-btn').disabled = checkedCount === 0;
        
        // 确保只有一个被选中（单选逻辑）
        if (checkedCount > 1) {
            document.querySelectorAll('.project-checkbox').forEach(cb => {
                if (!cb.checked) return;
                const row = cb.closest('tr');
                if (row !== selectedProjectRow) {
                    cb.checked = false;
                    row.classList.remove('bg-blue-50', 'dark:bg-blue-900/20');
                }
            });
            document.getElementById('project-selected-count').textContent = '1';
        }
    }

    // 全选/取消全选（限制为单选，实际上全选只选第一个）
    function toggleSelectAllProject(checkbox) {
        const checkboxes = document.querySelectorAll('.project-checkbox');
        if (checkbox.checked && checkboxes.length > 0) {
            // 模拟单选，只选第一个
            checkboxes.forEach(cb => cb.checked = false);
            document.querySelectorAll('.project-select-row').forEach(r => r.classList.remove('bg-blue-50', 'dark:bg-blue-900/20'));
            
            if (checkboxes[0]) {
                checkboxes[0].checked = true;
                const firstRow = checkboxes[0].closest('tr');
                firstRow.classList.add('bg-blue-50', 'dark:bg-blue-900/20');
                selectedProjectRow = firstRow;
                selectedProjectData = {
                    code: checkboxes[0].value,
                    name: firstRow.cells[2].textContent.trim()
                };
            }
        } else {
            checkboxes.forEach(cb => cb.checked = false);
            document.querySelectorAll('.project-select-row').forEach(r => r.classList.remove('bg-blue-50', 'dark:bg-blue-900/20'));
            selectedProjectData = null;
            selectedProjectRow = null;
        }
        updateProjectSelectButton();
    }

    // 筛选项目表格
    function filterProjectTable(input, columnIndex) {
        const filter = input.value.toLowerCase();
        const tbody = document.getElementById('project-select-tbody');
        if (!tbody) return;
        const rows = tbody.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            if (cells[columnIndex]) {
                const text = cells[columnIndex].textContent || cells[columnIndex].innerText;
                rows[i].style.display = text.toLowerCase().indexOf(filter) > -1 ? '' : 'none';
            }
        }
    }

    // 确认选择项目
    function confirmProjectSelection() {
        if (selectedProjectData && currentProjectInput) {
            currentProjectInput.value = selectedProjectData.name;
            // 将项目代码存储在自定义属性中供后续使用
            currentProjectInput.setAttribute('data-project-code', selectedProjectData.code);
            closeProjectSelectModal();
            showToast('项目选择成功', 'success');
        } else {
            showToast('请先选择一个项目', 'warning');
        }
    }

    // 筛选资料类型表格
    function filterMaterialType(input, columnIndex) {
        const filter = input.value.toLowerCase();
        const tbody = document.getElementById('material-type-tbody');
        const rows = tbody.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            let match = false;

            // 检查指定列
            if (cells[columnIndex]) {
                const text = cells[columnIndex].textContent || cells[columnIndex].innerText;
                if (text.toLowerCase().indexOf(filter) > -1) {
                    match = true;
                }
            }

            // 显示或隐藏行
            rows[i].style.display = match ? '' : 'none';
        }

        // 更新计数
        const visibleRows = Array.from(rows).filter(r => r.style.display !== 'none').length;
        document.getElementById('material-type-count').textContent = visibleRows;
    }

    // 拖拽文件功能相关函数
    function toggleDragZone(type) {
        const dragZone = document.getElementById('drag-zone-' + type);
        if (dragZone) {
            dragZone.classList.toggle('hidden');
            dragZone.classList.toggle('active');
        }
    }

    function handleDragOver(e) {
        e.preventDefault();
        e.stopPropagation();
        e.currentTarget.classList.add('border-primary', 'bg-blue-50', 'dark:border-blue-400', 'dark:bg-blue-900/20');
        e.currentTarget.classList.remove('border-gray-300');
    }

    function handleDragLeave(e) {
        e.preventDefault();
        e.stopPropagation();
        e.currentTarget.classList.remove('border-primary', 'bg-blue-50', 'dark:border-blue-400', 'dark:bg-blue-900/20');
        e.currentTarget.classList.add('border-gray-300');
    }

    function handleDrop(e, type) {
        e.preventDefault();
        e.stopPropagation();
        e.currentTarget.classList.remove('border-primary', 'bg-blue-50', 'dark:border-blue-400', 'dark:bg-blue-900/20');
        e.currentTarget.classList.add('border-gray-300');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            showToast('成功拖拽上传 ' + files.length + ' 个文件', 'success');
            handleDroppedFiles(files, type);
        }
    }

    function handleDroppedFiles(files, type) {
        console.log('处理拖拽文件:', files, '类型:', type);
    }

    // 分页控件 - 改变每页显示条数
    function changePageSize(size) {
        showToast('每页显示条数已更改为 ' + size, 'success');
        // 这里可以添加实际的分页逻辑
    }

    // 表格列宽调整功能
    function initTableResizing() {
        const tables = document.querySelectorAll('.data-table');

        tables.forEach(table => {
            const ths = table.querySelectorAll('th');

            ths.forEach(th => {
                const handle = th.querySelector('.resize-handle');
                if (!handle) return;

                handle.addEventListener('mousedown', initDrag);
            });
        });
    }

    let isResizing = false;
    let currentTh = null;
    let startX = 0;
    let startWidth = 0;

    function initDrag(e) {
        isResizing = true;
        currentTh = this.parentElement;
        startX = e.pageX;
        startWidth = currentTh.offsetWidth;

        this.classList.add('resizing');

        document.addEventListener('mousemove', doDrag);
        document.addEventListener('mouseup', stopDrag);

        e.preventDefault();
    }

    function doDrag(e) {
        if (!isResizing || !currentTh) return;

        const diff = e.pageX - startX;
        const newWidth = startWidth + diff;

        if (newWidth > 50) { // 最小宽度50px
            currentTh.style.width = newWidth + 'px';
            currentTh.style.minWidth = newWidth + 'px';
        }
    }

    function stopDrag() {
        if (currentTh) {
            const handle = currentTh.querySelector('.resize-handle');
            if (handle) handle.classList.remove('resizing');
        }

        isResizing = false;
        currentTh = null;

        document.removeEventListener('mousemove', doDrag);
        document.removeEventListener('mouseup', stopDrag);
    }

    // 点击外部关闭级联下拉框
    document.addEventListener('click', function(e) {
        const container = document.querySelector('.multi-select-container');
        const dropdown = document.getElementById('cascade-dropdown');

        if (container && dropdown && !container.contains(e.target)) {
            dropdown.classList.add('hidden');
        }
    });


    // 文件清单放大编辑分页相关变量
    let expandedCurrentPage = 1;
    let expandedPageSize = 10;
    let expandedTotalRows = 0;
    let expandedAllRows = [];

    // 文件清单放大编辑功能
    function toggleFileListExpand() {
        const modal = document.getElementById('file-list-expanded-modal');
        const sourceTable = document.getElementById('file-list-table');
        const targetTable = document.getElementById('file-list-expanded-table');

        if (modal.classList.contains('hidden')) {
            // 复制表格内容到放大模式
            targetTable.innerHTML = sourceTable.innerHTML;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            // 初始化分页
            initExpandedPagination();
            initTableResizing();
        } else {
            closeFileListExpanded();
        }
    }

    // 初始化分页数据
    function initExpandedPagination() {
        const tbody = document.querySelector('#file-list-expanded-table tbody');
        if (!tbody) {
            expandedTotalRows = 0;
            updateExpandedPaginationInfo();
            return;
        }

        // 获取所有数据行（排除筛选行）
        expandedAllRows = Array.from(tbody.querySelectorAll('tr')).filter(row => !row.classList.contains('header-filter'));
        expandedTotalRows = expandedAllRows.length;

        // 重置到第一页
        expandedCurrentPage = 1;
        document.getElementById('expanded-page-size').value = expandedPageSize;

        // 渲染当前页
        renderExpandedTable();
        updateExpandedPagination();
    }

    // 渲染表格（根据当前页码显示对应行）
    function renderExpandedTable() {
        const start = (expandedCurrentPage - 1) * expandedPageSize;
        const end = Math.min(start + expandedPageSize, expandedTotalRows);

        expandedAllRows.forEach((row, index) => {
            if (index >= start && index < end) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });

        updateExpandedPaginationInfo();
    }

    // 更新分页信息显示
    function updateExpandedPaginationInfo() {
        const start = expandedTotalRows > 0 ? (expandedCurrentPage - 1) * expandedPageSize + 1 : 0;
        const end = Math.min(expandedCurrentPage * expandedPageSize, expandedTotalRows);

        document.getElementById('expanded-page-start').textContent = start;
        document.getElementById('expanded-page-end').textContent = end;
        document.getElementById('expanded-total-count').textContent = expandedTotalRows;
    }

    // 更新分页控件
    function updateExpandedPagination() {
        const totalPages = Math.ceil(expandedTotalRows / expandedPageSize) || 1;
        const controls = document.getElementById('expanded-pagination-controls');

        let html = '';

        // 上一页按钮
        html += `<button class="pagination-btn" onclick="changeExpandedPage(${expandedCurrentPage - 1})" ${expandedCurrentPage === 1 ? 'disabled' : ''}>
            <i class="fas fa-chevron-left"></i>
        </button>`;

        // 页码按钮（简化显示，最多显示5个）
        const maxButtons = 5;
        let startPage = Math.max(1, expandedCurrentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);

        if (endPage - startPage < maxButtons - 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
        }

        if (startPage > 1) {
            html += `<button class="pagination-btn" onclick="changeExpandedPage(1)">1</button>`;
            if (startPage > 2) html += `<span class="px-2 text-gray-400">...</span>`;
        }

        for (let i = startPage; i <= endPage; i++) {
            html += `<button class="pagination-btn ${i === expandedCurrentPage ? 'active' : ''}" onclick="changeExpandedPage(${i})">${i}</button>`;
        }

        if (endPage < totalPages) {
            if (endPage < totalPages - 1) html += `<span class="px-2 text-gray-400">...</span>`;
            html += `<button class="pagination-btn" onclick="changeExpandedPage(${totalPages})">${totalPages}</button>`;
        }

        // 下一页按钮
        html += `<button class="pagination-btn" onclick="changeExpandedPage(${expandedCurrentPage + 1})" ${expandedCurrentPage === totalPages ? 'disabled' : ''}>
            <i class="fas fa-chevron-right"></i>
        </button>`;

        controls.innerHTML = html;
    }

    // 切换页码
    function changeExpandedPage(page) {
        const totalPages = Math.ceil(expandedTotalRows / expandedPageSize) || 1;

        if (page < 1 || page > totalPages) return;

        expandedCurrentPage = page;
        renderExpandedTable();
        updateExpandedPagination();

        // 滚动到顶部
        const container = document.querySelector('#file-list-expanded-modal .table-container');
        if (container) container.scrollTop = 0;
    }

    // 切换每页显示行数
    function changeExpandedPageSize(size) {
        expandedPageSize = parseInt(size);
        expandedCurrentPage = 1; // 重置到第一页
        renderExpandedTable();
        updateExpandedPagination();
    }

    function closeFileListExpanded(event) {
        if (event && event.target !== event.currentTarget && !event.target.closest('.close-expanded-btn') && !event.target.closest('button') && !event.target.closest('.pagination-container')) {
            return;
        }

        const modal = document.getElementById('file-list-expanded-modal');
        const sourceTable = document.getElementById('file-list-table');
        const targetTable = document.getElementById('file-list-expanded-table');

        // 同步内容回原表格（显示所有行，确保不丢失隐藏的数据）
        if (targetTable.innerHTML !== '') {
            // 先显示所有行再复制
            expandedAllRows.forEach(row => row.style.display = '');
            sourceTable.innerHTML = targetTable.innerHTML;
        }

        // 重置分页变量
        expandedCurrentPage = 1;
        expandedAllRows = [];

        modal.classList.add('hidden');
        document.body.style.overflow = '';
        showToast('已保存编辑内容', 'success');
    }

    // AI智能上传相关变量
    let batchFiles = [];
    let aiProcessing = false;
    
    // 批量上传文件选择
    function handleBatchFileSelect(input) {
        const files = Array.from(input.files);
        if (files.length > 0) {
            processBatchFiles(files);
        }
    }
    
    // 批量拖拽上传
    function handleBatchUploadDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        e.currentTarget.classList.remove('border-primary', 'bg-blue-50', 'dark:border-blue-400', 'dark:bg-blue-900/20');
        e.currentTarget.classList.add('border-gray-300');
        
        const files = Array.from(e.dataTransfer.files);
        if (files.length > 0) {
            processBatchFiles(files);
        }
    }
    
    // 处理批量文件（AI识别）
    function processBatchFiles(files) {
        batchFiles = files.map((file, index) => ({
            id: index + 1,
            file: file,
            name: file.name,
            aiType: '', // AI识别的资料类型
            title: '',  // 提取的题名
            author: '', // 责任者
            date: '',   // 成文日期
            pages: 0,   // 页数
            level: '无密级',
            category: '', // 匹配的分类
            confidence: Math.floor(Math.random() * 10) + 90 // 模拟置信度90-99%
        }));
        
        // 显示AI处理进度条
        document.getElementById('ai-processing-bar').classList.remove('hidden');
        aiProcessing = true;
        
        // 模拟AI处理过程
        let processed = 0;
        const total = files.length;
        const interval = setInterval(() => {
            processed++;
            const percent = Math.floor((processed / total) * 100);
            document.getElementById('ai-process-percent').textContent = percent + '%';
            document.getElementById('ai-progress-bar').style.width = percent + '%';
            document.getElementById('ai-process-status').textContent = `正在分析文件 ${processed}/${total}...`;
            
            // 模拟AI识别结果
            if (processed <= total) {
                simulateAIRecognition(processed - 1);
            }
            
            if (processed >= total) {
                clearInterval(interval);
                setTimeout(() => {
                    document.getElementById('ai-processing-bar').classList.add('hidden');
                    aiProcessing = false;
                    renderBatchTable();
                    showToast(`AI识别完成，成功识别 ${total} 个文件`, 'success');
                }, 500);
            }
        }, 300); // 每300ms处理一个文件
    }
    
    // 模拟AI识别（实际项目中应调用AI接口）
    function simulateAIRecognition(index) {
        const fileData = batchFiles[index];
        const fileName = fileData.name.toLowerCase();
        
        // 根据文件名模拟AI识别结果
        if (fileName.includes('施工') || fileName.includes('方案')) {
            fileData.aiType = '施工组织设计';
            fileData.category = '科技档案/基建档案/施工资料';
            fileData.title = fileData.name.replace('.pdf', '').replace('.doc', '');
            fileData.author = '南京某建筑公司';
            fileData.pages = Math.floor(Math.random() * 50) + 10;
        } else if (fileName.includes('技术交底') || fileName.includes('交底')) {
            fileData.aiType = '技术交底';
            fileData.category = '科技档案/基建档案/施工资料';
            fileData.title = '技术交底记录_' + (index + 1);
            fileData.author = '技术部';
            fileData.pages = Math.floor(Math.random() * 20) + 5;
        } else if (fileName.includes('验收') || fileName.includes('质量')) {
            fileData.aiType = '质量验收';
            fileData.category = '科技档案/基建档案/施工资料';
            fileData.title = '质量验收记录_' + (index + 1);
            fileData.author = '质检部';
            fileData.pages = Math.floor(Math.random() * 15) + 3;
        } else {
            fileData.aiType = '其他资料';
            fileData.category = '科技档案/基建档案/其他';
            fileData.title = fileData.name.replace(/\.[^/.]+$/, '');
            fileData.author = '项目部';
            fileData.pages = Math.floor(Math.random() * 30) + 5;
        }
        
        // 生成随机日期（2026年1月内）
        const day = Math.floor(Math.random() * 28) + 1;
        fileData.date = `2026-01-${day.toString().padStart(2, '0')}`;
    }
    
    // 渲染批量上传表格
    function renderBatchTable() {
        const tbody = document.getElementById('batch-upload-tbody');
        document.getElementById('ai-recognized-count').textContent = batchFiles.length;
        document.getElementById('batch-submit-count').textContent = batchFiles.length;
        
        if (batchFiles.length === 0) {
            tbody.innerHTML = `
                <tr class="text-center text-gray-500 dark:text-gray-400" id="empty-batch-tip">
                    <td colspan="11" class="py-8">
                        <i class="fas fa-inbox text-4xl mb-2 text-gray-300 dark:text-gray-600"></i>
                        <p>请上传文件，AI将自动识别分类</p>
                    </td>
                </tr>
            `;
            return;
        }
        
         tbody.innerHTML = batchFiles.map((item, index) => `
            <tr class="dark:bg-gray-800">
                <td class="sticky left-0 bg-white dark:bg-gray-800 z-10">
                    <input type="checkbox" class="batch-item-checkbox w-4 h-4 text-primary rounded focus:ring-primary" value="${item.id}" checked onchange="updateBatchSubmitCount()">
                </td>
                <td class="text-center font-medium text-gray-900 sticky left-10 bg-white dark:bg-gray-800 dark:text-white z-10">${index + 1}</td>
                <td class="dark:text-gray-300">
                    <a href="#" onclick="openPreview(); return false;" class="text-primary hover:underline text-xs">${item.name}</a>
                </td>
                    <td class="dark:text-gray-300">
                    <div class="flex items-center gap-1 cursor-pointer hover:opacity-80" onclick="openMaterialTypeModalForBatch(${item.id})" title="点击修改资料类型">
                        <span class="px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs dark:bg-purple-900 dark:text-purple-300" id="batch-ai-type-${item.id}">
                            <i class="fas fa-robot mr-1"></i>${item.aiType}
                        </span>
                        <span class="text-xs text-success">${item.confidence}%</span>
                        <i class="fas fa-edit text-xs text-gray-400 ml-1 dark:text-gray-500"></i>
                    </div>
                </td>
                <td><input type="text" value="${item.title}" class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"></td>
                <td><input type="text" value="${item.author}" class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"></td>
                <td><input type="date" value="${item.date}" class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"></td>
                <td><input type="text" placeholder="请输入文号" class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"></td>
                <td>
                    <div class="relative">
                        <input type="text" value="成都某水厂改扩建项目" readonly 
                            class="w-full bg-white border border-gray-300 rounded px-2 py-1 text-xs cursor-pointer hover:border-primary focus:outline-none focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white project-select-input"
                            onclick="openProjectSelectModal(this)"
                            placeholder="点击选择项目">
                        <i class="fas fa-search absolute right-2 top-1.5 text-gray-400 text-xs"></i>
                    </div>
                </td>
                <td><select class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option>-</option><option>项目启动会</option><option>周例会</option></select></td>
                <td><select class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option>-</option><option>施工方案确认</option></select></td>
                <td>
                    <select class="w-full border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option ${item.level === '无密级' ? 'selected' : ''}>无密级</option>
                        <option ${item.level === '秘密级' ? 'selected' : ''}>秘密级</option>
                        <option ${item.level === '机密级' ? 'selected' : ''}>机密级</option>
                    </select>
                </td>
                <td><input type="number" value="${item.pages}" class="w-full text-center border border-gray-300 rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white"></td>
                <td class="text-xs text-gray-500 dark:text-gray-400">${item.category}</td>
                <td class="text-center">
                    <button onclick="removeBatchFile(${item.id})" class="text-gray-400 hover:text-danger"><i class="fas fa-trash-alt"></i></button>
                </td>
            </tr>
        `).join('');
        
        updateBatchSubmitCount();
    }
    
    // 更新批量提交计数
    function updateBatchSubmitCount() {
        const checked = document.querySelectorAll('.batch-item-checkbox:checked').length;
        document.getElementById('batch-submit-count').textContent = checked;
    }
    
    // 全选/取消全选批量文件
    function toggleSelectAllBatch(checkbox) {
        document.querySelectorAll('.batch-item-checkbox').forEach(cb => {
            cb.checked = checkbox.checked;
        });
        updateBatchSubmitCount();
    }
    
    // 删除单个批量文件
    function removeBatchFile(id) {
        batchFiles = batchFiles.filter(f => f.id !== id);
        renderBatchTable();
        updateBatchSubmitCount();
    }
    
    // 清空所有文件
    function clearAllFiles() {
        if (confirm('确定清空所有已上传的文件吗？')) {
            batchFiles = [];
            renderBatchTable();
            document.getElementById('batch-submit-count').textContent = '0';
        }
    }
    
    // 重新识别所有文件
    function reAnalyzeAll() {
        if (batchFiles.length === 0) {
            showToast('请先上传文件', 'warning');
            return;
        }
        processBatchFiles(batchFiles.map(f => f.file));
    }
    
    // 保存批量草稿
    function saveDraftBatch() {
        showToast('批量草稿已保存', 'success');
    }
    
    // 批量提交审批
    function submitBatchApproval() {
        const count = document.querySelectorAll('.batch-item-checkbox:checked').length;
        if (count === 0) {
            showToast('请至少选择一个文件', 'warning');
            return;
        }
        if (confirm(`确定提交 ${count} 个文件进行审批吗？`)) {
            showToast(`成功提交 ${count} 个文件`, 'success');
            setTimeout(() => showPage('archive-list'), 1500);
        }
    }
    
    // 文件审批页相关函数
    let selectedApprovalFiles = [];
    let currentBatchAction = ''; // 'approve' 或 'reject'
    
    // 更新审批选择计数
    function updateApprovalCount() {
        const checkboxes = document.querySelectorAll('.approval-checkbox:checked');
        selectedApprovalFiles = Array.from(checkboxes).map(cb => cb.value);
        const count = selectedApprovalFiles.length;
        
        document.getElementById('selected-approval-count').textContent = count;
        document.getElementById('batch-approve-btn').disabled = count === 0;
        document.getElementById('batch-reject-btn').disabled = count === 0;
        
        // 更新计数徽章颜色
        const badge = document.getElementById('selected-approval-count');
        if (count > 0) {
            badge.classList.add('animate-pulse');
        } else {
            badge.classList.remove('animate-pulse');
        }
    }
    
    // 全选/取消全选审批文件
    function toggleSelectAllApproval(checkbox) {
        document.querySelectorAll('.approval-checkbox').forEach(cb => {
            cb.checked = checkbox.checked;
        });
        updateApprovalCount();
    }
    
    // 批量同意
    function batchApproveFiles() {
        currentBatchAction = 'approve';
        const count = selectedApprovalFiles.length;
        if (count === 0) return;
        
        document.getElementById('batch-approval-count-display').textContent = count;
        document.getElementById('batch-approval-panel').classList.remove('hidden');
        document.getElementById('batch-approval-comment').placeholder = '请输入同意意见（选填，如：同意归档，资料完整）...';
    }
    
    // 批量拒绝
    function batchRejectFiles() {
        currentBatchAction = 'reject';
        const count = selectedApprovalFiles.length;
        if (count === 0) return;
        
        document.getElementById('batch-approval-count-display').textContent = count;
        document.getElementById('batch-approval-panel').classList.remove('hidden');
        document.getElementById('batch-approval-comment').placeholder = '请输入拒绝原因（必填）...';
    }
    
    // 关闭批量审批面板
    function closeBatchApprovalPanel() {
        document.getElementById('batch-approval-panel').classList.add('hidden');
        document.getElementById('batch-approval-comment').value = '';
    }
    
    // 确认批量操作
    function confirmBatchAction() {
        const comment = document.getElementById('batch-approval-comment').value;
        const count = selectedApprovalFiles.length;
        
        if (currentBatchAction === 'reject' && !comment.trim()) {
            showToast('拒绝时必须填写拒绝原因', 'warning');
            return;
        }
        
        const actionText = currentBatchAction === 'approve' ? '同意' : '拒绝';
        showToast(`已${actionText} ${count} 个文件`, 'success');
        
        closeBatchApprovalPanel();
        
        // 清空选择
        document.querySelectorAll('.approval-checkbox').forEach(cb => {
            cb.checked = false;
        });
        document.getElementById('select-all-approval').checked = false;
        updateApprovalCount();
    }
    
    // 单个文件预览
    function previewFile(id) {
        openPreview();
    }
    
    // 单个同意
    function singleApprove(id) {
        if (confirm('确定同意该文件归档吗？')) {
            showToast('已同意归档', 'success');
        }
    }
    
    // 单个拒绝
    function singleReject(id) {
        const reason = prompt('请输入拒绝原因：');
        if (reason) {
            showToast('已拒绝归档', 'success');
        }
    }
    
    // 筛选审批状态
    function filterApprovalStatus(status) {
        showToast(`已筛选状态：${status === 'all' ? '全部' : status}`, 'success');
    }

    // 文件清单页相关函数
    function toggleSelectAllFileList(checkbox) {
        document.querySelectorAll('.file-list-checkbox:not([disabled])').forEach(cb => {
            cb.checked = checkbox.checked;
        });
        updateFileListBatchCount();
    }

    function updateFileListBatchCount() {
        const checked = document.querySelectorAll('.file-list-checkbox:checked').length;
        const countSpan = document.getElementById('batch-submit-file-count');
        const btn = document.getElementById('batch-submit-file-list-btn');
        if (countSpan) countSpan.textContent = checked;
        if (btn) btn.disabled = checked === 0;
    }

    function batchSubmitFileList() {
        const count = document.querySelectorAll('.file-list-checkbox:checked').length;
        if (count === 0) {
            showToast('请至少选择一个文件', 'warning');
            return;
        }
        if (confirm(`确定批量提交 ${count} 个文件进行审批吗？`)) {
            showToast(`成功提交 ${count} 个文件`, 'success');
            // 实际项目中这里应该调用提交API并刷新列表
            setTimeout(() => {
                location.reload(); // 模拟刷新
            }, 1000);
        }
    }

    function filterFileList(input, columnIndex) {
        const filter = input.value.toLowerCase();
        const table = document.getElementById('file-list-table');
        if (!table) return;
        const tbody = table.getElementsByTagName('tbody')[0];
        const rows = tbody.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            if (cells[columnIndex]) {
                const text = cells[columnIndex].textContent || cells[columnIndex].innerText;
                rows[i].style.display = text.toLowerCase().indexOf(filter) > -1 ? '' : 'none';
            }
        }
    }

    function filterFileListStatus(status) {
        const table = document.getElementById('file-list-table');
        if (!table) return;
        const tbody = table.getElementsByTagName('tbody')[0];
        const rows = tbody.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            if (status === 'all') {
                rows[i].style.display = '';
                continue;
            }
            const statusCell = rows[i].cells[8]; // 审批状态列
            if (statusCell) {
                const statusText = statusCell.textContent.toLowerCase();
                const match = (status === 'draft' && statusText.includes('待提交')) ||
                             (status === 'pending' && statusText.includes('审批中')) ||
                             (status === 'approved' && statusText.includes('已通过')) ||
                             (status === 'rejected' && statusText.includes('已拒绝'));
                rows[i].style.display = match ? '' : 'none';
            }
        }
    }

    function editFile(id) {
        showToast('进入文件编辑页面', 'success');
        // 实际项目中这里应该跳转到编辑页面或打开编辑弹窗
        // showPage('file-edit', id);
    }

    function submitSingleFile(id) {
        if (confirm('确定提交该文件进行审批吗？')) {
            showToast('文件已提交审批', 'success');
            // 实际项目中这里应该调用提交API
        }
    }

    function deleteFile(id) {
        if (confirm('确定删除该文件吗？删除后不可恢复。')) {
            showToast('文件已删除', 'success');
            // 实际项目中这里应该调用删除API并移除行
            event.target.closest('tr').remove();
        }
    }

    function withdrawFile(id) {
        if (confirm('确定撤回该文件的审批申请吗？撤回后可重新编辑提交。')) {
            showToast('文件已撤回', 'success');
            // 实际项目中这里应该调用撤回API
        }
    }

    function viewArchiveDetail(id) {
        showPage('archive-detail-archived');
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
        // 默认显示工作台
        showPage('dashboard');

        // 初始化标签页
        renderTabs();

        // 初始化表格列宽调整
        initTableResizing();

        setupCarrierCheckboxListeners();

        // 监听窗口大小变化，处理抽屉菜单状态
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');

            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('sidebar-collapsed');
                sidebar.classList.add('w-64');
                overlay.classList.add('hidden');
            } else {
                sidebar.classList.add('sidebar-collapsed');
                sidebar.classList.remove('w-64');
            }
        });

        // 初始检查窗口大小
        if (window.innerWidth < 1024) {
            document.getElementById('sidebar').classList.add('sidebar-collapsed');
            document.getElementById('sidebar').classList.remove('w-64');
        }

       // 为绝密级档案行添加特殊提示
    document.querySelectorAll('.top-secret-row').forEach(row => {
        row.addEventListener('click', function(e) {
            if (e.target.closest('td:nth-child(7)')) { // 题名列
                e.preventDefault();
                e.stopPropagation();
                showToast('绝密级档案不可查看详情', 'warning');
            }
        });
    });

    });
    
    
    // 级联选择器功能 - 移至全局作用域以支持HTML， onclick属性
    function toggleCascader(id) {
        const container = document.getElementById(id);
        const dropdown = container.querySelector('.cascader-dropdown');
        const isActive = dropdown.classList.contains('active');
        
        // 关闭所有其他级联选择器
        document.querySelectorAll('.cascader-dropdown').forEach(d => {
            d.classList.remove('active');
        });
        
        if (!isActive) {
            dropdown.classList.add('active');
        }
    }
    
    // 点击外部关闭级联选择器
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.cascader-container')) {
            document.querySelectorAll('.cascader-dropdown').forEach(d => {
                d.classList.remove('active');
            });
        }
    });
    
    // 二级级联选择（用于新增归档申请页和已拒绝详情页）
    function selectCascaderLevel(containerId, level, value, element) {
        event.stopPropagation();
        
        // 移除同级别的active状态
        const column = element.parentElement;
        column.querySelectorAll('.cascader-item').forEach(item => {
            item.classList.remove('active');
        });
        element.classList.add('active');
        
        // 更新显示文本
        const container = document.getElementById(containerId);
        const textSpan = container.querySelector('[id$="-text"]');
        
        if (level === 1) {
            // 选择了一级，更新二级选项
            const level2Container = document.getElementById(containerId + '-level2');
            if (value === '科技档案') {
                level2Container.innerHTML = `
                    <div class="cascader-item active" onclick="selectCascaderLevel('${containerId}', 2, '基建档案', this)">基建档案</div>
                    <div class="cascader-item" onclick="selectCascaderLevel('${containerId}', 2, '投资档案', this)">投资档案</div>
                `;
            } else if (value === '文书档案') {
                level2Container.innerHTML = `
                    <div class="cascader-item active" onclick="selectCascaderLevel('${containerId}', 2, '行政文书', this)">行政文书</div>
                    <div class="cascader-item" onclick="selectCascaderLevel('${containerId}', 2, '党群工作', this)">党群工作</div>
                `;
            }
            textSpan.textContent = value + ' / ' + (value === '科技档案' ? '基建档案' : '行政文书');
        } else if (level === 2) {
            // 选择了二级，更新显示
            const level1Text = column.previousElementSibling.querySelector('.active').textContent.trim();
            textSpan.textContent = level1Text + ' / ' + value;
            // 关闭下拉
            container.querySelector('.cascader-dropdown').classList.remove('active');
        }
    }
    
    // 三级级联选择数据（用于新增档案目录页）
    const directoryCascaderData = {
        '科技档案': {
            '基建档案': ['基建文件', '施工资料', '监理资料'],
            '投资档案': ['投资交易文件', '投资决策文件']
        },
        '文书档案': {
            '行政文书': ['行政发文', '行政收文'],
            '党群工作': ['党委文件', '工会文件'],
            '市场投资管理': ['市场与客户管理']
        }
    };
    
    let directorySelection = { level1: '', level2: '', level3: '' };
    
    function selectDirectoryCascader(level, value, element) {
        event.stopPropagation();
        
        // 移除同级别的active状态
        const column = element.parentElement;
        column.querySelectorAll('.cascader-item').forEach(item => {
            item.classList.remove('active');
        });
        element.classList.add('active');
        
        const container = document.getElementById('directory-cascader');
        const textSpan = document.getElementById('directory-cascader-text');
        
        if (level === 1) {
            directorySelection.level1 = value;
            directorySelection.level2 = '';
            directorySelection.level3 = '';
            
            // 更新二级选项
            const level2Container = document.getElementById('directory-cascader-level2');
            const level2Data = Object.keys(directoryCascaderData[value] || {});
            level2Container.innerHTML = level2Data.map(item => `
                <div class="cascader-item" onclick="selectDirectoryCascader(2, '${item}', this)">
                    ${item} <i class="fas fa-chevron-right"></i>
                </div>
            `).join('');
            
            // 清空三级
            document.getElementById('directory-cascader-level3').innerHTML = '';
            textSpan.textContent = value;
            
        } else if (level === 2) {
            directorySelection.level2 = value;
            directorySelection.level3 = '';
            
            // 更新三级选项
            const level3Container = document.getElementById('directory-cascader-level3');
            const level3Data = directoryCascaderData[directorySelection.level1]?.[value] || [];
            level3Container.innerHTML = level3Data.map(item => `
                <div class="cascader-item" onclick="selectDirectoryCascader(3, '${item}', this)">${item}</div>
            `).join('');
            
            textSpan.textContent = directorySelection.level1 + ' / ' + value;
            
        } else if (level === 3) {
            directorySelection.level3 = value;
            textSpan.textContent = directorySelection.level1 + ' / ' + directorySelection.level2 + ' / ' + value;
            // 关闭下拉
            container.querySelector('.cascader-dropdown').classList.remove('active');
        }
    }
        // 项目分类多选级联数据
    const projectCategoryData = {
        '主营业务项目': {
            '重资产项目': ['投资项目', '建设项目','运营项目'],
            '轻资产项目': ['产品/服务销售项目']
        },
        '专项项目': {
            '生产专项': ['技改专项'],
            '供水专项': ['重大再投资专项', '重要再投资专项']
        },
        '公共项目': {
            '公共项目': ['公共项目']
        }
    };
    
    // 存储多选级联状态
    const projectCategorySelections = {};
    
    // 项目分类多选级联选择
    function selectProjectCategoryMulti(containerId, level, value, element) {
        event.stopPropagation();
        
        const checkbox = element.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        
        if (!projectCategorySelections[containerId]) {
            projectCategorySelections[containerId] = { level1: [], level2: [], level3: [] };
        }
        
        const selection = projectCategorySelections[containerId];
        const column = element.parentElement;
        
        if (level === 1) {
            if (checkbox.checked) {
                if (!selection.level1.includes(value)) selection.level1.push(value);
            } else {
                selection.level1 = selection.level1.filter(v => v !== value);
                // 清除相关的二级和三级选择
                Object.keys(projectCategoryData[value] || {}).forEach(level2Key => {
                    selection.level2 = selection.level2.filter(v => v !== level2Key);
                    (projectCategoryData[value][level2Key] || []).forEach(level3Val => {
                        selection.level3 = selection.level3.filter(v => v !== level3Val);
                    });
                });
            }
            updateProjectCategoryLevel2(containerId);
            updateProjectCategoryLevel3(containerId);
        } else if (level === 2) {
            if (checkbox.checked) {
                if (!selection.level2.includes(value)) selection.level2.push(value);
            } else {
                selection.level2 = selection.level2.filter(v => v !== value);
                // 清除相关的三级选择
                selection.level1.forEach(level1Val => {
                    if (projectCategoryData[level1Val] && projectCategoryData[level1Val][value]) {
                        projectCategoryData[level1Val][value].forEach(level3Val => {
                            selection.level3 = selection.level3.filter(v => v !== level3Val);
                        });
                    }
                });
            }
            updateProjectCategoryLevel3(containerId);
        } else if (level === 3) {
            if (checkbox.checked) {
                if (!selection.level3.includes(value)) selection.level3.push(value);
            } else {
                selection.level3 = selection.level3.filter(v => v !== value);
            }
        }
    }
    
    // 更新二级分类显示
    function updateProjectCategoryLevel2(containerId) {
        const selection = projectCategorySelections[containerId] || { level1: [], level2: [], level3: [] };
        const level2Container = document.getElementById(containerId + '-level2');
        
        if (selection.level1.length === 0) {
            level2Container.innerHTML = '<div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">请先选择一级分类</div>';
            return;
        }
        
        let html = '';
        selection.level1.forEach(level1Val => {
            const level2Data = projectCategoryData[level1Val] || {};
            Object.keys(level2Data).forEach(level2Val => {
                const isChecked = selection.level2.includes(level2Val) ? 'checked' : '';
                const activeClass = isChecked ? 'active' : '';
                html += `<div class="cascader-item ${activeClass}" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('${containerId}', 2, '${level2Val}', this)">
                    <input type="checkbox" class="mr-2" value="${level2Val}" ${isChecked} onclick="event.stopPropagation()"> ${level2Val}
                </div>`;
            });
        });
        
        level2Container.innerHTML = html || '<div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">暂无数据</div>';
    }
    
    // 更新三级分类显示
    function updateProjectCategoryLevel3(containerId) {
        const selection = projectCategorySelections[containerId] || { level1: [], level2: [], level3: [] };
        const level3Container = document.getElementById(containerId + '-level3');
        
        if (selection.level2.length === 0) {
            level3Container.innerHTML = '<div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">请先选择二级分类</div>';
            return;
        }
        
        let html = '';
        selection.level2.forEach(level2Val => {
            selection.level1.forEach(level1Val => {
                if (projectCategoryData[level1Val] && projectCategoryData[level1Val][level2Val]) {
                    projectCategoryData[level1Val][level2Val].forEach(level3Val => {
                        const isChecked = selection.level3.includes(level3Val) ? 'checked' : '';
                        const activeClass = isChecked ? 'active' : '';
                        html += `<div class="cascader-item ${activeClass}" style="display: flex; align-items: center;" onclick="selectProjectCategoryMulti('${containerId}', 3, '${level3Val}', this)">
                            <input type="checkbox" class="mr-2" value="${level3Val}" ${isChecked} onclick="event.stopPropagation()"> ${level3Val}
                        </div>`;
                    });
                }
            });
        });
        
        level3Container.innerHTML = html || '<div class="text-xs text-gray-400 italic p-3 dark:text-gray-500">暂无数据</div>';
    }
    
    // 确认项目分类选择
    function confirmProjectCategoryMulti(containerId) {
        const selection = projectCategorySelections[containerId] || { level1: [], level2: [], level3: [] };
        const allSelections = [...selection.level1, ...selection.level2, ...selection.level3];
        const textSpan = document.getElementById(containerId + '-text');
        
        if (allSelections.length === 0) {
            textSpan.textContent = '请选择项目分类';
        } else if (allSelections.length <= 2) {
            textSpan.textContent = allSelections.join(' / ');
        } else {
            textSpan.textContent = `已选择 ${allSelections.length} 项`;
        }
        
        toggleCascader(containerId);
    }
    
    let archiveLevelSelections = [];
    
    function setArchiveLevelSelections(values) {
        archiveLevelSelections = Array.isArray(values) ? values.filter(Boolean) : [];
        const select = document.getElementById('archive-level-select');
        if (select) {
            Array.from(select.options).forEach(option => {
                option.selected = archiveLevelSelections.includes(option.text);
            });
        }
        
        document.querySelectorAll('#archive-level-options .cascader-item').forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (!checkbox) return;
            const isSelected = archiveLevelSelections.includes(checkbox.value);
            checkbox.checked = isSelected;
            item.classList.toggle('active', isSelected);
        });
        
        updateArchiveLevelDisplay();
    }
    
    function selectArchiveLevelMulti(value, element) {
        event.stopPropagation();
        const checkbox = element.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        
        if (checkbox.checked) {
            if (!archiveLevelSelections.includes(value)) archiveLevelSelections.push(value);
            element.classList.add('active');
        } else {
            archiveLevelSelections = archiveLevelSelections.filter(v => v !== value);
            element.classList.remove('active');
        }
    }
    
    function confirmArchiveLevelMulti() {
        const select = document.getElementById('archive-level-select');
        if (select) {
            Array.from(select.options).forEach(option => {
                option.selected = archiveLevelSelections.includes(option.text);
            });
        }
        
        updateArchiveLevelDisplay();
        toggleCascader('archive-level-cascader');
    }
    
    function updateArchiveLevelDisplay() {
        const placeholder = document.getElementById('archive-level-placeholder');
        const tagsContainer = document.getElementById('archive-level-tags');
        
        if (!placeholder || !tagsContainer) return;
        
        if (archiveLevelSelections.length === 0) {
            placeholder.classList.remove('hidden');
            tagsContainer.classList.add('hidden');
            tagsContainer.innerHTML = '';
        } else {
            placeholder.classList.add('hidden');
            tagsContainer.classList.remove('hidden');
            tagsContainer.innerHTML = archiveLevelSelections.map(value => `
                <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs dark:bg-blue-900 dark:text-blue-200">
                    ${value}
                    <i class="fas fa-times cursor-pointer hover:text-blue-600 dark:hover:text-blue-300" onclick="event.stopPropagation(); removeArchiveLevelTag('${value}')"></i>
                </span>
            `).join('');
        }
    }
    
    function removeArchiveLevelTag(value) {
        event.stopPropagation();
        archiveLevelSelections = archiveLevelSelections.filter(v => v !== value);
        
        const select = document.getElementById('archive-level-select');
        if (select) {
            Array.from(select.options).forEach(option => {
                if (option.text === value) option.selected = false;
            });
        }
        
        document.querySelectorAll('#archive-level-options .cascader-item').forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox && checkbox.value === value) {
                checkbox.checked = false;
                item.classList.remove('active');
            }
        });
        
        updateArchiveLevelDisplay();
    }
    
    function setArchiveLevelCascaderDisabled(disabled) {
        const container = document.getElementById('archive-level-cascader');
        if (!container) return;
        const input = container.querySelector('.cascader-input');
        const dropdown = container.querySelector('.cascader-dropdown');
        if (input) input.classList.toggle('pointer-events-none', !!disabled);
        if (dropdown && disabled) dropdown.classList.remove('active');
    }
    
        // 档案载体多选功能
    let carrierSelections = [];

    function isDirectoryFormEditable() {
        const page = document.getElementById('page-archive-directory-new');
        if (!page) return false;
        const anyField = page.querySelector('input, select, textarea');
        return anyField ? !anyField.disabled : false;
    }

    function setupCarrierCheckboxListeners() {
        const checkboxes = document.querySelectorAll('#carrier-cascader-level1 .carrier-checkbox');
        checkboxes.forEach(cb => {
            cb.removeEventListener('change', handleCarrierCheckboxChange);
            cb.addEventListener('change', handleCarrierCheckboxChange);
        });
    }

    function handleCarrierCheckboxChange(e) {
        if (!isDirectoryFormEditable()) return;
        const checkbox = e.target;
        if (!(checkbox instanceof HTMLInputElement)) return;
        if (!checkbox.classList.contains('carrier-checkbox')) return;

        if (checkbox.value === '电子档案' && !checkbox.checked) {
            checkbox.checked = true;
            showToast('档案载体必须选择电子档案', 'warning');
        }

        carrierSelections = Array.from(document.querySelectorAll('#carrier-cascader-level1 .carrier-checkbox'))
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        ensureElectronicCarrierSelected();
    }

    function ensureElectronicCarrierSelected() {
        const requiredValue = '电子档案';
        if (!carrierSelections.includes(requiredValue)) carrierSelections.unshift(requiredValue);
        carrierSelections = carrierSelections.filter((v, i, arr) => arr.indexOf(v) === i);

        document.querySelectorAll('#carrier-cascader-level1 .cascader-item').forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (!checkbox) return;
            const isSelected = carrierSelections.includes(checkbox.value);
            checkbox.checked = isSelected;
            item.classList.toggle('active', isSelected);
            if (checkbox.value === requiredValue) checkbox.disabled = true;
        });

        updateCarrierDisplay();
    }
    
    function selectCarrierMulti(value, element) {
        event.stopPropagation();
        const checkbox = element.querySelector('input[type="checkbox"]');
        if (value === '电子档案' && checkbox.checked) {
            showToast('档案载体必须选择电子档案', 'warning');
            checkbox.checked = true;
            if (!carrierSelections.includes(value)) carrierSelections.unshift(value);
            element.classList.add('active');
            updateCarrierDisplay();
            return;
        }

        checkbox.checked = !checkbox.checked;
        
        if (checkbox.checked) {
            if (!carrierSelections.includes(value)) carrierSelections.push(value);
            element.classList.add('active');
        } else {
            carrierSelections = carrierSelections.filter(v => v !== value);
            element.classList.remove('active');
        }
    }
    
    function confirmCarrierMulti() {
        updateCarrierDisplay();
        toggleCascader('carrier-cascader');
    }
    
    function updateCarrierDisplay() {
        const placeholder = document.getElementById('carrier-cascader-placeholder');
        const tagsContainer = document.getElementById('carrier-cascader-tags');
        
        if (carrierSelections.length === 0) {
            placeholder.classList.remove('hidden');
            tagsContainer.classList.add('hidden');
            tagsContainer.innerHTML = '';
        } else {
            placeholder.classList.add('hidden');
            tagsContainer.classList.remove('hidden');
            tagsContainer.innerHTML = carrierSelections.map(value => `
                <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs dark:bg-blue-900 dark:text-blue-200">
                    ${value}
                    <i class="fas fa-times cursor-pointer hover:text-blue-600 dark:hover:text-blue-300" onclick="event.stopPropagation(); removeCarrierTag('${value}')"></i>
                </span>
            `).join('');
        }
    }
    
    function removeCarrierTag(value) {
        event.stopPropagation();
        if (value === '电子档案') {
            showToast('档案载体必须选择电子档案', 'warning');
            ensureElectronicCarrierSelected();
            return;
        }
        carrierSelections = carrierSelections.filter(v => v !== value);
        
        // 同步更新下拉框中的checkbox状态
        document.querySelectorAll('#carrier-cascader-level1 .cascader-item').forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox && checkbox.value === value) {
                checkbox.checked = false;
                item.classList.remove('active');
            }
        });
        
        updateCarrierDisplay();
    }

    function viewLedgerDetail(row) {
        const cells = row.cells;
        const categoryText = cells[5].innerText.trim();
        const categories = categoryText.split('/');
        const typeText = cells[6].innerText.trim();
        const elCategory1 = document.getElementById('detail-category-1');
        const elCategory2 = document.getElementById('detail-category-2');
        const elCategory3 = document.getElementById('detail-category-3');
        const elType = document.getElementById('detail-category-type');
        
        if (elCategory1) elCategory1.innerText = categories[0] || '-';
        if (elCategory2) elCategory2.innerText = categories[1] || '-';
        if (elCategory3) elCategory3.innerText = categories[2] || '-';
        if (elType) elType.innerText = typeText || '-';
        showPage('ledger-detail');
    }
</script>

</body>
</html>
